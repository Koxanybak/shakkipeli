(this["webpackJsonpshakki-frontend"]=this["webpackJsonpshakki-frontend"]||[]).push([[0],{125:function(e,t,n){e.exports=n.p+"static/media/blackking.66e1bcad.svg"},126:function(e,t,n){e.exports=n.p+"static/media/blackqueen.7b3e33e4.svg"},127:function(e,t,n){e.exports=n.p+"static/media/blackrook.96872a66.svg"},128:function(e,t,n){e.exports=n.p+"static/media/blackbishop.1f3b8d1a.svg"},129:function(e,t,n){e.exports=n.p+"static/media/blackknight.d39f1d02.svg"},130:function(e,t,n){e.exports=n.p+"static/media/blackpawn.1c52d8c4.svg"},131:function(e,t,n){e.exports=n.p+"static/media/whiteking.250510ff.svg"},132:function(e,t,n){e.exports=n.p+"static/media/whitequeen.4320a2dd.svg"},133:function(e,t,n){e.exports=n.p+"static/media/whiterook.095b1a06.svg"},134:function(e,t,n){e.exports=n.p+"static/media/whitebishop.09004fd2.svg"},135:function(e,t,n){e.exports=n.p+"static/media/whiteknight.e6294efe.svg"},136:function(e,t,n){e.exports=n.p+"static/media/whitepawn.d69014fb.svg"},152:function(e,t,n){e.exports=n(173)},173:function(e,t,n){"use strict";n.r(t);var a=n(41),r=n(0),o=n.n(r),c=n(19),i=n.n(c),l=n(51),s=n(211),u=n(59),m=function(){return o.a.createElement("div",{className:"footer"},"Student project for Full Stack open 2020. By using this site you accept the use of essential cookies.")},d=n(13),g=n(213),p=n(204),b=n(214),v=n(206),f=n(28),h=n(21);function E(){var e=Object(f.a)(["\n  mutation addUser($user: NewUserInput!) {\n    addUser(\n      user: $user\n    ) {\n      username\n      tag\n      id\n      friends {\n        tag\n      }\n    }\n  }\n"]);return E=function(){return e},e}function k(){var e=Object(f.a)(["\n  mutation login($username: String!, $password: String!) {\n    login(\n      username: $username,\n      password: $password\n    ) {\n      username\n      tag\n      friends {\n        tag\n      }\n      token\n      guest\n      id\n    }\n  }\n"]);return k=function(){return e},e}function y(){var e=Object(f.a)(["\n  query getLoggedUser($token: String) {\n    getLoggedUser(\n      token: $token\n    ) {\n      username\n      tag\n      friends {\n        tag\n      }\n      id\n      token\n      guest\n    }\n  }\n"]);return y=function(){return e},e}function w(){var e=Object(f.a)(["\n  mutation createGame {\n    createGame {\n      board {\n        type\n        side\n      }\n      id\n    }\n  }\n"]);return w=function(){return e},e}function j(){var e=Object(f.a)(["\n  mutation makeMove($move: MoveInput!) {\n    makeMove(\n      move: $move\n    ) {\n      lastMove {\n        success\n        message\n      }\n    }\n  }\n"]);return j=function(){return e},e}function O(){var e=Object(f.a)(["\n  mutation promote($gameId: String!, $pieceType: String!) {\n    promote(\n      gameId: $gameId,\n      pieceType: $pieceType\n    ) {\n      ...gameStateDetails\n    }\n  }\n  ","\n"]);return O=function(){return e},e}function S(){var e=Object(f.a)(["\n  mutation joinGame($gameId: String!) {\n    joinGame(\n      gameId: $gameId\n    ) {\n      ...gameStateDetails\n    }\n  }\n  ","\n"]);return S=function(){return e},e}function L(){var e=Object(f.a)(["\n  subscription gameStateUpdated($gameId: String!) {\n    gameStateUpdated(\n      gameId: $gameId\n    ) {\n      ...gameStateDetails\n    }\n  }\n  ","\n"]);return L=function(){return e},e}function x(){var e=Object(f.a)(["\n  mutation skipTurn($gameId: String!) {\n    skipTurn(\n      gameId: $gameId\n    ) {\n      ...gameStateDetails\n    }\n  }\n  ","\n"]);return x=function(){return e},e}function P(){var e=Object(f.a)(["\n  query getGame($gameId: String!) {\n    getGame(\n      gameId: $gameId\n    ) {\n      ...gameStateDetails\n    }\n  }\n  ","\n"]);return P=function(){return e},e}function I(){var e=Object(f.a)(["\n  fragment gameStateDetails on Game {\n    board {\n      ...idlePiece\n      id\n      availableMoves {\n        newLocation {\n          ...location\n        }\n      }\n    }\n    id\n    currentPlayer\n    whitePlayer\n    blackPlayer\n    winner\n    gameOver\n    promotionPlayerID\n    check {\n      threatenedPlayer\n      movesAvailable {\n        piece {\n          type\n          side\n        }\n        newLocation {\n          ...location\n        }\n      }\n    }\n    moveHistory {\n      ... on CastlingMove {\n        piece {\n          ...movedPiece\n        }\n        castledPiece {\n          ...movedPiece\n        }\n      }\n      ... on PromotionMove {\n        promotedPiece {\n          ...idlePiece\n        }\n        promotedTo\n      }\n      ... on OrdinaryMove {\n        piece {\n          ...movedPiece\n        }\n        pieceEaten {\n          ...idlePiece\n        }\n        newLocation {\n          ...location\n        }\n      }\n      ...moveHistoryEntry\n    }\n  }\n  ","\n  ","\n  ","\n  ","\n"]);return I=function(){return e},e}function C(){var e=Object(f.a)(["\n fragment moveHistoryEntry on MoveHistoryEntry {\n   leadToCheck\n   wonTheGame\n }\n"]);return C=function(){return e},e}function M(){var e=Object(f.a)(["\n  fragment movedPiece on Piece {\n    type\n    side\n    lastLocation {\n      ...location\n    }\n  }\n  ","\n"]);return M=function(){return e},e}function T(){var e=Object(f.a)(["\n  fragment idlePiece on Piece {\n    type\n    side\n    location {\n      ...location\n    }\n  }\n  ","\n"]);return T=function(){return e},e}function N(){var e=Object(f.a)(["\n  fragment location on Location {\n    row\n    column\n  }\n"]);return N=function(){return e},e}var U,q=Object(h.a)(N()),D=Object(h.a)(T(),q),$=Object(h.a)(M(),q),Q=Object(h.a)(C()),H=Object(h.a)(I(),q,D,$,Q),G=Object(h.a)(P(),H),A=Object(h.a)(x(),H),K=Object(h.a)(L(),H),B=Object(h.a)(S(),H),_=Object(h.a)(O(),H),W=Object(h.a)(j()),z=Object(h.a)(w()),F=Object(h.a)(y()),J=Object(h.a)(k()),V=Object(h.a)(E()),R=n(116),Y=n(112),X=n(113),Z=n(117),ee=n(114),te=function(e){e.graphQLErrors&&e.graphQLErrors[0]?(console.log(e.graphQLErrors[0].message),e.graphQLErrors[0].stack&&console.log(e.graphQLErrors[0].stack)):(console.log(e.message),e.stack&&console.log(e.stack))},ne=function(){var e=Object(Y.a)(),t=Object(r.useState)(null),n=Object(d.a)(t,2),a=n[0],o=n[1],c=Object(ee.a)(F,{variables:{token:window.localStorage.getItem("loggedChessUser")?window.localStorage.getItem("loggedChessUser"):window.sessionStorage.getItem("loggedChessUser")},onCompleted:function(e){p(e.getLoggedUser)},onError:function(e){te(e)}}),i=Object(d.a)(c,1)[0],l=Object(X.a)(F,{variables:{token:window.localStorage.getItem("loggedChessUser")?window.localStorage.getItem("loggedChessUser"):window.sessionStorage.getItem("loggedChessUser")},onError:function(e){te(e)}}),s=l.loading,u=l.data,m=l.error,g=Object(r.useCallback)((function(){console.log("logged out"),window.localStorage.removeItem("loggedChessUser"),window.sessionStorage.removeItem("loggedChessUser"),o(null),i()}),[i]),p=Object(r.useCallback)((function(t,n){var a={getLoggedUser:t};n&&(console.log("localStorageen meni"),window.localStorage.setItem("loggedChessUser",t.token)),window.sessionStorage.setItem("loggedChessUser",t.token),e.writeQuery({query:F,data:a,variables:{token:t.token}})}),[e]);Object(r.useEffect)((function(){u&&(p(u.getLoggedUser),o(u.getLoggedUser.token))}),[u,p]);var b=null;return s||m||!a||(b=e.readQuery({query:F,variables:{token:a}})),{user:s||m||!a?null:b.getLoggedUser,userLoading:s,userError:m,setUser:p,removeUser:g}},ae=function(){var e=Object(r.useState)(""),t=Object(d.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)(""),i=Object(d.a)(c,2),l=i[0],s=i[1],m=Object(r.useState)(!0),f=Object(d.a)(m,2),h=f[0],E=f[1],k=ne().setUser,y=Object(u.f)(),w=Object(R.a)(J,{onError:function(e){e.graphQLErrors&&e.graphQLErrors[0]?console.log(e.graphQLErrors[0].message):console.log(e.message),s("")}}),j=Object(d.a)(w,2),O=j[0],S=j[1];return Object(r.useEffect)((function(){S.data&&(a(""),s(""),k(S.data.login,h),y.push("/"))}),[S.data,k,y,h]),o.a.createElement("div",null,o.a.createElement("h2",null,"Kirjaudu sis\xe4\xe4n"),o.a.createElement("form",{onSubmit:function(e){e.preventDefault(),O({variables:{username:n,password:l}})}},o.a.createElement("div",null,o.a.createElement(g.a,{label:"K\xe4ytt\xe4j\xe4nimi",onChange:function(e){a(e.target.value)},name:"username"})),o.a.createElement("div",null,o.a.createElement(g.a,{label:"Salasana",type:"password",onChange:function(e){s(e.target.value)},name:"password"})),o.a.createElement("div",null,o.a.createElement(p.a,{control:o.a.createElement(b.a,{checked:h,onChange:function(){return E(!h)},name:"rememberMe",color:"primary"}),label:"Muista minut"})),o.a.createElement("div",null,o.a.createElement(v.a,{variant:"contained",color:"primary",type:"submit"},"Kirjaudu"))),o.a.createElement("div",null,"tai"),o.a.createElement("div",null,o.a.createElement(v.a,{variant:"contained",color:"primary",onClick:function(){return y.push("/register")}},"Luo uusi k\xe4ytt\xe4j\xe4")))},re=n(207),oe=n(208),ce=n(205),ie=function(){var e=ne();e.user,e.removeUser;return o.a.createElement(re.a,{position:"static"},o.a.createElement(oe.a,null,o.a.createElement(ce.a,{edge:"start",color:"inherit","aria-label":"menu"}),o.a.createElement(v.a,{color:"inherit",component:l.b,to:"/play"},"Pelaa"),o.a.createElement(v.a,{color:"inherit",component:l.b,to:"/info"},"Ohjeet")))},le=function(){var e=Object(r.useState)(""),t=Object(d.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)(""),i=Object(d.a)(c,2),l=i[0],s=i[1],m=Object(r.useState)(""),p=Object(d.a)(m,2),b=p[0],f=p[1],h=Object(r.useState)(""),E=Object(d.a)(h,2),k=E[0],y=E[1],w=Object(u.f)(),j=Object(R.a)(V,{onError:function(e){console.log(e.graphQLErrors[0].message),window.alert(e.graphQLErrors[0].message)}}),O=Object(d.a)(j,2),S=O[0],L=O[1];return Object(r.useEffect)((function(){L.data&&(a(""),s(""),y(""),window.alert("K\xe4ytt\xe4j\xe4 luotu onnistuneesti."),w.push("/"))}),[L.data,w]),o.a.createElement("div",null,o.a.createElement("h2",null,"Luo uusi k\xe4ytt\xe4j\xe4"),o.a.createElement("form",{onSubmit:function(e){e.preventDefault(),S({variables:{user:{username:n,password:l,tag:k}}})}},o.a.createElement("div",null,o.a.createElement(g.a,{label:"K\xe4ytt\xe4j\xe4nimi",onChange:function(e){a(e.target.value)},error:0!==n.length&&n.length<2,helperText:0!==n.length&&n.length<2?"Liian lyhyt":"K\xe4ytt\xe4j\xe4nimesi ei n\xe4y muille pelaajille.",required:!0})),o.a.createElement("div",null,o.a.createElement(g.a,{label:"Pelinimi",onChange:function(e){y(e.target.value)},helperText:"Nimi joka n\xe4kyy muille pelaajille.",required:!0})),o.a.createElement("div",null,o.a.createElement(g.a,{label:"Salasana",type:"password",onChange:function(e){s(e.target.value)},error:l.length<8&&""!==l,helperText:l.length<8&&""!==l?"Liian lyhyt":null,required:!0}),o.a.createElement("div",{style:{paddingTop:20,paddingBottom:10}},o.a.createElement("strong",null,"\xc4l\xe4 k\xe4yt\xe4 samaa salasanaa, joka sinulla on muilla nettisivuilla. "),"Olen vain opiskelija, ja t\xe4m\xe4 on ensimm\xe4inen nettiprojektini, joten en voi taata sivuston tietoturvallisuutta.")),o.a.createElement("div",null,o.a.createElement(g.a,{label:"Salasana uudelleen",type:"password",onChange:function(e){f(e.target.value)},error:b!==l,helperText:b!==l?"Salasanat eiv\xe4t vastaa toisiaan.":null,required:!0})),o.a.createElement("div",null,o.a.createElement(v.a,{variant:"contained",color:"primary",type:"submit"},"Luo k\xe4ytt\xe4j\xe4"))))},se=n(209),ue=function(){var e=Object(r.useState)(null),t=Object(d.a)(e,2),n=t[0],a=t[1],c=ne().user,i=Object(R.a)(z,{onError:function(e){e.graphQLErrors&&e.graphQLErrors[0]?console.log(e.graphQLErrors[0].message):console.log(e.message)}}),l=Object(d.a)(i,2),s=l[0],u=l[1];return Object(r.useEffect)((function(){if(u.data){var e=u.data.createGame.id;a("".concat(window.location,"/").concat(e))}}),[u.data]),o.a.createElement("div",null,o.a.createElement(v.a,{variant:"contained",onClick:function(){c?s():console.log("Sinun t\xe4ytyy kirjautua ennen kuin pelaat")}},"Peli linkin kautta"),n?o.a.createElement("div",null,"Jaa t\xe4m\xe4 linkki kaverillesi. Sen kautta p\xe4\xe4set pelaamaan.","  ",o.a.createElement(se.a,{href:n},n)):null)},me=n(106),de=n.n(me),ge=n(124),pe=n(125),be=n.n(pe),ve=n(126),fe=n.n(ve),he=n(127),Ee=n.n(he),ke=n(128),ye=n.n(ke),we=n(129),je=n.n(we),Oe=n(130),Se=n.n(Oe),Le=n(131),xe=n.n(Le),Pe=n(132),Ie=n.n(Pe),Ce=n(133),Me=n.n(Ce),Te=n(134),Ne=n.n(Te),Ue=n(135),qe=n.n(Ue),De=n(136),$e=n.n(De),Qe={width:65,height:65,verticalAlign:"middle"},He=function(e,t){return"king"===e&&"black"===t?be.a:"queen"===e&&"black"===t?fe.a:"bishop"===e&&"black"===t?ye.a:"rook"===e&&"black"===t?Ee.a:"knight"===e&&"black"===t?je.a:"pawn"===e&&"black"===t?Se.a:"king"===e&&"white"===t?xe.a:"queen"===e&&"white"===t?Ie.a:"bishop"===e&&"white"===t?Ne.a:"rook"===e&&"white"===t?Me.a:"knight"===e&&"white"===t?qe.a:"pawn"===e&&"white"===t?$e.a:void 0},Ge=function(e){var t=e.style,n=e.id,c=e.side,i=e.type,l=Object(r.useState)(1),s=Object(d.a)(l,1)[0];return o.a.createElement("img",{style:Object(a.a)(Object(a.a)({},t),{},{opacity:s}),className:"piece",draggable:"false",type:n,side:c,id:n,src:He(i,c),alt:"sprite"})},Ae=function(e){var t=e.side,n=e.id,r=Object(a.a)({},Qe);return o.a.createElement(Ge,{style:r,id:n,side:t,type:"king"},"K")},Ke=function(e){var t=e.side,n=e.id,r=Object(a.a)({},Qe);return o.a.createElement(Ge,{style:r,id:n,side:t,type:"queen"},"D")},Be=function(e){var t=e.side,n=e.id,r=Object(a.a)({},Qe);return o.a.createElement(Ge,{style:r,id:n,side:t,type:"rook"},"T")},_e=function(e){var t=e.side,n=e.id,r=Object(a.a)({},Qe);return o.a.createElement(Ge,{style:r,id:n,side:t,type:"knight"},"R")},We=function(e){var t=e.side,n=e.id,r=Object(a.a)({},Qe);return o.a.createElement(Ge,{style:r,id:n,side:t,type:"bishop"},"L")},ze=function(e){var t=e.side,n=e.id,r=Object(a.a)({},Qe);return o.a.createElement(Ge,{style:r,id:n,side:t,type:"pawn"},"S")},Fe=function(e){var t=e.color,n=(e.makeMove,e.location),a=e.piece,c=(e.dragHelperMap,e.id),i=e.highlight,l=Object(r.useMemo)((function(){return"rgb(".concat("white"===t?"29, 240, 201":"25, 145, 123",")")}),[t]),s=Object(r.useState)(l),u=Object(d.a)(s,2),m=u[0],g=u[1];Object(r.useEffect)((function(){g(i?"rgb(".concat("17, 209, 97",")"):l)}),[i,l]);var p,b={height:70,width:70,backgroundColor:m,textAlign:"center",background:"radial-gradient(".concat(m,", ").concat(l,")")};if(a)switch(a.type){case"pawn":p=o.a.createElement(ze,{side:a.side,id:8*n.row+n.column});break;case"rook":p=o.a.createElement(Be,{side:a.side,id:8*n.row+n.column});break;case"knight":p=o.a.createElement(_e,{side:a.side,id:8*n.row+n.column});break;case"bishop":p=o.a.createElement(We,{side:a.side,id:8*n.row+n.column});break;case"queen":p=o.a.createElement(Ke,{side:a.side,id:8*n.row+n.column});break;case"king":p=o.a.createElement(Ae,{side:a.side,id:8*n.row+n.column});break;default:p=null}return p?o.a.createElement("td",{id:c,style:b,className:"square"},p):o.a.createElement("td",{id:c,style:b,className:"square"})},Je=function(e){var t=e.boardAlignment,n=e.board,a=e.makeMove,r=e.handleClick,c=e.chosenPiece,i=new Map;n.forEach((function(e,t){e.forEach((function(e,n){i.set(8*t+n,e)}))}));var l=Array.from(Array(8),(function(e,t){for(var n=new Array(8),a=0;a<8;a++)n[a]=(t+a)%2===0?{piece:null,color:"white"}:{piece:null,color:"black"};return n})),s={height:560,width:560,borderStyle:"solid",borderColor:"black",borderWidth:"2px",background:"cyan"};return o.a.createElement("table",{className:"board",onClick:r,cellSpacing:"0",style:s},o.a.createElement("tbody",null,"white"===t?n.map((function(e,t){return o.a.createElement("tr",{key:t},o.a.createElement("td",null,8-t),e.map((function(e,n){var r=!1;return c&&(c.availableMoves.forEach((function(e){e.newLocation.row===t&&e.newLocation.column===n&&(r=!0)})),c.location.row===t&&c.location.column===n&&(r=!0)),o.a.createElement(Fe,{key:8*t+n,id:8*t+n,color:l[t][n].color,makeMove:a,location:{row:t,column:n},piece:e,dragHelperMap:i,highlight:r})})))})):n.map((function(e,t){return o.a.createElement("tr",{key:t},o.a.createElement("td",null,t+1),e.map((function(e,r){var s=!1;return c&&(c.availableMoves.forEach((function(e){e.newLocation.row===7-t&&e.newLocation.column===7-r&&(s=!0)})),c.location.row===7-t&&c.location.column===7-r&&(s=!0)),o.a.createElement(Fe,{key:8*(7-t)+(7-r),id:8*(7-t)+(7-r),color:l[7-t][7-r].color,makeMove:a,location:{row:7-t,column:7-r},piece:n[7-t][7-r],dragHelperMap:i,highlight:s})})))})),"white"===t?o.a.createElement("tr",null,o.a.createElement("td",null),o.a.createElement("td",null,"A"),o.a.createElement("td",null,"B"),o.a.createElement("td",null,"C"),o.a.createElement("td",null,"D"),o.a.createElement("td",null,"E"),o.a.createElement("td",null,"F"),o.a.createElement("td",null,"G"),o.a.createElement("td",null,"H")):o.a.createElement("tr",null,o.a.createElement("td",null),o.a.createElement("td",null,"H"),o.a.createElement("td",null,"G"),o.a.createElement("td",null,"F"),o.a.createElement("td",null,"E"),o.a.createElement("td",null,"D"),o.a.createElement("td",null,"C"),o.a.createElement("td",null,"B"),o.a.createElement("td",null,"A"))))},Ve=n(210),Re=n(175),Ye=Object(Ve.a)({turnText:{background:"linear-gradient(135deg, rgb(".concat("29, 240, 201","), rgb(").concat("25, 145, 123","))"),padding:10,height:"8vh",width:"40vh",textAlign:"center"}}),Xe=function(e){var t=e.game,n=t.check,a=t.currentPlayer,r=t.gameOver,c=t.promotionPlayerID,i=t.winner,l=e.promote,s=ne(),u=s.user,m=s.userLoading,d=Ye();return m?"loading...":o.a.createElement("div",{className:"gameText"},u.id!==a||r?o.a.createElement(Re.a,{className:d.turnText},"Odotetaan vastustajan siirtoa. ",n&&n.threatenedPlayer!==u.id?"Shakki!":null):o.a.createElement(Re.a,{className:d.turnText},o.a.createElement("h2",null,"On sinun vuorosi. ",n&&n.threatenedPlayer===u.id?"Shakki!":null)),o.a.createElement("div",null,u.id===c?o.a.createElement("div",null,"Valitse nappula, joksi haluat muuttaa sotilaan"," ",o.a.createElement(v.a,{onClick:function(){return l("queen")}},"Kuningatar"),o.a.createElement(v.a,{onClick:function(){return l("knight")}},"Ratsu")):null),o.a.createElement("h3",null,r?i===u.id?"Voitit pelin! Onneksi olkoon!":"Ootko paska ku h\xe4visit :D":null))},Ze=n(140),et=function(e){return 0===e.column?"A".concat(8-e.row):1===e.column?"B".concat(8-e.row):2===e.column?"C".concat(8-e.row):3===e.column?"D".concat(8-e.row):4===e.column?"E".concat(8-e.row):5===e.column?"F".concat(8-e.row):6===e.column?"G".concat(8-e.row):7===e.column?"H".concat(8-e.row):"ErrorLocation"},tt=function(e){var t=e.move,n=e.emphasize,a={borderLeftStyle:"solid",borderColor:"blue",borderWidth:"1px",borderLeftWidth:"10px",padding:10,background:"cyan"},r={borderLeftStyle:"solid",borderColor:"blue",borderWidth:"1px",borderLeftWidth:"5px",margin:5,background:"cyan"},c=n?{height:60,width:60}:void 0;return"OrdinaryMove"===t.__typename?o.a.createElement(Re.a,{style:n?a:r},o.a.createElement("img",{style:c,className:"piece",draggable:"false",src:He(t.piece.type,t.piece.side),alt:t.piece.type}),et(t.newLocation)):"CastlingMove"===t.__typename?o.a.createElement(Re.a,{style:n?a:r},"Tornitus"):"PromotionMove"===t.__typename?o.a.createElement(Re.a,{style:n?a:r},et(t.promotedPiece.location),o.a.createElement("img",{style:c,className:"piece",draggable:"false",src:He(t.promotedPiece.type,t.promotedPiece.side),alt:t.promotedPiece.type}),"---\x3e",o.a.createElement("img",{style:c,className:"piece",draggable:"false",src:He(t.promotedTo,t.promotedPiece.side),alt:t.promotedPiece.type})):o.a.createElement(Re.a,null,"Error")},nt=function(e){var t=e.moveHistory;return o.a.createElement("div",{className:"moveHistory",style:{overflowY:"scroll",height:350}},t.map((function(e,n){return e=t[t.length-1-n],0!==n?o.a.createElement(tt,{move:e,key:n}):null})))},at=function(e){var t=e.moveHistory,n=Object(r.useState)(!1),a=Object(d.a)(n,2),c=a[0],i=a[1],l={background:"linear-gradient(135deg, rgb(".concat("29, 240, 201","), rgb(").concat("25, 145, 123","))"),padding:"20px"};if(0===t.length)return o.a.createElement("div",null,"Siirtoja ei ole tehty");var s=t[t.length-1];return o.a.createElement(Re.a,{style:l},o.a.createElement(Ze.a,{variant:"h5"},"Viimeisin siirto"),o.a.createElement(tt,{move:s,emphasize:!0}),o.a.createElement(v.a,{variant:"contained",onClick:function(){return i(!c)},color:"primary"},"N\xe4yt\xe4 kaikki siirrot"),c?o.a.createElement(nt,{moveHistory:t}):null)},rt=function(e){var t=e.squareNode,n=e.pieceToMove,a=e.clickedPiece,r=e.game,o=e.user;return t.style.background!=="radial-gradient(rgb(".concat("17, 209, 97","), rgb(").concat("25, 145, 123","))")&&t.style.background!=="radial-gradient(rgb(".concat("17, 209, 97","), rgb(").concat("29, 240, 201","))")||a&&a.id===n.id||r.gameOver||r.promotionPlayerID||o.id!==r.currentPlayer},ot=function(e){var t=e.clickedPiece,n=e.game,a=e.user;return a.id===n.currentPlayer&&t.side===(n.whitePlayer===a.id?"white":"black")&&!n.promotionPlayerID&&!n.gameOver},ct=function(e){var t=e.skipTurn,n=e.disabled,a={background:"linear-gradient(135deg, rgb(".concat("29, 240, 201","), rgb(").concat("25, 145, 123","))"),padding:"20px"};return o.a.createElement(Re.a,{style:a},o.a.createElement(v.a,{variant:"outlined",size:"small",onClick:function(){return t()},disabled:n},"Ohita vuoro"))},it=Object(Ve.a)({game:{}}),lt=function(){var e=function(){var e=Object(Y.a)(),t=Object(u.g)().id,n=function(n){var a=e.readQuery({query:G,variables:{gameId:t}});a={getGame:n.gameStateUpdated},e.writeQuery({query:G,data:a,variables:{id:t}})},a=Object(X.a)(G,{variables:{gameId:t},onError:function(e){te(e)}}),o=Object(R.a)(W),c=Object(d.a)(o,1)[0],i=Object(R.a)(_),l=Object(d.a)(i,1)[0],s=Object(R.a)(A,{variables:{gameId:t},onError:function(e){te(e)}}),m=Object(d.a)(s,1)[0],g=Object(R.a)(B,{variables:{gameId:t},onError:function(e){te(e)},onCompleted:function(e){n(e)}}),p=Object(d.a)(g,1)[0];Object(Z.a)(K,{onSubscriptionData:function(e){var t=e.subscriptionData;n(t.data)},variables:{gameId:t}}),Object(r.useEffect)((function(){p()}),[p]);return{game:a.loading||a.error?null:a.data.getGame,gameLoading:a.loading,gameError:a.error,promote:function(e){l({variables:{gameId:t,pieceType:e}})},makeMove:function(e){var n=e.piece,a=e.oldLocation,r=e.newLocation;return c({variables:{move:{piece:n,oldLocation:a,newLocation:r,gameId:t}}})},skipTurn:m}}(),t=e.game,n=e.gameLoading,a=e.gameError,c=e.makeMove,i=e.promote,l=e.skipTurn,m=ne(),g=m.user,p=m.userLoading,b=Object(r.useState)(null),v=Object(d.a)(b,2),f=v[0],h=v[1],E=it();if(n||p)return"loading...";if(!t)return a.toString();var k=t.board,y=t.whitePlayer,w=t.moveHistory,j=t.currentPlayer,O=t.promotionPlayerID,S=t.check,L=t.blackPlayer,x=function(){var e=Object(ge.a)(de.a.mark((function e(n){var a,r,o,i,l,s,u,m,d,p,b,v;return de.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.preventDefault(),"piece"!==(a=n.target).className){e.next=27;break}if(r=k[Math.floor(Number(a.id)/8)][Number(a.id)%8],!f){e.next=24;break}if(!rt({squareNode:a.parentNode,pieceToMove:f,clickedPiece:r,user:g,game:t})){e.next=8;break}return h(null),e.abrupt("return");case 8:return o={type:f.type,side:f.side},i={row:f.location.row,column:f.location.column},l={row:r.location.row,column:r.location.column},e.prev=11,e.next=14,c({piece:o,oldLocation:i,newLocation:l});case 14:(s=e.sent).data.makeMove.lastMove.success||console.log(s.data.makeMove.lastMove.message),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),te(e.t0);case 21:h(null),e.next=25;break;case 24:ot({clickedPiece:r,game:t,user:g})&&h(r);case 25:e.next=54;break;case 27:if("square"!==a.className){e.next=53;break}if((u=a.firstChild)&&(m=k[Math.floor(Number(u.id)/8)][Number(u.id)%8]),!f){e.next=50;break}if(!rt({squareNode:a,pieceToMove:f,clickedPiece:m,user:g,game:t})){e.next=34;break}return h(null),e.abrupt("return");case 34:return d={type:f.type,side:f.side},p={row:f.location.row,column:f.location.column},b={row:Math.floor(Number(a.id)/8),column:Number(a.id)%8},e.prev=37,e.next=40,c({piece:d,oldLocation:p,newLocation:b});case 40:(v=e.sent).data.makeMove.lastMove.success||console.log(v.data.makeMove.lastMove.message),e.next=47;break;case 44:e.prev=44,e.t1=e.catch(37),te(e.t1);case 47:h(null),e.next=51;break;case 50:m&&ot({clickedPiece:m,game:t,user:g})&&h(m);case 51:e.next=54;break;case 53:h(null);case 54:case"end":return e.stop()}}),e,null,[[11,18],[37,44]])})));return function(t){return e.apply(this,arguments)}}();return o.a.createElement(s.a,{container:!0,direction:"row",justify:"center",className:E.game,spacing:2,wrap:"wrap"},o.a.createElement(s.a,{item:!0,xs:3,lg:2},o.a.createElement(ct,{skipTurn:l,disabled:g.id!==j||null!==O||null!==S||null===y||null===L})),o.a.createElement(s.a,{container:!0,item:!0,xs:10,lg:6,direction:"column",alignItems:"center"},o.a.createElement(Je,{board:k,boardAlignment:g.id===y?"white":"black",makeMove:c,handleClick:x,chosenPiece:f}),o.a.createElement(Xe,{game:t,promote:i})),o.a.createElement(s.a,{item:!0,xs:3,lg:3},o.a.createElement(at,{moveHistory:w})))},st=n(212),ut=Object(Ve.a)({root:{height:"100%"}}),mt=function(){var e=ne().user,t=ut();return o.a.createElement(st.a,{classes:t},o.a.createElement(s.a,{container:!0,direction:"column",alignItems:"center",justify:"space-between",classes:t,wrap:"nowrap"},o.a.createElement(ie,null),e?o.a.createElement(u.c,null,o.a.createElement(u.a,{path:"/play/:id"},o.a.createElement(lt,null)),o.a.createElement(u.a,{path:"/play"},o.a.createElement(ue,null)),o.a.createElement(u.a,{path:"/login"},o.a.createElement(ae,null)),o.a.createElement(u.a,{path:"/register"},o.a.createElement(le,null))):"Ladataan...",o.a.createElement(m,null)))},dt=n(67),gt=n(85),pt=n(86),bt=n(87),vt=n(115),ft=n(138),ht=n(137),Et=n(139),kt=Object(ft.a)((function(e,t){var n=t.headers,r=sessionStorage.getItem("loggedChessUser");return{headers:Object(a.a)(Object(a.a)({},n),{},{authorization:r?"bearer ".concat(r):null})}})),yt=window.location;U="https:"===yt.protocol?"wss:":"ws:",U+="//"+yt.host,console.log("".concat(U,"/graphql"));var wt=new dt.a({uri:"/graphql"}),jt=new Et.a({uri:"".concat(U,"/graphql"),options:{reconnect:!0}}),Ot=Object(gt.a)((function(e){var t=e.query,n=Object(ht.a)(t);return"OperationDefinition"===n.kind&&"subscription"===n.operation}),jt,kt.concat(wt)),St=new pt.a({cache:new bt.a,link:Ot,connectToDevTools:!0});i.a.render(o.a.createElement(vt.a,{client:St},o.a.createElement(l.a,null,o.a.createElement(mt,null))),document.getElementById("root"))}},[[152,1,2]]]);
//# sourceMappingURL=main.91222b59.chunk.js.map