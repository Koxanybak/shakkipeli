(this["webpackJsonpshakki-frontend"]=this["webpackJsonpshakki-frontend"]||[]).push([[0],{115:function(e,t,n){e.exports=n.p+"static/media/blackking.66e1bcad.svg"},116:function(e,t,n){e.exports=n.p+"static/media/blackqueen.7b3e33e4.svg"},117:function(e,t,n){e.exports=n.p+"static/media/blackrook.96872a66.svg"},118:function(e,t,n){e.exports=n.p+"static/media/blackbishop.1f3b8d1a.svg"},119:function(e,t,n){e.exports=n.p+"static/media/blackknight.d39f1d02.svg"},120:function(e,t,n){e.exports=n.p+"static/media/blackpawn.1c52d8c4.svg"},121:function(e,t,n){e.exports=n.p+"static/media/whiteking.250510ff.svg"},122:function(e,t,n){e.exports=n.p+"static/media/whitequeen.4320a2dd.svg"},123:function(e,t,n){e.exports=n.p+"static/media/whiterook.095b1a06.svg"},124:function(e,t,n){e.exports=n.p+"static/media/whitebishop.09004fd2.svg"},125:function(e,t,n){e.exports=n.p+"static/media/whiteknight.e6294efe.svg"},126:function(e,t,n){e.exports=n.p+"static/media/whitepawn.d69014fb.svg"},144:function(e,t,n){e.exports=n(165)},165:function(e,t,n){"use strict";n.r(t);var a=n(46),r=n(0),o=n.n(r),i=n(17),l=n.n(i),c=n(42),s=n(20),u=n(56),d=n(107),m=n(109),g=n(110),p=n(111),b=n(47),v=n(24);function f(){var e=Object(b.a)(["\n  mutation createGame {\n    createGame {\n      board {\n        type\n        side\n      }\n      id\n    }\n  }\n"]);return f=function(){return e},e}function h(){var e=Object(b.a)(["\n  mutation addUser($user: NewUserInput!) {\n    addUser(\n      user: $user\n    ) {\n      username\n      tag\n      id\n      friends {\n        tag\n      }\n    }\n  }\n"]);return h=function(){return e},e}function k(){var e=Object(b.a)(["\n  mutation login($username: String!, $password: String!) {\n    login(\n      username: $username,\n      password: $password\n    ) {\n      username\n      tag\n      friends {\n        tag\n      }\n      token\n      id\n    }\n  }\n"]);return k=function(){return e},e}function y(){var e=Object(b.a)(["\n  mutation makeMove($move: MoveInput!) {\n    makeMove(\n      move: $move\n    ) {\n      lastMove {\n        success\n        message\n      }\n    }\n  }\n"]);return y=function(){return e},e}function E(){var e=Object(b.a)(["\n  query getLoggedUser($token: String) {\n    getLoggedUser(\n      token: $token\n    ) {\n      username\n      tag\n      friends {\n        tag\n      }\n      id\n      token\n      guest\n    }\n  }\n"]);return E=function(){return e},e}function j(){var e=Object(b.a)(["\n  mutation promote($gameId: String!, $pieceType: String!) {\n    promote(\n      gameId: $gameId,\n      pieceType: $pieceType\n    ) {\n      board {\n        type\n        side\n        id\n      }\n      id\n      currentPlayer\n      whitePlayer\n      blackPlayer\n      winner\n      gameOver\n      promotionPlayerID\n      check {\n        threatenedSide\n        movesAvailable {\n          piece {\n            type\n            side\n            id\n          }\n          newLocation {\n            row\n            column\n          }\n        }\n      }\n    }\n  }\n"]);return j=function(){return e},e}function w(){var e=Object(b.a)(["\n  mutation joinGame($gameId: String!) {\n    joinGame(\n      gameId: $gameId\n    ) {\n      board {\n        type\n        side\n        id\n      }\n      id\n      currentPlayer\n      whitePlayer\n      blackPlayer\n      winner\n      gameOver\n      promotionPlayerID\n      check {\n        threatenedSide\n        movesAvailable {\n          piece {\n            type\n            side\n            id\n          }\n          newLocation {\n            row\n            column\n          }\n        }\n      }\n    }\n  }\n"]);return w=function(){return e},e}function O(){var e=Object(b.a)(["\n  subscription moveMade($gameId: String!) {\n    moveMade(\n      gameId: $gameId\n    ) {\n      board {\n        type\n        side\n        id\n      }\n      id\n      lastMove {\n        success\n      }\n      currentPlayer\n      whitePlayer\n      blackPlayer\n      winner\n      gameOver\n      promotionPlayerID\n      check {\n        threatenedSide\n        movesAvailable {\n          piece {\n            type\n            side\n            id\n          }\n          newLocation {\n            row\n            column\n          }\n        }\n      }\n    }\n  }\n"]);return O=function(){return e},e}function S(){var e=Object(b.a)(["\n  query getGame($gameId: String!) {\n    getGame(\n      gameId: $gameId\n    ) {\n      board {\n        type\n        side\n        id\n      }\n      id\n      currentPlayer\n      whitePlayer\n      blackPlayer\n      winner\n      gameOver\n      promotionPlayerID\n      check {\n        threatenedSide\n        movesAvailable {\n          piece {\n            type\n            side\n            id\n          }\n          newLocation {\n            row\n            column\n          }\n        }\n      }\n    }\n  }\n"]);return S=function(){return e},e}var I,C,x=Object(v.a)(S()),L=Object(v.a)(O()),q=Object(v.a)(w()),P=Object(v.a)(j()),D=Object(v.a)(E()),N=Object(v.a)(y()),M=Object(v.a)(k()),$=Object(v.a)(h()),G=Object(v.a)(f()),T=n(99),U=n.n(T),Q=n(114),A=n(115),K=n.n(A),H=n(116),J=n.n(H),B=n(117),R=n.n(B),V=n(118),z=n.n(V),F=n(119),W=n.n(F),X=n(120),Y=n.n(X),Z=n(121),_=n.n(Z),ee=n(122),te=n.n(ee),ne=n(123),ae=n.n(ne),re=n(124),oe=n.n(re),ie=n(125),le=n.n(ie),ce=n(126),se=n.n(ce),ue={width:65,height:65,verticalAlign:"middle"},de=function(e,t){return"king"===e&&"black"===t?K.a:"queen"===e&&"black"===t?J.a:"bishop"===e&&"black"===t?z.a:"rook"===e&&"black"===t?R.a:"knight"===e&&"black"===t?W.a:"pawn"===e&&"black"===t?Y.a:"king"===e&&"white"===t?_.a:"queen"===e&&"white"===t?te.a:"bishop"===e&&"white"===t?oe.a:"rook"===e&&"white"===t?ae.a:"knight"===e&&"white"===t?le.a:"pawn"===e&&"white"===t?se.a:void 0},me=function(e){var t=e.style,n=e.id,a=e.side,r=e.type;return o.a.createElement("img",{style:t,className:"piece",draggable:"true",onDragStart:function(e){I=e.target,e.target.style.opacity=.5},onDragEnd:function(e){e.target.style.opacity=1},type:n,side:a,id:n,src:de(r,a),alt:"sprite"})},ge=function(e){var t=e.side,n=e.id,r=Object(a.a)({},ue);return o.a.createElement(me,{style:r,id:n,side:t,type:"king"},"K")},pe=function(e){var t=e.side,n=e.id,r=Object(a.a)({},ue);return o.a.createElement(me,{style:r,id:n,side:t,type:"queen"},"D")},be=function(e){var t=e.side,n=e.id,r=Object(a.a)({},ue);return o.a.createElement(me,{style:r,id:n,side:t,type:"rook"},"T")},ve=function(e){var t=e.side,n=e.id,r=Object(a.a)({},ue);return o.a.createElement(me,{style:r,id:n,side:t,type:"knight"},"R")},fe=function(e){var t=e.side,n=e.id,r=Object(a.a)({},ue);return o.a.createElement(me,{style:r,id:n,side:t,type:"bishop"},"L")},he=function(e){var t=e.side,n=e.id,r=Object(a.a)({},ue);return o.a.createElement(me,{style:r,id:n,side:t,type:"pawn"},"S")},ke=o.a.createContext(null),ye=o.a.createContext(null),Ee=function(e){var t,n=e.color,a=e.makeMove,i=e.location,l=e.piece,c=e.dragHelperMap,s=Object(r.useContext)(ye).gameId,u={height:70,width:70,backgroundColor:"#1df0c9",textAlign:"center"},d={height:70,width:70,backgroundColor:"#19917b",textAlign:"center"},m=function(){var e=Object(Q.a)(U.a.mark((function e(t){var r,o,l,u,d;return U.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),console.log("dragged:",I),r={type:c.get(Number(I.id)).type,side:c.get(Number(I.id)).side},o={row:Math.floor(Number(I.id)/8),column:Number(I.id)%8},l=i,"square"===t.target.className?t.target.style.backgroundColor="white"===n?"#1df0c9":"#19917b":"piece"===t.target.className&&((u=t.target.parentNode).style.backgroundColor="white"===u.id?"#1df0c9":"#19917b"),e.prev=6,e.next=9,a({variables:{move:{piece:r,oldLocation:o,newLocation:l,gameId:s}}});case 9:(d=e.sent).data.makeMove.lastMove.success||console.log(d.data.makeMove.lastMove.message),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(6),console.log(e.t0.message);case 16:case"end":return e.stop()}}),e,null,[[6,13]])})));return function(t){return e.apply(this,arguments)}}();if(l)switch(l.type){case"pawn":t=o.a.createElement(he,{side:l.side,id:8*i.row+i.column});break;case"rook":t=o.a.createElement(be,{side:l.side,id:8*i.row+i.column});break;case"knight":t=o.a.createElement(ve,{side:l.side,id:8*i.row+i.column});break;case"bishop":t=o.a.createElement(fe,{side:l.side,id:8*i.row+i.column});break;case"queen":t=o.a.createElement(pe,{side:l.side,id:8*i.row+i.column});break;case"king":t=o.a.createElement(ge,{side:l.side,id:8*i.row+i.column});break;default:t=null}return o.a.createElement("td",{id:"white"===n?"white":"black",style:"white"===n?u:d,className:"square",onDragLeave:function(e){"square"===e.target.className&&"piece"!==e.relatedTarget.className?"white"===e.target.id?e.target.style.backgroundColor="#1df0c9":e.target.style.backgroundColor="#19917b":"piece"===e.target.className&&"square"!==e.relatedTarget.className&&("white"===e.target.parentNode.id?e.target.parentNode.style.backgroundColor="#1df0c9":e.target.parentNode.style.backgroundColor="#19917b")},onDragOver:function(e){e.preventDefault()},onDrop:m,onDragEnter:function(e){"square"===e.target.className?e.target.style.backgroundColor="#11d161":"piece"===e.target.className&&(e.target.parentNode.style.backgroundColor="#11d161")}},t)},je=function(e,t,n){var a=t.readQuery({query:x,variables:{gameId:n}});a={getGame:e.moveMade},console.log("newGameData:",e),t.writeQuery({query:x,data:a,variables:{gameId:n}}),console.log("Game state updated with:",t.readQuery({query:x,variables:{gameId:n}}))},we=n(194),Oe=function(){var e=Object(d.a)(),t=Object(u.g)().id,n=Object(r.useContext)(ye).setGameId,a=Object(r.useContext)(ke).user,i=Object(m.a)(x,{variables:{gameId:t},onError:function(e){e.graphQLErrors&&e.graphQLErrors[0]?console.log(e.graphQLErrors[0].message):console.log(e.message)},onCompleted:function(e){n(e.getGame.id)}}),l=Object(g.a)(N),c=Object(s.a)(l,1)[0],b=Object(g.a)(P),v=Object(s.a)(b,1)[0],f=Object(g.a)(q,{variables:{gameId:t},onError:function(e){e.graphQLErrors&&e.graphQLErrors[0]?console.log(e.graphQLErrors[0].message):console.log(e.message)},onCompleted:function(n){je(n,e,t)}}),h=Object(s.a)(f,1)[0];Object(p.a)(L,{onSubscriptionData:function(n){var a=n.subscriptionData;je(a.data,e,t)},variables:{gameId:t}}),Object(r.useEffect)((function(){h()}),[h]);var k=function(e){v({variables:{gameId:t,pieceType:e}})};if(i.loading)return"loading...";if(!i.data)return i.error.toString();var y=i.data.getGame,E=y.board,j=y.whitePlayer,w=y.currentPlayer,O=y.gameOver,S=y.winner,I=y.promotionPlayerID,C=new Map;E.forEach((function(e,t){e.forEach((function(e,n){C.set(8*t+n,e)}))}));var D=Array.from(Array(8),(function(e,t){for(var n=new Array(8),a=0;a<8;a++)n[a]=(t+a)%2===0?{piece:null,color:"white"}:{piece:null,color:"black"};return n}));return o.a.createElement("div",null,o.a.createElement("div",null,"Olet ",a.id===j?"valkoiset":"mustat",". ",a.id===w?"On sinun vuorosi.":"Odotetaan vastustajan siirtoa."),o.a.createElement("table",null,o.a.createElement("tbody",null,a.id===j?E.map((function(e,t){return o.a.createElement("tr",{key:t},e.map((function(e,n){return o.a.createElement(Ee,{key:8*t+n,color:D[t][n].color,makeMove:c,location:{row:t,column:n},piece:e,dragHelperMap:C})})))})):E.map((function(e,t){return o.a.createElement("tr",{key:t},e.map((function(e,n){return o.a.createElement(Ee,{key:8*(7-t)+(7-n),color:D[7-t][7-n].color,makeMove:c,location:{row:7-t,column:7-n},piece:E[7-t][7-n],dragHelperMap:C})})))})))),o.a.createElement("div",null,a.id===I?o.a.createElement("div",null,"Valitse nappula, joksi haluat muuttaa sotilaan",o.a.createElement(we.a,{onClick:function(){return k("queen")}},"Kuningatar"),o.a.createElement(we.a,{onClick:function(){return k("rook")}},"Torni"),o.a.createElement(we.a,{onClick:function(){return k("knight")}},"Ratsu"),o.a.createElement(we.a,{onClick:function(){return k("bishop")}},"L\xe4hetti")):null),o.a.createElement("div",null,O?S===a.id?"Voitit pelin! Onneksi olkoon!":"Ootko paska ku h\xe4visit :D":null))},Se=function(){return o.a.createElement("div",null,"Student project for Full Stack open 2020")},Ie=n(203),Ce=function(){var e=Object(r.useState)(""),t=Object(s.a)(e,2),n=t[0],a=t[1],i=Object(r.useState)(""),l=Object(s.a)(i,2),c=l[0],d=l[1],m=Object(r.useContext)(ke).setUser,p=Object(u.f)(),b=Object(g.a)(M,{onError:function(e){console.log(e.graphQLErrors[0].message),d("")}}),v=Object(s.a)(b,2),f=v[0],h=v[1];return Object(r.useEffect)((function(){h.data&&(a(""),d(""),console.log(h.data.login.token),window.sessionStorage.setItem("loggedChessUser",h.data.login.token),m(h.data.login),p.push("/"))}),[h.data,m,p]),o.a.createElement("div",null,o.a.createElement("h2",null,"Kirjaudu sis\xe4\xe4n"),o.a.createElement("form",{onSubmit:function(e){e.preventDefault(),f({variables:{username:n,password:c}})}},o.a.createElement("div",null,o.a.createElement(Ie.a,{label:"K\xe4ytt\xe4j\xe4nimi",onChange:function(e){a(e.target.value)},name:"username"})),o.a.createElement("div",null,o.a.createElement(Ie.a,{label:"Salasana",type:"password",onChange:function(e){d(e.target.value)},name:"password"})),o.a.createElement("div",null,o.a.createElement(we.a,{variant:"contained",color:"primary",type:"submit"},"Kirjaudu"))),o.a.createElement("div",null,"tai"),o.a.createElement("div",null,o.a.createElement(we.a,{variant:"contained",color:"primary",onClick:function(){return p.push("/register")}},"Luo uusi k\xe4ytt\xe4j\xe4")))},xe=n(198),Le=n(199),qe=n(200),Pe=n(168),De=function(){var e=Object(r.useContext)(ke).user;return o.a.createElement(xe.a,{position:"static"},o.a.createElement(Le.a,null,o.a.createElement(qe.a,{edge:"start",color:"inherit","aria-label":"menu"}),o.a.createElement(we.a,{color:"inherit",component:c.b,to:"/play"},"Pelaa"),o.a.createElement(we.a,{color:"inherit",component:c.b,to:"/info"},"Ohjeet"),e?o.a.createElement(Pe.a,{variant:"subtitle1",color:"secondary"},'`"`',e.tag,'`"` kirjautunut'):o.a.createElement(we.a,{color:"inherit",component:c.b,to:"/login"},"Kirjaudu")))},Ne=function(){var e=Object(r.useState)(""),t=Object(s.a)(e,2),n=t[0],a=t[1],i=Object(r.useState)(""),l=Object(s.a)(i,2),c=l[0],d=l[1],m=Object(r.useState)(""),p=Object(s.a)(m,2),b=p[0],v=p[1],f=Object(r.useState)(""),h=Object(s.a)(f,2),k=h[0],y=h[1],E=Object(u.f)(),j=Object(g.a)($,{onError:function(e){console.log(e.graphQLErrors[0].message),window.alert(e.graphQLErrors[0].message)}}),w=Object(s.a)(j,2),O=w[0],S=w[1];return Object(r.useEffect)((function(){S.data&&(a(""),d(""),y(""),window.alert("K\xe4ytt\xe4j\xe4 luotu onnistuneesti."),E.push("/"))}),[S.data,E]),o.a.createElement("div",null,o.a.createElement("h2",null,"Luo uusi k\xe4ytt\xe4j\xe4"),o.a.createElement("form",{onSubmit:function(e){e.preventDefault(),O({variables:{user:{username:n,password:c,tag:k}}})}},o.a.createElement("div",null,o.a.createElement(Ie.a,{label:"K\xe4ytt\xe4j\xe4nimi",onChange:function(e){a(e.target.value)},error:0!==n.length&&n.length<2,helperText:0!==n.length&&n.length<2?"Liian lyhyt":"K\xe4ytt\xe4j\xe4nimesi ei n\xe4y muille pelaajille.",required:!0})),o.a.createElement("div",null,o.a.createElement(Ie.a,{label:"Pelinimi",onChange:function(e){y(e.target.value)},helperText:"Nimi joka n\xe4kyy muille pelaajille.",required:!0})),o.a.createElement("div",null,o.a.createElement(Ie.a,{label:"Salasana",type:"password",onChange:function(e){d(e.target.value)},error:c.length<8&&""!==c,helperText:c.length<8&&""!==c?"Liian lyhyt":null,required:!0}),o.a.createElement("div",{style:{paddingTop:20,paddingBottom:10}},o.a.createElement("strong",null,"\xc4l\xe4 k\xe4yt\xe4 samaa salasanaa, joka sinulla on muilla nettisivuilla. "),"Olen vain opiskelija, ja t\xe4m\xe4 on ensimm\xe4inen nettiprojektini, joten en voi taata sivuston tietoturvallisuutta.")),o.a.createElement("div",null,o.a.createElement(Ie.a,{label:"Salasana uudelleen",type:"password",onChange:function(e){v(e.target.value)},error:b!==c,helperText:b!==c?"Salasanat eiv\xe4t vastaa toisiaan.":null,required:!0})),o.a.createElement("div",null,o.a.createElement(we.a,{variant:"contained",color:"primary",type:"submit"},"Luo k\xe4ytt\xe4j\xe4"))))},Me=n(201),$e=function(){var e=Object(r.useState)(null),t=Object(s.a)(e,2),n=t[0],a=t[1],i=Object(r.useContext)(ke).user,l=Object(g.a)(G,{onError:function(e){console.log(e.message)}}),c=Object(s.a)(l,2),u=c[0],d=c[1];return Object(r.useEffect)((function(){if(d.data){var e=d.data.createGame.id;a("".concat(window.location,"/").concat(e))}}),[d.data]),o.a.createElement("div",null,o.a.createElement(we.a,{onClick:function(){i?u():console.log("Sinun t\xe4ytyy kirjautua ennen kuin pelaat")}},"Peli linkin kautta"),n?o.a.createElement("div",null,"Jaa t\xe4m\xe4 linkki kaverillesi. Sen kautta p\xe4\xe4set pelaamaan.","  ",o.a.createElement(Me.a,{href:n},n)):null)},Ge=function(){var e=Object(r.useState)(null),t=Object(s.a)(e,2),n=t[0],a=t[1],i=Object(r.useState)(null),l=Object(s.a)(i,2),c=l[0],d=l[1],g=Object(m.a)(D,{variables:{token:window.sessionStorage.getItem("loggedChessUser")}});return Object(r.useEffect)((function(){g.data&&(g.data.getLoggedUser.guest?(a(g.data.getLoggedUser),window.sessionStorage.setItem("loggedChessUser",g.data.getLoggedUser.token)):a(g.data.getLoggedUser))}),[g.data]),o.a.createElement("div",null,o.a.createElement(ke.Provider,{value:{user:n,setUser:a}},o.a.createElement(De,null),n?o.a.createElement(u.c,null,o.a.createElement(u.a,{path:"/play/:id"},o.a.createElement(ye.Provider,{value:{gameId:c,setGameId:d}},o.a.createElement(Oe,null))),o.a.createElement(u.a,{path:"/play"},o.a.createElement(ye.Provider,{value:{gameId:c,setGameId:d}},o.a.createElement($e,null))),o.a.createElement(u.a,{path:"/login"},o.a.createElement(Ce,null)),o.a.createElement(u.a,{path:"/register"},o.a.createElement(Ne,null))):"loading",o.a.createElement(Se,null)))},Te=n(202),Ue=n(63),Qe=n(79),Ae=n(80),Ke=n(81),He=n(108),Je=n(132),Be=n(131),Re=n(133),Ve=Object(Je.a)((function(e,t){var n=t.headers,r=sessionStorage.getItem("loggedChessUser");return{headers:Object(a.a)(Object(a.a)({},n),{},{authorization:r?"bearer ".concat(r):null})}})),ze=window.location;C="https:"===ze.protocol?"wss:":"ws:",C+="//"+ze.host,console.log("".concat(C,"/graphql"));var Fe=new Ue.a({uri:"/graphql"}),We=new Re.a({uri:"".concat(C,"/graphql"),options:{reconnect:!0}}),Xe=Object(Qe.a)((function(e){var t=e.query,n=Object(Be.a)(t);return"OperationDefinition"===n.kind&&"subscription"===n.operation}),We,Ve.concat(Fe)),Ye=new Ae.a({cache:new Ke.a,link:Xe,connectToDevTools:!0});l.a.render(o.a.createElement(He.a,{client:Ye},o.a.createElement(Te.a,null,o.a.createElement(c.a,null,o.a.createElement(Ge,null)))),document.getElementById("root"))}},[[144,1,2]]]);
//# sourceMappingURL=main.37a05e74.chunk.js.map