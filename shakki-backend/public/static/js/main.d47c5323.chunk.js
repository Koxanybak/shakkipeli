(this["webpackJsonpshakki-frontend"]=this["webpackJsonpshakki-frontend"]||[]).push([[0],{125:function(e,t,a){e.exports=a.p+"static/media/blackking.66e1bcad.svg"},126:function(e,t,a){e.exports=a.p+"static/media/blackqueen.7b3e33e4.svg"},127:function(e,t,a){e.exports=a.p+"static/media/blackrook.96872a66.svg"},128:function(e,t,a){e.exports=a.p+"static/media/blackbishop.1f3b8d1a.svg"},129:function(e,t,a){e.exports=a.p+"static/media/blackknight.d39f1d02.svg"},130:function(e,t,a){e.exports=a.p+"static/media/blackpawn.1c52d8c4.svg"},131:function(e,t,a){e.exports=a.p+"static/media/whiteking.250510ff.svg"},132:function(e,t,a){e.exports=a.p+"static/media/whitequeen.4320a2dd.svg"},133:function(e,t,a){e.exports=a.p+"static/media/whiterook.095b1a06.svg"},134:function(e,t,a){e.exports=a.p+"static/media/whitebishop.09004fd2.svg"},135:function(e,t,a){e.exports=a.p+"static/media/whiteknight.e6294efe.svg"},136:function(e,t,a){e.exports=a.p+"static/media/whitepawn.d69014fb.svg"},151:function(e,t,a){e.exports=a(172)},172:function(e,t,a){"use strict";a.r(t);var n=a(41),r=a(0),o=a.n(r),i=a(19),c=a.n(i),l=a(51),s=a(211),u=a(210),m=a(59),d=function(){return o.a.createElement("div",{className:"footer"},"Student project for Full Stack open 2020. By using this site you accept the use of essential cookies.")},g=a(13),b=a(213),p=a(204),v=a(214),f=a(205),h=a(28),E=a(21);function k(){var e=Object(h.a)(["\n  mutation addUser($user: NewUserInput!) {\n    addUser(\n      user: $user\n    ) {\n      username\n      tag\n      id\n      friends {\n        tag\n      }\n    }\n  }\n"]);return k=function(){return e},e}function y(){var e=Object(h.a)(["\n  mutation login($username: String!, $password: String!) {\n    login(\n      username: $username,\n      password: $password\n    ) {\n      username\n      tag\n      friends {\n        tag\n      }\n      token\n      guest\n      id\n    }\n  }\n"]);return y=function(){return e},e}function j(){var e=Object(h.a)(["\n  query getLoggedUser($token: String) {\n    getLoggedUser(\n      token: $token\n    ) {\n      username\n      tag\n      friends {\n        tag\n      }\n      id\n      token\n      guest\n    }\n  }\n"]);return j=function(){return e},e}function w(){var e=Object(h.a)(["\n  mutation createGame {\n    createGame {\n      board {\n        type\n        side\n      }\n      id\n    }\n  }\n"]);return w=function(){return e},e}function O(){var e=Object(h.a)(["\n  mutation makeMove($move: MoveInput!) {\n    makeMove(\n      move: $move\n    ) {\n      lastMove {\n        success\n        message\n      }\n    }\n  }\n"]);return O=function(){return e},e}function S(){var e=Object(h.a)(["\n  mutation promote($gameId: String!, $pieceType: String!) {\n    promote(\n      gameId: $gameId,\n      pieceType: $pieceType\n    ) {\n      ...gameStateDetails\n    }\n  }\n  ","\n"]);return S=function(){return e},e}function L(){var e=Object(h.a)(["\n  mutation joinGame($gameId: String!) {\n    joinGame(\n      gameId: $gameId\n    ) {\n      ...gameStateDetails\n    }\n  }\n  ","\n"]);return L=function(){return e},e}function P(){var e=Object(h.a)(["\n  subscription gameStateUpdated($gameId: String!) {\n    gameStateUpdated(\n      gameId: $gameId\n    ) {\n      ...gameStateDetails\n    }\n  }\n  ","\n"]);return P=function(){return e},e}function x(){var e=Object(h.a)(["\n  mutation skipTurn($gameId: String!) {\n    skipTurn(\n      gameId: $gameId\n    ) {\n      ...gameStateDetails\n    }\n  }\n  ","\n"]);return x=function(){return e},e}function C(){var e=Object(h.a)(["\n  query getGame($gameId: String!) {\n    getGame(\n      gameId: $gameId\n    ) {\n      ...gameStateDetails\n    }\n  }\n  ","\n"]);return C=function(){return e},e}function I(){var e=Object(h.a)(["\n  fragment gameStateDetails on Game {\n    board {\n      ...idlePiece\n      id\n      availableMoves {\n        newLocation {\n          ...location\n        }\n      }\n    }\n    id\n    currentPlayer\n    whitePlayer\n    blackPlayer\n    winner\n    gameOver\n    promotionPlayerID\n    check {\n      threatenedPlayer\n      movesAvailable {\n        piece {\n          type\n          side\n        }\n        newLocation {\n          ...location\n        }\n      }\n    }\n    moveHistory {\n      ... on CastlingMove {\n        piece {\n          ...movedPiece\n        }\n        castledPiece {\n          ...movedPiece\n        }\n      }\n      ... on PromotionMove {\n        promotedPiece {\n          ...idlePiece\n        }\n        promotedTo\n      }\n      ... on OrdinaryMove {\n        piece {\n          ...movedPiece\n        }\n        pieceEaten {\n          ...idlePiece\n        }\n        newLocation {\n          ...location\n        }\n      }\n      ...moveHistoryEntry\n    }\n  }\n  ","\n  ","\n  ","\n  ","\n"]);return I=function(){return e},e}function M(){var e=Object(h.a)(["\n fragment moveHistoryEntry on MoveHistoryEntry {\n   leadToCheck\n   wonTheGame\n }\n"]);return M=function(){return e},e}function T(){var e=Object(h.a)(["\n  fragment movedPiece on Piece {\n    type\n    side\n    lastLocation {\n      ...location\n    }\n  }\n  ","\n"]);return T=function(){return e},e}function q(){var e=Object(h.a)(["\n  fragment idlePiece on Piece {\n    type\n    side\n    location {\n      ...location\n    }\n  }\n  ","\n"]);return q=function(){return e},e}function N(){var e=Object(h.a)(["\n  fragment location on Location {\n    row\n    column\n  }\n"]);return N=function(){return e},e}var U,D=Object(E.a)(N()),$=Object(E.a)(q(),D),Q=Object(E.a)(T(),D),H=Object(E.a)(M()),G=Object(E.a)(I(),D,$,Q,H),A=Object(E.a)(C(),G),K=Object(E.a)(x(),G),z=Object(E.a)(P(),G),B=Object(E.a)(L(),G),_=Object(E.a)(S(),G),W=Object(E.a)(O()),F=Object(E.a)(w()),V=Object(E.a)(j()),J=Object(E.a)(y()),R=Object(E.a)(k()),Y=a(116),X=a(112),Z=a(113),ee=a(117),te=a(114),ae=function(e){e.graphQLErrors&&e.graphQLErrors[0]?(console.log(e.graphQLErrors[0].message),e.graphQLErrors[0].stack&&console.log(e.graphQLErrors[0].stack)):(console.log(e.message),e.stack&&console.log(e.stack))},ne=function(){var e=Object(X.a)(),t=Object(r.useState)(null),a=Object(g.a)(t,2),n=a[0],o=a[1],i=Object(te.a)(V,{variables:{token:window.localStorage.getItem("loggedChessUser")?window.localStorage.getItem("loggedChessUser"):window.sessionStorage.getItem("loggedChessUser")},onCompleted:function(e){b(e.getLoggedUser)},onError:function(e){ae(e)}}),c=Object(g.a)(i,1)[0],l=Object(Z.a)(V,{variables:{token:window.localStorage.getItem("loggedChessUser")?window.localStorage.getItem("loggedChessUser"):window.sessionStorage.getItem("loggedChessUser")},onError:function(e){ae(e)}}),s=l.loading,u=l.data,m=l.error,d=Object(r.useCallback)((function(){console.log("logged out"),window.localStorage.removeItem("loggedChessUser"),window.sessionStorage.removeItem("loggedChessUser"),o(null),c()}),[c]),b=Object(r.useCallback)((function(t,a){var n={getLoggedUser:t};a&&(console.log("localStorageen meni"),window.localStorage.setItem("loggedChessUser",t.token)),window.sessionStorage.setItem("loggedChessUser",t.token),e.writeQuery({query:V,data:n,variables:{token:t.token}})}),[e]);Object(r.useEffect)((function(){u&&(b(u.getLoggedUser),o(u.getLoggedUser.token))}),[u,b]);var p=null;return s||m||!n||(p=e.readQuery({query:V,variables:{token:n}})),{user:s||m||!n?null:p.getLoggedUser,userLoading:s,userError:m,setUser:b,removeUser:d}},re=function(){var e=Object(r.useState)(""),t=Object(g.a)(e,2),a=t[0],n=t[1],i=Object(r.useState)(""),c=Object(g.a)(i,2),l=c[0],s=c[1],u=Object(r.useState)(!0),d=Object(g.a)(u,2),h=d[0],E=d[1],k=ne().setUser,y=Object(m.f)(),j=Object(Y.a)(J,{onError:function(e){e.graphQLErrors&&e.graphQLErrors[0]?console.log(e.graphQLErrors[0].message):console.log(e.message),s("")}}),w=Object(g.a)(j,2),O=w[0],S=w[1];return Object(r.useEffect)((function(){S.data&&(n(""),s(""),k(S.data.login,h),y.push("/"))}),[S.data,k,y,h]),o.a.createElement("div",null,o.a.createElement("h2",null,"Kirjaudu sis\xe4\xe4n"),o.a.createElement("form",{onSubmit:function(e){e.preventDefault(),O({variables:{username:a,password:l}})}},o.a.createElement("div",null,o.a.createElement(b.a,{label:"K\xe4ytt\xe4j\xe4nimi",onChange:function(e){n(e.target.value)},name:"username"})),o.a.createElement("div",null,o.a.createElement(b.a,{label:"Salasana",type:"password",onChange:function(e){s(e.target.value)},name:"password"})),o.a.createElement("div",null,o.a.createElement(p.a,{control:o.a.createElement(v.a,{checked:h,onChange:function(){return E(!h)},name:"rememberMe",color:"primary"}),label:"Muista minut"})),o.a.createElement("div",null,o.a.createElement(f.a,{variant:"contained",color:"primary",type:"submit"},"Kirjaudu"))),o.a.createElement("div",null,"tai"),o.a.createElement("div",null,o.a.createElement(f.a,{variant:"contained",color:"primary",onClick:function(){return y.push("/register")}},"Luo uusi k\xe4ytt\xe4j\xe4")))},oe=a(206),ie=a(207),ce=function(){return o.a.createElement(oe.a,{position:"static"},o.a.createElement(ie.a,null,o.a.createElement(f.a,{color:"inherit",component:l.b,to:"/play"},"Pelaa"),o.a.createElement(f.a,{color:"inherit",component:l.b,to:"/info"},"Ohjeet")))},le=function(){var e=Object(r.useState)(""),t=Object(g.a)(e,2),a=t[0],n=t[1],i=Object(r.useState)(""),c=Object(g.a)(i,2),l=c[0],s=c[1],u=Object(r.useState)(""),d=Object(g.a)(u,2),p=d[0],v=d[1],h=Object(r.useState)(""),E=Object(g.a)(h,2),k=E[0],y=E[1],j=Object(m.f)(),w=Object(Y.a)(R,{onError:function(e){console.log(e.graphQLErrors[0].message),window.alert(e.graphQLErrors[0].message)}}),O=Object(g.a)(w,2),S=O[0],L=O[1];return Object(r.useEffect)((function(){L.data&&(n(""),s(""),y(""),window.alert("K\xe4ytt\xe4j\xe4 luotu onnistuneesti."),j.push("/"))}),[L.data,j]),o.a.createElement("div",null,o.a.createElement("h2",null,"Luo uusi k\xe4ytt\xe4j\xe4"),o.a.createElement("form",{onSubmit:function(e){e.preventDefault(),S({variables:{user:{username:a,password:l,tag:k}}})}},o.a.createElement("div",null,o.a.createElement(b.a,{label:"K\xe4ytt\xe4j\xe4nimi",onChange:function(e){n(e.target.value)},error:0!==a.length&&a.length<2,helperText:0!==a.length&&a.length<2?"Liian lyhyt":"K\xe4ytt\xe4j\xe4nimesi ei n\xe4y muille pelaajille.",required:!0})),o.a.createElement("div",null,o.a.createElement(b.a,{label:"Pelinimi",onChange:function(e){y(e.target.value)},helperText:"Nimi joka n\xe4kyy muille pelaajille.",required:!0})),o.a.createElement("div",null,o.a.createElement(b.a,{label:"Salasana",type:"password",onChange:function(e){s(e.target.value)},error:l.length<8&&""!==l,helperText:l.length<8&&""!==l?"Liian lyhyt":null,required:!0}),o.a.createElement("div",{style:{paddingTop:20,paddingBottom:10}},o.a.createElement("strong",null,"\xc4l\xe4 k\xe4yt\xe4 samaa salasanaa, joka sinulla on muilla nettisivuilla. "),"Olen vain opiskelija, ja t\xe4m\xe4 on ensimm\xe4inen nettiprojektini, joten en voi taata sivuston tietoturvallisuutta.")),o.a.createElement("div",null,o.a.createElement(b.a,{label:"Salasana uudelleen",type:"password",onChange:function(e){v(e.target.value)},error:p!==l,helperText:p!==l?"Salasanat eiv\xe4t vastaa toisiaan.":null,required:!0})),o.a.createElement("div",null,o.a.createElement(f.a,{variant:"contained",color:"primary",type:"submit"},"Luo k\xe4ytt\xe4j\xe4"))))},se=a(174),ue=a(208),me=function(){var e=Object(r.useState)(null),t=Object(g.a)(e,2),a=t[0],n=t[1],i=ne().user,c=Object(Y.a)(F,{onError:function(e){e.graphQLErrors&&e.graphQLErrors[0]?console.log(e.graphQLErrors[0].message):console.log(e.message)}}),l=Object(g.a)(c,2),s=l[0],u=l[1];return Object(r.useEffect)((function(){if(u.data){var e=u.data.createGame.id;n("".concat(window.location,"/").concat(e))}}),[u.data]),o.a.createElement("div",null,o.a.createElement(f.a,{variant:"contained",onClick:function(){i?s():console.log("Sinun t\xe4ytyy kirjautua ennen kuin pelaat")}},"Peli linkin kautta"),a?o.a.createElement(se.a,{style:{background:"linear-gradient(135deg, rgb(".concat("29, 240, 201","), rgb(").concat("25, 145, 123","))"),padding:10}},"Jaa t\xe4m\xe4 linkki kaverillesi. Sen kautta p\xe4\xe4set pelaamaan.","  ",o.a.createElement(ue.a,{href:a},a)):null)},de=a(106),ge=a.n(de),be=a(124),pe=a(125),ve=a.n(pe),fe=a(126),he=a.n(fe),Ee=a(127),ke=a.n(Ee),ye=a(128),je=a.n(ye),we=a(129),Oe=a.n(we),Se=a(130),Le=a.n(Se),Pe=a(131),xe=a.n(Pe),Ce=a(132),Ie=a.n(Ce),Me=a(133),Te=a.n(Me),qe=a(134),Ne=a.n(qe),Ue=a(135),De=a.n(Ue),$e=a(136),Qe=a.n($e),He={width:65,height:65,verticalAlign:"middle"},Ge=function(e,t){return"king"===e&&"black"===t?ve.a:"queen"===e&&"black"===t?he.a:"bishop"===e&&"black"===t?je.a:"rook"===e&&"black"===t?ke.a:"knight"===e&&"black"===t?Oe.a:"pawn"===e&&"black"===t?Le.a:"king"===e&&"white"===t?xe.a:"queen"===e&&"white"===t?Ie.a:"bishop"===e&&"white"===t?Ne.a:"rook"===e&&"white"===t?Te.a:"knight"===e&&"white"===t?De.a:"pawn"===e&&"white"===t?Qe.a:void 0},Ae=function(e){var t=e.style,a=e.id,i=e.side,c=e.type,l=Object(r.useState)(1),s=Object(g.a)(l,1)[0];return o.a.createElement("img",{style:Object(n.a)(Object(n.a)({},t),{},{opacity:s}),className:"piece",draggable:"false",type:a,side:i,id:a,src:Ge(c,i),alt:"sprite"})},Ke=function(e){var t=e.side,a=e.id,r=Object(n.a)({},He);return o.a.createElement(Ae,{style:r,id:a,side:t,type:"king"},"K")},ze=function(e){var t=e.side,a=e.id,r=Object(n.a)({},He);return o.a.createElement(Ae,{style:r,id:a,side:t,type:"queen"},"D")},Be=function(e){var t=e.side,a=e.id,r=Object(n.a)({},He);return o.a.createElement(Ae,{style:r,id:a,side:t,type:"rook"},"T")},_e=function(e){var t=e.side,a=e.id,r=Object(n.a)({},He);return o.a.createElement(Ae,{style:r,id:a,side:t,type:"knight"},"R")},We=function(e){var t=e.side,a=e.id,r=Object(n.a)({},He);return o.a.createElement(Ae,{style:r,id:a,side:t,type:"bishop"},"L")},Fe=function(e){var t=e.side,a=e.id,r=Object(n.a)({},He);return o.a.createElement(Ae,{style:r,id:a,side:t,type:"pawn"},"S")},Ve=function(e){var t=e.color,a=(e.makeMove,e.location),n=e.piece,i=(e.dragHelperMap,e.id),c=e.highlight,l=Object(r.useMemo)((function(){return"rgb(".concat("white"===t?"29, 240, 201":"25, 145, 123",")")}),[t]),s=Object(r.useState)(l),u=Object(g.a)(s,2),m=u[0],d=u[1];Object(r.useEffect)((function(){d(c?"rgb(".concat("17, 209, 97",")"):l)}),[c,l]);var b,p={height:70,width:70,backgroundColor:m,textAlign:"center",background:"radial-gradient(".concat(m,", ").concat(l,")")};if(n)switch(n.type){case"pawn":b=o.a.createElement(Fe,{side:n.side,id:8*a.row+a.column});break;case"rook":b=o.a.createElement(Be,{side:n.side,id:8*a.row+a.column});break;case"knight":b=o.a.createElement(_e,{side:n.side,id:8*a.row+a.column});break;case"bishop":b=o.a.createElement(We,{side:n.side,id:8*a.row+a.column});break;case"queen":b=o.a.createElement(ze,{side:n.side,id:8*a.row+a.column});break;case"king":b=o.a.createElement(Ke,{side:n.side,id:8*a.row+a.column});break;default:b=null}return b?o.a.createElement("td",{id:i,style:p,className:"square"},b):o.a.createElement("td",{id:i,style:p,className:"square"})},Je=function(e){var t=e.boardAlignment,a=e.board,n=e.makeMove,r=e.handleClick,i=e.chosenPiece,c=new Map;a.forEach((function(e,t){e.forEach((function(e,a){c.set(8*t+a,e)}))}));var l=Array.from(Array(8),(function(e,t){for(var a=new Array(8),n=0;n<8;n++)a[n]=(t+n)%2===0?{piece:null,color:"white"}:{piece:null,color:"black"};return a})),s={height:560,width:560,borderStyle:"solid",borderColor:"black",borderWidth:"2px",background:"cyan"};return o.a.createElement("table",{className:"board",onClick:r,cellSpacing:"0",style:s},o.a.createElement("tbody",null,"white"===t?a.map((function(e,t){return o.a.createElement("tr",{key:t},o.a.createElement("td",null,8-t),e.map((function(e,a){var r=!1;return i&&(i.availableMoves.forEach((function(e){e.newLocation.row===t&&e.newLocation.column===a&&(r=!0)})),i.location.row===t&&i.location.column===a&&(r=!0)),o.a.createElement(Ve,{key:8*t+a,id:8*t+a,color:l[t][a].color,makeMove:n,location:{row:t,column:a},piece:e,dragHelperMap:c,highlight:r})})))})):a.map((function(e,t){return o.a.createElement("tr",{key:t},o.a.createElement("td",null,t+1),e.map((function(e,r){var s=!1;return i&&(i.availableMoves.forEach((function(e){e.newLocation.row===7-t&&e.newLocation.column===7-r&&(s=!0)})),i.location.row===7-t&&i.location.column===7-r&&(s=!0)),o.a.createElement(Ve,{key:8*(7-t)+(7-r),id:8*(7-t)+(7-r),color:l[7-t][7-r].color,makeMove:n,location:{row:7-t,column:7-r},piece:a[7-t][7-r],dragHelperMap:c,highlight:s})})))})),"white"===t?o.a.createElement("tr",null,o.a.createElement("td",null),o.a.createElement("td",null,"A"),o.a.createElement("td",null,"B"),o.a.createElement("td",null,"C"),o.a.createElement("td",null,"D"),o.a.createElement("td",null,"E"),o.a.createElement("td",null,"F"),o.a.createElement("td",null,"G"),o.a.createElement("td",null,"H")):o.a.createElement("tr",null,o.a.createElement("td",null),o.a.createElement("td",null,"H"),o.a.createElement("td",null,"G"),o.a.createElement("td",null,"F"),o.a.createElement("td",null,"E"),o.a.createElement("td",null,"D"),o.a.createElement("td",null,"C"),o.a.createElement("td",null,"B"),o.a.createElement("td",null,"A"))))},Re=a(209),Ye=a(140),Xe=Object(Re.a)({turnText:{background:"linear-gradient(135deg, rgb(".concat("29, 240, 201","), rgb(").concat("25, 145, 123","))"),padding:10,height:"8vh",width:"40vh",textAlign:"center"}}),Ze=function(e){var t=e.game,a=t.check,n=t.currentPlayer,i=t.gameOver,c=t.promotionPlayerID,l=t.winner,s=t.blackPlayer,u=e.promote,m=ne(),d=m.user,b=m.userLoading,p=Object(r.useState)("Odotetaan, ett\xe4 vastustaja liityy peliin."),v=Object(g.a)(p,2),h=v[0],E=v[1],k=Object(r.useState)(!1),y=Object(g.a)(k,2),j=y[0],w=y[1],O=Xe();return Object(r.useEffect)((function(){d&&(s?i?(l===d.id?E("Voitit pelin! Onneksi olkoon!"):E("Ootko paska ku h\xe4visit :D"),w(!0)):d.id===n?(a&&a.threatenedPlayer===d.id?E("On sinun vuorosi. Shakki!"):E("On sinun vuorosi."),w(!0)):(a&&a.threatenedPlayer!==d.id?E("Odotetaan vastustajan siirtoa. Shakki!"):E("Odotetaan vastustajan siirtoa."),w(!1)):(w(!1),E("Odotetaan, ett\xe4 vastustaja liityy peliin.")))}),[E,s,i,n,d,l,a]),b?"loading...":o.a.createElement("div",{className:"gameText"},o.a.createElement(se.a,{className:O.turnText},o.a.createElement(Ye.a,{variant:j?"h4":"subtitle1"},h)),o.a.createElement("div",null,d.id===c?o.a.createElement("div",null,"Valitse nappula, joksi haluat muuttaa sotilaan"," ",o.a.createElement(f.a,{onClick:function(){return u("queen")}},"Kuningatar"),o.a.createElement(f.a,{onClick:function(){return u("knight")}},"Ratsu")):null))},et=function(e){return 0===e.column?"A".concat(8-e.row):1===e.column?"B".concat(8-e.row):2===e.column?"C".concat(8-e.row):3===e.column?"D".concat(8-e.row):4===e.column?"E".concat(8-e.row):5===e.column?"F".concat(8-e.row):6===e.column?"G".concat(8-e.row):7===e.column?"H".concat(8-e.row):"ErrorLocation"},tt=function(e){var t=e.move,a=e.emphasize,n={borderLeftStyle:"solid",borderColor:"blue",borderWidth:"1px",borderLeftWidth:"10px",padding:10,background:"cyan"},r={borderLeftStyle:"solid",borderColor:"blue",borderWidth:"1px",borderLeftWidth:"5px",margin:5,background:"cyan"},i=a?{height:60,width:60}:void 0;return"OrdinaryMove"===t.__typename?o.a.createElement(se.a,{style:a?n:r},o.a.createElement("img",{style:i,className:"piece",draggable:"false",src:Ge(t.piece.type,t.piece.side),alt:t.piece.type}),et(t.newLocation)):"CastlingMove"===t.__typename?o.a.createElement(se.a,{style:a?n:r},"Tornitus"):"PromotionMove"===t.__typename?o.a.createElement(se.a,{style:a?n:r},et(t.promotedPiece.location),o.a.createElement("img",{style:i,className:"piece",draggable:"false",src:Ge(t.promotedPiece.type,t.promotedPiece.side),alt:t.promotedPiece.type}),"---\x3e",o.a.createElement("img",{style:i,className:"piece",draggable:"false",src:Ge(t.promotedTo,t.promotedPiece.side),alt:t.promotedPiece.type})):o.a.createElement(se.a,null,"Error")},at=function(e){var t=e.moveHistory;return o.a.createElement("div",{className:"moveHistory",style:{overflowY:"scroll",height:350}},t.map((function(e,a){return e=t[t.length-1-a],0!==a?o.a.createElement(tt,{move:e,key:a}):null})))},nt=function(e){var t=e.moveHistory,a=Object(r.useState)(!1),n=Object(g.a)(a,2),i=n[0],c=n[1],l={background:"linear-gradient(135deg, rgb(".concat("29, 240, 201","), rgb(").concat("25, 145, 123","))"),padding:"20px"};if(0===t.length)return o.a.createElement(se.a,{style:l},o.a.createElement(Ye.a,{variant:"subtitle2"},"Siirtoja ei ole viel\xe4 tehty"));var s=t[t.length-1];return o.a.createElement(se.a,{style:l},o.a.createElement(Ye.a,{variant:"h5"},"Viimeisin siirto"),o.a.createElement(tt,{move:s,emphasize:!0}),o.a.createElement(f.a,{variant:"contained",onClick:function(){return c(!i)},color:"primary"},"N\xe4yt\xe4 kaikki siirrot"),i?o.a.createElement(at,{moveHistory:t}):null)},rt=function(e){var t=e.squareNode,a=e.pieceToMove,n=e.clickedPiece,r=e.game,o=e.user;return t.style.background!=="radial-gradient(rgb(".concat("17, 209, 97","), rgb(").concat("25, 145, 123","))")&&t.style.background!=="radial-gradient(rgb(".concat("17, 209, 97","), rgb(").concat("29, 240, 201","))")||n&&n.id===a.id||r.gameOver||r.promotionPlayerID||o.id!==r.currentPlayer},ot=function(e){var t=e.clickedPiece,a=e.game,n=e.user;return n.id===a.currentPlayer&&t.side===(a.whitePlayer===n.id?"white":"black")&&!a.promotionPlayerID&&!a.gameOver},it=function(e){var t=e.skipTurn,a=e.disabled,n=Object(r.useState)(!1),i=Object(g.a)(n,2),c=i[0],l=i[1],s={background:"linear-gradient(135deg, rgb(".concat("29, 240, 201","), rgb(").concat("25, 145, 123","))"),padding:"20px"};return o.a.createElement(se.a,{style:s},c?o.a.createElement("div",null,o.a.createElement(Ye.a,{variant:"subtitle2"},"Vahvista ohitus?"),o.a.createElement(f.a,{variant:"outlined",size:"small",onClick:function(){t(),l(!1)},disabled:a},"Ohita"),o.a.createElement(f.a,{variant:"outlined",size:"small",onClick:function(){l(!1)}},"Peruuta")):o.a.createElement(f.a,{variant:"outlined",size:"small",onClick:function(){return l(!0)},disabled:a},"Ohita vuoro"))},ct=Object(Re.a)({game:{}}),lt=function(){var e=function(){var e=Object(X.a)(),t=Object(m.g)().id,a=function(a){var n=e.readQuery({query:A,variables:{gameId:t}});n={getGame:a.gameStateUpdated},e.writeQuery({query:A,data:n,variables:{id:t}})},n=Object(Z.a)(A,{variables:{gameId:t},onError:function(e){ae(e)}}),o=Object(Y.a)(W),i=Object(g.a)(o,1)[0],c=Object(Y.a)(_),l=Object(g.a)(c,1)[0],s=Object(Y.a)(K,{variables:{gameId:t},onError:function(e){ae(e)}}),u=Object(g.a)(s,1)[0],d=Object(Y.a)(B,{variables:{gameId:t},onError:function(e){ae(e)},onCompleted:function(e){a(e)}}),b=Object(g.a)(d,1)[0];Object(ee.a)(z,{onSubscriptionData:function(e){var t=e.subscriptionData;a(t.data)},variables:{gameId:t}}),Object(r.useEffect)((function(){b()}),[b]);return{game:n.loading||n.error?null:n.data.getGame,gameLoading:n.loading,gameError:n.error,promote:function(e){l({variables:{gameId:t,pieceType:e}})},makeMove:function(e){var a=e.piece,n=e.oldLocation,r=e.newLocation;return i({variables:{move:{piece:a,oldLocation:n,newLocation:r,gameId:t}}})},skipTurn:u}}(),t=e.game,a=e.gameLoading,n=e.gameError,i=e.makeMove,c=e.promote,l=e.skipTurn,d=ne(),b=d.user,p=d.userLoading,v=Object(r.useState)(null),f=Object(g.a)(v,2),h=f[0],E=f[1],k=ct();if(a||p)return o.a.createElement(u.a,null);if(!t)return n.toString();var y=t.board,j=t.whitePlayer,w=t.moveHistory,O=t.currentPlayer,S=t.promotionPlayerID,L=t.check,P=t.blackPlayer,x=function(){var e=Object(be.a)(ge.a.mark((function e(a){var n,r,o,c,l,s,u,m,d,g,p,v;return ge.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.preventDefault(),"piece"!==(n=a.target).className){e.next=27;break}if(r=y[Math.floor(Number(n.id)/8)][Number(n.id)%8],!h){e.next=24;break}if(!rt({squareNode:n.parentNode,pieceToMove:h,clickedPiece:r,user:b,game:t})){e.next=8;break}return E(null),e.abrupt("return");case 8:return o={type:h.type,side:h.side},c={row:h.location.row,column:h.location.column},l={row:r.location.row,column:r.location.column},e.prev=11,e.next=14,i({piece:o,oldLocation:c,newLocation:l});case 14:(s=e.sent).data.makeMove.lastMove.success||console.log(s.data.makeMove.lastMove.message),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),ae(e.t0);case 21:E(null),e.next=25;break;case 24:ot({clickedPiece:r,game:t,user:b})&&E(r);case 25:e.next=54;break;case 27:if("square"!==n.className){e.next=53;break}if((u=n.firstChild)&&(m=y[Math.floor(Number(u.id)/8)][Number(u.id)%8]),!h){e.next=50;break}if(!rt({squareNode:n,pieceToMove:h,clickedPiece:m,user:b,game:t})){e.next=34;break}return E(null),e.abrupt("return");case 34:return d={type:h.type,side:h.side},g={row:h.location.row,column:h.location.column},p={row:Math.floor(Number(n.id)/8),column:Number(n.id)%8},e.prev=37,e.next=40,i({piece:d,oldLocation:g,newLocation:p});case 40:(v=e.sent).data.makeMove.lastMove.success||console.log(v.data.makeMove.lastMove.message),e.next=47;break;case 44:e.prev=44,e.t1=e.catch(37),ae(e.t1);case 47:E(null),e.next=51;break;case 50:m&&ot({clickedPiece:m,game:t,user:b})&&E(m);case 51:e.next=54;break;case 53:E(null);case 54:case"end":return e.stop()}}),e,null,[[11,18],[37,44]])})));return function(t){return e.apply(this,arguments)}}();return o.a.createElement(s.a,{container:!0,direction:"row",justify:"center",className:k.game,spacing:2,wrap:"wrap"},o.a.createElement(s.a,{item:!0,xs:3,lg:2},o.a.createElement(it,{skipTurn:l,disabled:b.id!==O||null!==S||null!==L||null===j||null===P})),o.a.createElement(s.a,{container:!0,item:!0,xs:10,lg:6,direction:"column",alignItems:"center"},o.a.createElement(Je,{board:y,boardAlignment:b.id===j?"white":"black",makeMove:i,handleClick:x,chosenPiece:h}),o.a.createElement(Ze,{game:t,promote:c})),o.a.createElement(s.a,{item:!0,xs:3,lg:3},o.a.createElement(nt,{moveHistory:w})))},st=a(212),ut=Object(Re.a)({root:{height:"100%"}}),mt=function(){var e=ne().user,t=ut();return o.a.createElement(st.a,{classes:t},o.a.createElement(s.a,{container:!0,direction:"column",alignItems:"center",justify:"space-between",classes:t,wrap:"nowrap"},o.a.createElement(ce,null),e?o.a.createElement(m.c,null,o.a.createElement(m.a,{path:"/play/:id"},o.a.createElement(lt,null)),o.a.createElement(m.a,{path:"/play"},o.a.createElement(me,null)),o.a.createElement(m.a,{path:"/login"},o.a.createElement(re,null)),o.a.createElement(m.a,{path:"/register"},o.a.createElement(le,null))):o.a.createElement(u.a,null),o.a.createElement(d,null)))},dt=a(67),gt=a(85),bt=a(86),pt=a(87),vt=a(115),ft=a(138),ht=a(137),Et=a(139),kt=Object(ft.a)((function(e,t){var a=t.headers,r=sessionStorage.getItem("loggedChessUser");return{headers:Object(n.a)(Object(n.a)({},a),{},{authorization:r?"bearer ".concat(r):null})}})),yt=window.location;U="https:"===yt.protocol?"wss:":"ws:",U+="//"+yt.host,console.log("".concat(U,"/graphql"));var jt=new dt.a({uri:"/graphql"}),wt=new Et.a({uri:"".concat(U,"/graphql"),options:{reconnect:!0}}),Ot=Object(gt.a)((function(e){var t=e.query,a=Object(ht.a)(t);return"OperationDefinition"===a.kind&&"subscription"===a.operation}),wt,kt.concat(jt)),St=new bt.a({cache:new pt.a,link:Ot,connectToDevTools:!0});c.a.render(o.a.createElement(vt.a,{client:St},o.a.createElement(l.a,null,o.a.createElement(mt,null))),document.getElementById("root"))}},[[151,1,2]]]);
//# sourceMappingURL=main.d47c5323.chunk.js.map