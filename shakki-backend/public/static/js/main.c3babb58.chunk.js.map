{"version":3,"sources":["sprites/blackking.svg","sprites/blackqueen.svg","sprites/blackrook.svg","sprites/blackbishop.svg","sprites/blackknight.svg","sprites/blackpawn.svg","sprites/whiteking.svg","sprites/whitequeen.svg","sprites/whiterook.svg","sprites/whitebishop.svg","sprites/whiteknight.svg","sprites/whitepawn.svg","components/Footer.js","queries.js","utils/errorHandlers.js","utils/context.js","utils/stateHooks.js","components/LoginForm.js","components/Feedback.js","components/AddFriendDialog.js","components/ProfileDrawer.js","index.js","components/Menu.js","components/RegisterForm.js","utils/constants.js","components/GameMenu.js","components/chess/pieces.js","components/chess/Square.js","components/chess/Board.js","components/chess/GameText.js","components/chess/LastMove.js","components/chess/gameUtils.js","components/chess/GameButtons.js","components/chess/Game.js","App.js"],"names":["module","exports","Footer","className","Paper","LOCATION","gql","IDLE_PIECE","MOVED_PIECE","MOVE_HISTORY_ENTRY","GAME_STATE_DETAILS","GET_GAME","SKIP_TURN","GAME_STATE_UPDATED","JOIN_GAME","PROMOTE","MAKE_MOVE","CREATE_GAME","REQUEST_DETAILS","INVITE_DETAILS","USER_DETAILS","GET_LOGGED_USER","LOGIN","ADD_USER","REQUEST_RECEIVED","REQUEST_ACCEPTED","SEND_FRIEND_REQUEST","ACCEPT_FRIEND_REQUEST","DECLINE_FRIEND_REQUEST","REMOVE_FRIEND","INVITE_RECEIVED","INVITE_RESOLVED","SEND_GAME_INVITE","RESOLVE_GAME_INVITE","handleApolloError","err","graphQLErrors","console","log","message","stack","FeedbackContext","React","createContext","useUser","client","useApolloClient","useState","token","setToken","useLazyQuery","variables","window","localStorage","getItem","sessionStorage","onCompleted","data","setUser","getLoggedUser","onError","useQuery","loading","error","removeUser","useCallback","a","removeItem","cache","reset","user","remember","newUserData","setItem","writeQuery","query","useEffect","userDataInStore","readQuery","userLoading","userError","useFriends","history","useHistory","addFriend","req","fromMutation","sentRequests","filter","r","id","receivedRequests","friends","find","f","tag","to","concat","from","setReceivedInvs","invList","receivedInvites","setSentInvs","sentInvites","useSubscription","userId","onSubscriptionComplete","onSubscriptionData","subscriptionData","addRecReq","requestReceived","requestAccepted","useMutation","addSentReq","sendFriendRequest","sendReq","sendReqData","acceptFriendRequest","acceptReq","acceptReqData","removeRecReq","declineFriendRequest","declineReq","declineReqData","removeFriend","inviteReceived","inv","inviteResolved","resolveStatus","push","game","sendGameInvite","sendGameInv","resolveGameInvite","resolveGameInv","LoginForm","username","setUsername","password","setPassword","setRemember","setFeedback","useContext","severity","login","loginResult","location","reload","style","padding","onSubmit","event","preventDefault","TextField","label","value","onChange","e","target","name","type","FormControlLabel","control","Checkbox","checked","color","Button","variant","onClick","Feedback","feedback","Snackbar","open","autoHideDuration","onClose","Alert","AddFriendDialog","forwardRef","ref","setOpen","setTag","useImperativeHandle","Dialog","DialogTitle","DialogContent","DialogContentText","DialogActions","displayName","ProfileDrawer","_","show","setShow","friendRef","createRef","openDrawer","sendInvite","resolveInvite","accepted","guest","Fragment","SwipeableDrawer","onOpen","anchor","width","List","ListItem","ListItemText","primary","Divider","length","map","key","secondary","IconButton","requestId","Check","Close","SportsEsports","button","component","Link","ListItemIcon","ExitToApp","current","PersonAdd","wsUri","Menu","profileDrawerRef","AppBar","position","Toolbar","Grid","container","alignItems","justify","item","Typography","Badge","badgeContent","AccountCircle","RegisterForm","confirmation","setConfirmation","alert","addUser","addedResult","background","helperText","required","paddingTop","paddingBottom","GameMenu","link","setLink","createGame","createResult","href","pieceStyle","height","verticalAlign","getImgSrc","side","blackKing","blackQueen","blackBishop","blackRook","blackKnight","blackPawn","whiteKing","whiteQueen","whiteBishop","whiteRook","whiteKnight","whitePawn","Piece","opacity","draggable","src","alt","King","kingStyle","Queen","queenStyle","Rook","rookStyle","Knight","knightStyle","Bishop","bishopStyle","Pawn","pawnStyle","Square","makeMove","piece","dragHelperMap","highlight","specificColor","useMemo","squareColor","setSquareColor","pieceToRender","squareStyle","backgroundColor","textAlign","row","column","Board","boardAlignment","board","handleClick","chosenPiece","Map","forEach","i","j","set","squares","Array","boardStyle","SQUARE_SIZE","borderStyle","borderColor","borderWidth","cellSpacing","availableMoves","move","newLocation","useStyles","makeStyles","turnText","GameText","check","currentPlayer","gameOver","promotionPlayerID","winner","blackPlayer","promote","text","setText","emphasize","setEmphasize","classes","threatenedPlayer","getLocation","Move","emphasizeStyle","borderLeftStyle","borderLeftWidth","moveStyle","margin","undefined","__typename","promotedPiece","promotedTo","MoveHistory","moveHistory","overflowY","index","LastMove","showAll","setShowAll","lastMove","isNotValid","squareNode","pieceToMove","clickedPiece","includes","isValidPiece","whitePlayer","GameButtons","skipTurn","disabled","showSkipConfirm","setShowSkipConfirm","size","Game","useParams","setGame","newGameData","gameDataInStore","gameId","getGame","gameStateUpdated","initialResult","joinGame","gameLoading","gameError","pieceType","oldLocation","useGame","setPieceToMove","CircularProgress","toString","clickedElem","Math","floor","Number","parentNode","res","success","clickedPieceElem","firstChild","direction","spacing","wrap","xs","lg","root","App","Provider","Container","path","authLink","setContext","headers","authorization","loc","protocol","host","httpLink","HttpLink","uri","wsLink","WebSocketLink","options","reconnect","connectionParams","authToken","splitLink","split","definition","getMainDefinition","kind","operation","ApolloClient","InMemoryCache","connectToDevTools","ReactDOM","render","ApolloProvider","document","getElementById"],"mappings":"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","file":"static/js/main.c3babb58.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/blackking.66e1bcad.svg\";","module.exports = __webpack_public_path__ + \"static/media/blackqueen.7b3e33e4.svg\";","module.exports = __webpack_public_path__ + \"static/media/blackrook.96872a66.svg\";","module.exports = __webpack_public_path__ + \"static/media/blackbishop.1f3b8d1a.svg\";","module.exports = __webpack_public_path__ + \"static/media/blackknight.d39f1d02.svg\";","module.exports = __webpack_public_path__ + \"static/media/blackpawn.1c52d8c4.svg\";","module.exports = __webpack_public_path__ + \"static/media/whiteking.250510ff.svg\";","module.exports = __webpack_public_path__ + \"static/media/whitequeen.4320a2dd.svg\";","module.exports = __webpack_public_path__ + \"static/media/whiterook.095b1a06.svg\";","module.exports = __webpack_public_path__ + \"static/media/whitebishop.09004fd2.svg\";","module.exports = __webpack_public_path__ + \"static/media/whiteknight.e6294efe.svg\";","module.exports = __webpack_public_path__ + \"static/media/whitepawn.d69014fb.svg\";","import React from \"react\"\r\nimport { Paper } from \"@material-ui/core\"\r\n\r\nconst Footer = () => {\r\n  return (\r\n    <div className=\"footer\">\r\n      <Paper>\r\n        Student project for Full Stack open 2020. By using this site you accept the use of essential cookies.\r\n      </Paper>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Footer","import { gql } from \"@apollo/client\"\r\n\r\n\r\n// fragments\r\nconst LOCATION = gql`\r\n  fragment location on Location {\r\n    row\r\n    column\r\n  }\r\n`\r\n\r\nconst IDLE_PIECE = gql`\r\n  fragment idlePiece on Piece {\r\n    type\r\n    side\r\n    location {\r\n      ...location\r\n    }\r\n  }\r\n  ${LOCATION}\r\n`\r\n\r\nconst MOVED_PIECE = gql`\r\n  fragment movedPiece on Piece {\r\n    type\r\n    side\r\n    lastLocation {\r\n      ...location\r\n    }\r\n  }\r\n  ${LOCATION}\r\n`\r\n\r\nconst MOVE_HISTORY_ENTRY = gql`\r\n fragment moveHistoryEntry on MoveHistoryEntry {\r\n   leadToCheck\r\n   wonTheGame\r\n }\r\n`\r\n\r\nconst GAME_STATE_DETAILS = gql`\r\n  fragment gameStateDetails on Game {\r\n    board {\r\n      ...idlePiece\r\n      id\r\n      availableMoves {\r\n        newLocation {\r\n          ...location\r\n        }\r\n      }\r\n    }\r\n    id\r\n    currentPlayer\r\n    whitePlayer\r\n    blackPlayer\r\n    winner\r\n    gameOver\r\n    promotionPlayerID\r\n    check {\r\n      threatenedPlayer\r\n      movesAvailable {\r\n        piece {\r\n          type\r\n          side\r\n        }\r\n        newLocation {\r\n          ...location\r\n        }\r\n      }\r\n    }\r\n    moveHistory {\r\n      ... on CastlingMove {\r\n        piece {\r\n          ...movedPiece\r\n        }\r\n        castledPiece {\r\n          ...movedPiece\r\n        }\r\n      }\r\n      ... on PromotionMove {\r\n        promotedPiece {\r\n          ...idlePiece\r\n        }\r\n        promotedTo\r\n      }\r\n      ... on OrdinaryMove {\r\n        piece {\r\n          ...movedPiece\r\n        }\r\n        pieceEaten {\r\n          ...idlePiece\r\n        }\r\n        newLocation {\r\n          ...location\r\n        }\r\n      }\r\n      ... on SkipMove {\r\n        isSkip\r\n      }\r\n      ...moveHistoryEntry\r\n    }\r\n  }\r\n  ${LOCATION}\r\n  ${IDLE_PIECE}\r\n  ${MOVED_PIECE}\r\n  ${MOVE_HISTORY_ENTRY}\r\n`\r\n/* ${MOVED_PIECE}\r\n  ${MOVE_HISTORY_ENTRY} */\r\n\r\n/* moveHistory {\r\n  ... on OrdinaryMove {\r\n    piece {\r\n      ...movedPiece\r\n    }\r\n    pieceEaten {\r\n      ...idlePiece\r\n    }\r\n    newLocation {\r\n      ...location\r\n    }\r\n  }\r\n  ... on CastlingMove {\r\n    piece {\r\n      ...movedPiece\r\n    }\r\n    castledPiece {\r\n      ...movedPiece\r\n    }\r\n  }\r\n  ... on PromotionMove {\r\n    promotedPiece {\r\n      ...idlePiece\r\n    }\r\n    promotedTo\r\n  }\r\n  ...moveHistoryEntry\r\n} */\r\n\r\n\r\n// mutations and queries\r\n\r\n// game related\r\nexport const GET_GAME = gql`\r\n  query getGame($gameId: String!) {\r\n    getGame(\r\n      gameId: $gameId\r\n    ) {\r\n      ...gameStateDetails\r\n    }\r\n  }\r\n  ${GAME_STATE_DETAILS}\r\n`\r\n\r\nexport const SKIP_TURN = gql`\r\n  mutation skipTurn($gameId: String!) {\r\n    skipTurn(\r\n      gameId: $gameId\r\n    ) {\r\n      ...gameStateDetails\r\n    }\r\n  }\r\n  ${GAME_STATE_DETAILS}\r\n`\r\n\r\nexport const GAME_STATE_UPDATED = gql`\r\n  subscription gameStateUpdated($gameId: String!) {\r\n    gameStateUpdated(\r\n      gameId: $gameId\r\n    ) {\r\n      ...gameStateDetails\r\n    }\r\n  }\r\n  ${GAME_STATE_DETAILS}\r\n`\r\n\r\nexport const JOIN_GAME = gql`\r\n  mutation joinGame($gameId: String!) {\r\n    joinGame(\r\n      gameId: $gameId\r\n    ) {\r\n      ...gameStateDetails\r\n    }\r\n  }\r\n  ${GAME_STATE_DETAILS}\r\n`\r\n\r\nexport const PROMOTE = gql`\r\n  mutation promote($gameId: String!, $pieceType: String!) {\r\n    promote(\r\n      gameId: $gameId,\r\n      pieceType: $pieceType\r\n    ) {\r\n      ...gameStateDetails\r\n    }\r\n  }\r\n  ${GAME_STATE_DETAILS}\r\n`\r\n\r\nexport const MAKE_MOVE = gql`\r\n  mutation makeMove($move: MoveInput!) {\r\n    makeMove(\r\n      move: $move\r\n    ) {\r\n      lastMove {\r\n        success\r\n        message\r\n      }\r\n    }\r\n  }\r\n`\r\n\r\nexport const CREATE_GAME = gql`\r\n  mutation createGame {\r\n    createGame {\r\n      board {\r\n        type\r\n        side\r\n      }\r\n      id\r\n    }\r\n  }\r\n`\r\n\r\n// user related\r\n\r\n// fragments\r\nconst REQUEST_DETAILS = gql`\r\n  fragment requestDetails on FriendRequest {\r\n    from {\r\n      tag\r\n    }\r\n    to {\r\n      tag\r\n    }\r\n    id\r\n  }\r\n`\r\nconst INVITE_DETAILS = gql`\r\n  fragment inviteDetails on GameInvite {\r\n    from\r\n    to\r\n    resolveStatus\r\n    game {\r\n      ...gameStateDetails\r\n    }\r\n  }\r\n  ${GAME_STATE_DETAILS}\r\n`\r\nconst USER_DETAILS = gql`\r\n  fragment userDetails on UserWithToken {\r\n    username\r\n    tag\r\n    friends {\r\n      tag\r\n    }\r\n    sentRequests {\r\n      ...requestDetails\r\n    }\r\n    receivedRequests {\r\n      ...requestDetails\r\n    }\r\n    guest\r\n    id\r\n    token\r\n    sentInvites {\r\n      ...inviteDetails\r\n    }\r\n    receivedInvites {\r\n      ...inviteDetails\r\n    }\r\n  }\r\n  ${INVITE_DETAILS}\r\n  ${REQUEST_DETAILS}\r\n`\r\n\r\n// rest\r\nexport const GET_LOGGED_USER = gql`\r\n  query getLoggedUser($token: String) {\r\n    getLoggedUser(\r\n      token: $token\r\n    ) {\r\n      ...userDetails\r\n    }\r\n  }\r\n  ${USER_DETAILS}\r\n`\r\n\r\nexport const LOGIN = gql`\r\n  mutation login($username: String!, $password: String!) {\r\n    login(\r\n      username: $username,\r\n      password: $password\r\n    ) {\r\n      ...userDetails\r\n    }\r\n  }\r\n  ${USER_DETAILS}\r\n`\r\n\r\nexport const ADD_USER = gql`\r\n  mutation addUser($user: NewUserInput!) {\r\n    addUser(\r\n      user: $user\r\n    ) {\r\n      username\r\n      tag\r\n      id\r\n    }\r\n  }\r\n`\r\n\r\n// friend related\r\nexport const REQUEST_RECEIVED = gql`\r\n  subscription requestReceived($userId: String) {\r\n    requestReceived(\r\n      userId: $userId\r\n    ) {\r\n      ...requestDetails\r\n    }\r\n  }\r\n  ${REQUEST_DETAILS}\r\n`\r\n\r\nexport const REQUEST_ACCEPTED = gql`\r\n  subscription requestAccepted($userId: String) {\r\n    requestAccepted(\r\n      userId: $userId\r\n    ) {\r\n      ...requestDetails\r\n    }\r\n  }\r\n  ${REQUEST_DETAILS}\r\n`\r\n\r\nexport const SEND_FRIEND_REQUEST = gql`\r\n  mutation sendFriendRequest($tag: String) {\r\n    sendFriendRequest(\r\n      tag: $tag\r\n    ) {\r\n      ...requestDetails\r\n    }\r\n  }\r\n  ${REQUEST_DETAILS}\r\n`\r\n\r\nexport const ACCEPT_FRIEND_REQUEST = gql`\r\n  mutation acceptFriendRequest($requestId: String) {\r\n    acceptFriendRequest(\r\n      requestId: $requestId\r\n    ) {\r\n      ...requestDetails\r\n    }\r\n  }\r\n  ${REQUEST_DETAILS}\r\n`\r\n\r\nexport const DECLINE_FRIEND_REQUEST = gql`\r\n  mutation declineFriendRequest($requestId: String) {\r\n    declineFriendRequest(\r\n      requestId: $requestId\r\n    ) {\r\n      ...requestDetails\r\n    }\r\n  }\r\n  ${REQUEST_DETAILS}\r\n`\r\n\r\nexport const REMOVE_FRIEND = gql`\r\n  mutation removeFriend($tag: String) {\r\n    removeFriend(\r\n      tag: $tag\r\n    )\r\n  }\r\n`\r\n\r\nexport const INVITE_RECEIVED = gql`\r\n  subscription inviteReceived($tag: String) {\r\n    inviteReceived(\r\n      tag: $tag\r\n    ) {\r\n      ...inviteDetails\r\n    }\r\n  }\r\n  ${INVITE_DETAILS}\r\n`\r\n\r\nexport const INVITE_RESOLVED = gql`\r\n  subscription inviteResolved($tag: String) {\r\n    inviteResolved(\r\n      tag: $tag\r\n    ) {\r\n      ...inviteDetails\r\n    }\r\n  }\r\n  ${INVITE_DETAILS}\r\n`\r\n\r\nexport const SEND_GAME_INVITE = gql`\r\n  mutation sendGameInvite($tag: String) {\r\n    sendGameInvite(\r\n      tag: $tag\r\n    ) {\r\n      ...inviteDetails\r\n    }\r\n  }\r\n  ${INVITE_DETAILS}\r\n`\r\n\r\nexport const RESOLVE_GAME_INVITE = gql`\r\n  mutation resolveGameInvite($from: String, $accepted: Boolean) {\r\n    resolveGameInvite(\r\n      from: $from,\r\n      accepted: $accepted\r\n    ) {\r\n      ...inviteDetails\r\n    }\r\n  }\r\n  ${INVITE_DETAILS}\r\n`","export const handleApolloError = err => {\r\n  if (!err.graphQLErrors || !err.graphQLErrors[0]) {\r\n    console.log(err.message)\r\n    if (err.stack) {\r\n      console.log(err.stack)\r\n    }\r\n  } else {\r\n    console.log(err.graphQLErrors[0].message)\r\n    if (err.graphQLErrors[0].stack) {\r\n      console.log(err.graphQLErrors[0].stack)\r\n    }\r\n  }\r\n}","import React from \"react\"\r\n\r\nexport const UserContext = React.createContext(null)\r\n\r\nexport const GameContext = React.createContext(null)\r\n\r\nexport const FeedbackContext = React.createContext(null)","import { useEffect, useCallback, useState, useContext } from \"react\"\r\nimport { useQuery, useMutation, useSubscription, useApolloClient, useLazyQuery, } from \"@apollo/client\"\r\nimport {\r\n  GET_GAME,\r\n  MAKE_MOVE,\r\n  GAME_STATE_UPDATED,\r\n  JOIN_GAME, PROMOTE,\r\n  GET_LOGGED_USER,\r\n  SKIP_TURN,\r\n  REQUEST_RECEIVED,\r\n  REQUEST_ACCEPTED,\r\n  SEND_FRIEND_REQUEST,\r\n  ACCEPT_FRIEND_REQUEST,\r\n  REMOVE_FRIEND,\r\n  DECLINE_FRIEND_REQUEST,\r\n  INVITE_RECEIVED,\r\n  INVITE_RESOLVED,\r\n  SEND_GAME_INVITE,\r\n  RESOLVE_GAME_INVITE,\r\n} from \"../queries\"\r\nimport { useParams, useHistory } from \"react-router-dom\"\r\nimport { handleApolloError } from \"./errorHandlers\"\r\nimport { FeedbackContext } from \"./context\"\r\n\r\n// hook that gets the game state\r\nexport const useGame = () => {\r\n  const client = useApolloClient()\r\n  const { id } = useParams()\r\n\r\n  const setGame = newGameData => {\r\n    let gameDataInStore = client.readQuery({ query: GET_GAME, variables: { gameId: id } })\r\n    gameDataInStore = { getGame: newGameData.gameStateUpdated }\r\n  \r\n    /* console.log(\"newGameData:\", newGameData)\r\n    console.log(\"gameState tobe:\", gameDataInStore) */\r\n    client.writeQuery({\r\n      query: GET_GAME,\r\n      data: gameDataInStore,\r\n      variables: { id }\r\n    })\r\n    /* console.log(\"Game state updated with:\", client.readQuery({\r\n      query: GET_GAME,\r\n      variables: { id }\r\n    })) */\r\n  }\r\n\r\n  const initialResult = useQuery(GET_GAME, {\r\n    variables: { gameId: id },\r\n    onError: err => {\r\n      handleApolloError(err)\r\n    },\r\n  })\r\n  const [makeMove] = useMutation(MAKE_MOVE, {\r\n    onError: err => {\r\n      handleApolloError(err)\r\n    }\r\n  })\r\n  const [promote] = useMutation(PROMOTE)\r\n  const [skipTurn] = useMutation(SKIP_TURN, {\r\n    variables: { gameId: id },\r\n    onError: err => {\r\n      handleApolloError(err)\r\n    }\r\n  })\r\n  const [joinGame] = useMutation(JOIN_GAME, {\r\n    variables: { gameId: id },\r\n    onError: err => {\r\n      handleApolloError(err)\r\n    },\r\n    onCompleted: data => {\r\n      setGame(data)\r\n    }\r\n  })\r\n\r\n  useSubscription(GAME_STATE_UPDATED, {\r\n    onSubscriptionData: ({ subscriptionData }) => {\r\n      setGame(subscriptionData.data)\r\n      /* console.log(\"subscriptionBoard\",subscriptionData.data.gameStateUpdated.board) */\r\n      /* console.log(subscriptionData.data.gameStateUpdated.moveHistory) */\r\n    },\r\n    variables: { gameId: id }\r\n  })\r\n\r\n  useEffect(() => {\r\n    joinGame()\r\n  }, [joinGame])\r\n\r\n  const sendPromotedType = type => {\r\n    promote({ variables: { gameId: id, pieceType: type } })\r\n  }\r\n\r\n  return {\r\n    game: initialResult.loading || initialResult.error ? null : initialResult.data.getGame,\r\n    gameLoading: initialResult.loading,\r\n    gameError: initialResult.error,\r\n    promote: sendPromotedType,\r\n    makeMove: ({ piece, oldLocation, newLocation }) => makeMove({\r\n      variables: { move: { piece, oldLocation, newLocation, gameId: id } }\r\n    }),\r\n    skipTurn,\r\n  }\r\n}\r\n\r\n\r\n\r\n// hook that gets the user\r\nexport const useUser = () => {\r\n  const client = useApolloClient()\r\n  const [token, setToken] = useState(null)\r\n\r\n  // lazy user query\r\n  const [getUser] = useLazyQuery(GET_LOGGED_USER, {\r\n    variables: {\r\n      token: window.localStorage.getItem(\"loggedChessUser\")\r\n        ? window.localStorage.getItem(\"loggedChessUser\")\r\n        : window.sessionStorage.getItem(\"loggedChessUser\")\r\n    },\r\n    onCompleted: data => {\r\n      setUser(data.getLoggedUser)\r\n    },\r\n    onError: err => {\r\n      handleApolloError(err)\r\n    },\r\n  })\r\n  \r\n  // user query\r\n  const { loading, data, error } = useQuery(GET_LOGGED_USER, {\r\n    variables: {\r\n      token: window.localStorage.getItem(\"loggedChessUser\")\r\n        ? window.localStorage.getItem(\"loggedChessUser\")\r\n        : window.sessionStorage.getItem(\"loggedChessUser\")\r\n    },\r\n    onError: err => {\r\n      handleApolloError(err)\r\n    },\r\n  })\r\n\r\n  const removeUser = useCallback(async () => {\r\n    console.log(\"logged out\")\r\n    window.localStorage.removeItem(\"loggedChessUser\")\r\n    window.sessionStorage.removeItem(\"loggedChessUser\")\r\n    /* console.log(window.localStorage.getItem(\"loggedChessUser\"))\r\n    console.log(window.sessionStorage.getItem(\"loggedChessUser\")) */\r\n    setToken(null)\r\n    await client.cache.reset()\r\n    return\r\n  }, [])\r\n\r\n  const setUser = useCallback((user, remember,) => {\r\n    let newUserData = { getLoggedUser: user }\r\n\r\n    if (remember) {\r\n      window.localStorage.setItem(\"loggedChessUser\", user.token)\r\n    }\r\n    window.sessionStorage.setItem(\"loggedChessUser\", user.token)\r\n\r\n    client.writeQuery({\r\n      query: GET_LOGGED_USER,\r\n      data: newUserData,\r\n      variables: { token: user.token }\r\n    })\r\n    setToken(user.token)\r\n\r\n  }, [client])\r\n\r\n  useEffect(() => {\r\n    if (data) {\r\n      setUser(data.getLoggedUser)\r\n      setToken(data.getLoggedUser.token)\r\n    }\r\n  }, [data, setUser])\r\n\r\n  let userDataInStore = null\r\n\r\n  if ((!loading && !error) && token) {\r\n    /* console.log(token) */\r\n    userDataInStore = client.readQuery({\r\n      query: GET_LOGGED_USER,\r\n      variables: { token }\r\n    })\r\n  }\r\n  //console.log((!loading && !error) && token ? userDataInStore.getLoggedUser : null)\r\n\r\n\r\n  return {\r\n    user: (!loading && !error) && token ? userDataInStore.getLoggedUser : null,\r\n    userLoading: loading,\r\n    userError: error,\r\n    setUser,\r\n    removeUser,\r\n  }\r\n}\r\n\r\n// hook that manages friends\r\nexport const useFriends = (user) => {\r\n  const client = useApolloClient()\r\n  const history = useHistory()\r\n  //console.log(\"used friends with\", user)\r\n\r\n  // cache update funcs\r\n  const addRecReq = (req) => {\r\n    let newUserData = { getLoggedUser: {\r\n      ...user,\r\n      receivedRequests: user.receivedRequests.find(r => r.id === req.id)\r\n        ? user.receivedRequests\r\n        : user.receivedRequests.concat(req),\r\n    } }\r\n    client.writeQuery({\r\n      query: GET_LOGGED_USER,\r\n      data: newUserData,\r\n      variables: { token: user.token },\r\n    })\r\n  }\r\n  const removeRecReq = req => {\r\n    let newUserData = { getLoggedUser: {\r\n      ...user,\r\n      receivedRequests: user.receivedRequests.filter(r => r.id !== req.id)\r\n    } }\r\n    client.writeQuery({\r\n      query: GET_LOGGED_USER,\r\n      data: newUserData,\r\n      variables: { token: user.token },\r\n    })\r\n  }\r\n  const addSentReq = (req) => {\r\n    let newUserData = { getLoggedUser: {\r\n      ...user,\r\n      sentRequests: user.sentRequests.find(r => r.id === req.id)\r\n        ? user.sentRequests\r\n        : user.sentRequests.concat(req),\r\n    } }\r\n    client.writeQuery({\r\n      query: GET_LOGGED_USER,\r\n      data: newUserData,\r\n      variables: { token: user.token },\r\n    })\r\n  }\r\n  const addFriend = (req, fromMutation) => {\r\n    let newUserData = { getLoggedUser: {\r\n      ...user,\r\n      sentRequests: user.sentRequests.filter(r => r.id !== req.id),\r\n      receivedRequests: user.receivedRequests.filter(r => r.id !== req.id),\r\n      friends: user.friends.find(f => f.tag === req.to.tag)\r\n        ? user.friends\r\n        : user.friends.concat(fromMutation ? { tag: req.from.tag } : { tag: req.to.tag }),\r\n    } }\r\n    client.writeQuery({\r\n      query: GET_LOGGED_USER,\r\n      data: newUserData,\r\n      variables: { token: user.token },\r\n    })\r\n  }\r\n  const setReceivedInvs = (invList) => {\r\n    let newUserData = { getLoggedUser: {\r\n      ...user,\r\n      receivedInvites: invList,\r\n    } }\r\n    client.writeQuery({\r\n      query: GET_LOGGED_USER,\r\n      data: newUserData,\r\n      variables: { token: user.token },\r\n    })\r\n  }\r\n  const setSentInvs = (invList) => {\r\n    let newUserData = { getLoggedUser: {\r\n      ...user,\r\n      sentInvites: invList,\r\n    } }\r\n    client.writeQuery({\r\n      query: GET_LOGGED_USER,\r\n      data: newUserData,\r\n      variables: { token: user.token },\r\n    })\r\n  }\r\n\r\n  // subs and mutations\r\n  useSubscription(REQUEST_RECEIVED, {\r\n    variables: { userId: user ? user.id : null },\r\n    onError: err => {\r\n      console.log(\"virhe\")\r\n      handleApolloError(err)\r\n    },\r\n    onSubscriptionComplete: () => {\r\n      console.log(\"Listening to incoming friend requests\")\r\n    },\r\n    onSubscriptionData: ({ subscriptionData }) => {\r\n      console.log(\"Data from req reception:\", subscriptionData)\r\n      addRecReq(subscriptionData.data.requestReceived)\r\n    },\r\n  })\r\n\r\n  useSubscription(REQUEST_ACCEPTED, {\r\n    variables: { userId: user ? user.id : null },\r\n    onError: err => {\r\n      console.log(\"virhe\")\r\n      handleApolloError(err)\r\n    },\r\n    onSubscriptionComplete: () => {\r\n      console.log(\"Listening to accepts to the reqs...\")\r\n    },\r\n    onSubscriptionData: ({ subscriptionData }) => {\r\n      console.log(\"Data from req acception:\", subscriptionData)\r\n      addFriend(subscriptionData.data.requestAccepted)\r\n    },\r\n  })\r\n\r\n  const [sendReq, { data: sendReqData }] = useMutation(SEND_FRIEND_REQUEST, {\r\n    onCompleted: data => {\r\n      addSentReq(data.sendFriendRequest)\r\n    }\r\n  })\r\n  const [acceptReq, { data: acceptReqData }] = useMutation(ACCEPT_FRIEND_REQUEST, {\r\n    onError: err => {\r\n      handleApolloError(err)\r\n    },\r\n    onCompleted: data => {\r\n      addFriend(data.acceptFriendRequest, true)\r\n    }\r\n  })\r\n  const [declineReq, { data: declineReqData }] = useMutation(DECLINE_FRIEND_REQUEST, {\r\n    onError: err => {\r\n      handleApolloError(err)\r\n    },\r\n    onCompleted: data => {\r\n      removeRecReq(data.declineFriendRequest)\r\n    }\r\n  })\r\n  const [removeFriend] = useMutation(REMOVE_FRIEND, {\r\n    onError: err => {\r\n      handleApolloError(err)\r\n    },\r\n  })\r\n\r\n  // game invite stuff\r\n  useSubscription(INVITE_RECEIVED, {\r\n    variables: { tag: user ? user.tag : null },\r\n    onError: err => {\r\n      console.log(\"virhe\")\r\n      handleApolloError(err)\r\n    },\r\n    onSubscriptionData: ({ subscriptionData }) => {\r\n      console.log(\"Data from inv reception:\", subscriptionData)\r\n      if (!user.receivedInvites) {\r\n        setReceivedInvs([subscriptionData.data.inviteReceived])\r\n        console.log(\"were set to\", [subscriptionData.data.inviteReceived])\r\n        return\r\n      }\r\n      if (!user.receivedInvites.find(inv => inv.from === subscriptionData.data.inviteReceived.from)) {\r\n        setReceivedInvs(user.receivedInvites.concat(subscriptionData.data.inviteReceived))\r\n      }\r\n    },\r\n  })\r\n  useSubscription(INVITE_RESOLVED, {\r\n    variables: { tag: user ? user.tag : null },\r\n    onError: err => {\r\n      console.log(\"virhe\")\r\n      handleApolloError(err)\r\n    },\r\n    onSubscriptionData: ({ subscriptionData }) => {\r\n      console.log(\"Data from inv resolving:\", subscriptionData)\r\n      if (!user.sentInvites) {\r\n        setSentInvs([])\r\n      } else {\r\n        setSentInvs(user.sentInvites.filter(inv => {\r\n          return inv.to !== subscriptionData.data.inviteResolved.to\r\n        }))\r\n      }\r\n      if (subscriptionData.data.inviteResolved.resolveStatus === \"accepted\") {\r\n        history.push(\"/\")\r\n        history.push(`play/${subscriptionData.data.inviteResolved.game.id}`)\r\n      }\r\n    },\r\n  })\r\n\r\n  const [sendGameInv] = useMutation(SEND_GAME_INVITE, {\r\n    onCompleted: data => {\r\n      console.log(\"sent inv\", data.sendGameInvite)\r\n      if (!user.receivedInvites || !user.receivedInvites.find(inv => inv.from === data.sendGameInvite.to)) {\r\n        if (!user.sentInvites) {\r\n          setSentInvs([data.sendGameInvite])\r\n        } else if (data.sendGameInvite.resolveStatus === null && !user.sentInvites.find(inv => inv.to === data.sendGameInvite.to))\r\n          setSentInvs(user.sentInvites.concat(data.sendGameInvite))\r\n      }\r\n    }\r\n  })\r\n  const [resolveGameInv] = useMutation(RESOLVE_GAME_INVITE, {\r\n    onError: err => {\r\n      handleApolloError(err)\r\n    },\r\n    onCompleted: data => {\r\n      console.log(\"resolved inv\", data.resolveGameInvite)\r\n      if (!user.receivedInvites) {\r\n        setReceivedInvs([])\r\n      } else {\r\n        setReceivedInvs(user.receivedInvites.filter(inv => {\r\n          return inv.from !== data.resolveGameInvite.from\r\n        }))\r\n      }\r\n      if (data.resolveGameInvite.resolveStatus === \"accepted\") {\r\n        history.push(\"/\")\r\n        history.push(`play/${data.resolveGameInvite.game.id}`)\r\n      }\r\n    }\r\n  })\r\n\r\n  //console.log(\"in friends recinvs\", receivedInvs)\r\n\r\n  return {\r\n    acceptReq,\r\n    acceptReqData,\r\n    sendReq,\r\n    sendReqData,\r\n    removeFriend,\r\n    declineReq,\r\n    declineReqData,\r\n    sendGameInv,\r\n    resolveGameInv,\r\n  }\r\n}","import React, { useState, useEffect, useContext } from \"react\"\r\nimport { TextField, Button, Checkbox, FormControlLabel, Paper, } from \"@material-ui/core\"\r\nimport { useHistory } from \"react-router-dom\"\r\nimport { LOGIN } from \"../queries\"\r\nimport { useMutation } from \"@apollo/client\"\r\nimport { useUser } from \"../utils/stateHooks\"\r\nimport { FeedbackContext } from \"../utils/context\"\r\n\r\n\r\nconst LoginForm = () => {\r\n  const [username, setUsername] = useState(\"\")\r\n  const [password, setPassword] = useState(\"\")\r\n  const [remember, setRemember] = useState(true)\r\n  const { setFeedback } = useContext(FeedbackContext)\r\n\r\n  const { setUser } = useUser()\r\n\r\n  const history = useHistory()\r\n\r\n  const [login, loginResult] = useMutation(LOGIN, {\r\n    onError: err => {\r\n      if (!err.graphQLErrors || !err.graphQLErrors[0]) {\r\n        console.log(err.message)\r\n      } else {\r\n        console.log(err.graphQLErrors[0].message)\r\n      }\r\n      setFeedback({ message: err.message, severity: \"error\" })\r\n      setPassword(\"\")\r\n    }\r\n  })\r\n\r\n  const onSubmit = event => {\r\n    event.preventDefault()\r\n\r\n    login({ variables: { username, password } })\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (loginResult.data) {\r\n      setUsername(\"\")\r\n      setPassword(\"\")\r\n\r\n      setUser(loginResult.data.login, remember)\r\n\r\n      history.push(\"/\")\r\n      window.location.reload(true)\r\n    }\r\n  }, [loginResult.data, setUser, history, remember])\r\n\r\n  return (\r\n    <div>\r\n      <Paper style={{ padding: 10 }}>\r\n        <h2>Kirjaudu sisään</h2>\r\n        <form onSubmit={onSubmit}>\r\n          <div>\r\n            <TextField\r\n              label=\"Käyttäjänimi\"\r\n              value={username}\r\n              onChange={e => {setUsername(e.target.value)}}\r\n              name=\"username\"\r\n            />\r\n          </div>\r\n          <div>\r\n            <TextField\r\n              label=\"Salasana\"\r\n              type=\"password\"\r\n              value={password}\r\n              onChange={e => {setPassword(e.target.value)}}\r\n              name=\"password\"\r\n            />\r\n          </div>\r\n          <div>\r\n            <FormControlLabel\r\n              control={\r\n                <Checkbox\r\n                  checked={remember}\r\n                  onChange={() => setRemember(!remember)}\r\n                  name=\"rememberMe\"\r\n                  color=\"primary\"\r\n                />\r\n              }\r\n              label=\"Muista minut\"\r\n            />\r\n          </div>\r\n          <div>\r\n            <Button variant=\"contained\" color=\"primary\" type=\"submit\">\r\n              Kirjaudu\r\n            </Button>\r\n          </div>\r\n        </form>\r\n        <div>\r\n          tai\r\n        </div>\r\n        <div>\r\n          <Button variant=\"contained\" color=\"primary\" onClick={() => history.push(\"/register\")}>\r\n            Luo uusi käyttäjä\r\n          </Button>\r\n        </div>\r\n      </Paper>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default LoginForm","import React, { useContext } from \"react\"\r\nimport { Snackbar } from \"@material-ui/core\"\r\nimport { Alert } from \"@material-ui/lab\"\r\nimport { FeedbackContext } from \"../utils/context\"\r\n\r\nconst Feedback = () => {\r\n  const { feedback, setFeedback } = useContext(FeedbackContext)\r\n  /* console.log(feedback)\r\n  console.log(feedback ? true : false) */\r\n  /* console.log(feedback ? feedback.severity : \"info\") */\r\n\r\n  return (\r\n    <Snackbar open={feedback ? true : false} autoHideDuration={6000} onClose={() => setFeedback(null)}>\r\n      <Alert onClose={() => setFeedback(null)} severity={feedback ? feedback.severity : \"info\"}>\r\n        {feedback ? feedback.message : \"\"}\r\n      </Alert>\r\n    </Snackbar>\r\n  )\r\n}\r\n\r\nexport default Feedback","import React, { useState, useContext } from \"react\"\r\nimport { Dialog, DialogTitle, DialogContent, DialogContentText, TextField, DialogActions, Button } from \"@material-ui/core\"\r\nimport { useUser } from \"../utils/stateHooks\"\r\nimport { FeedbackContext } from \"../utils/context\"\r\nimport Feedback from \"./Feedback\"\r\n\r\nconst AddFriendDialog = React.forwardRef(({ sendReq }, ref) => {\r\n  const [open, setOpen] = useState(false)\r\n  const [tag, setTag] = useState(\"\")\r\n  const { setFeedback } = useContext(FeedbackContext)\r\n\r\n  React.useImperativeHandle(ref, () => {\r\n    return {\r\n      setOpen\r\n    }\r\n  })\r\n\r\n  const sendFriendRequest = async () => {\r\n    try {\r\n      await sendReq({ variables: { tag } })\r\n      setFeedback({ message: \"Kaveripyyntö lähetetty\", severity: \"success\" })\r\n    } catch (e) {\r\n      console.log(\"löytys vrihe\")\r\n      setFeedback({ message: e.message, severity: \"error\" })\r\n    }\r\n    setTag(\"\")\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      <Dialog open={open} onClose={() => setOpen(false)}>\r\n        <DialogTitle>Lisää kaveri</DialogTitle>\r\n        <DialogContent>\r\n          <DialogContentText>\r\n            Kirjoita tähän kaverisi pelinimi.\r\n          </DialogContentText>\r\n          <TextField\r\n            value={tag}\r\n            label=\"Pelinimi\"\r\n            onChange={e => setTag(e.target.value)}\r\n          />\r\n        </DialogContent>\r\n        <DialogActions>\r\n          <Button onClick={() => setOpen(false)}>\r\n            Peruuta\r\n          </Button>\r\n          <Button onClick={() => sendFriendRequest()}>\r\n            Lisää\r\n          </Button>\r\n        </DialogActions>\r\n        <DialogContent>\r\n          <Feedback />\r\n        </DialogContent>\r\n      </Dialog>\r\n    </div>\r\n  )\r\n})\r\n\r\nAddFriendDialog.displayName = \"AddFriendDialog\"\r\n\r\nexport default AddFriendDialog","import React, { useState, useImperativeHandle, } from \"react\"\r\nimport { SwipeableDrawer, List, ListItem, ListItemIcon, ListItemText, Link, Divider, IconButton, } from \"@material-ui/core\"\r\nimport { ExitToApp, PersonAdd, Check, Close, SportsEsports, } from \"@material-ui/icons\"\r\nimport AddFriendDialog from \"./AddFriendDialog\"\r\nimport { useUser, useFriends } from \"../utils/stateHooks\"\r\n\r\nconst ProfileDrawer = React.forwardRef((_, ref) => {\r\n  const [show, setShow] = useState(false)\r\n  const {\r\n    user,\r\n    removeUser,\r\n  } = useUser()\r\n  const {\r\n    acceptReq,\r\n    declineReq,\r\n    sendGameInv,\r\n    resolveGameInv,\r\n    sendReq,\r\n  } = useFriends(user)\r\n  const friendRef = React.createRef()\r\n\r\n  const openDrawer = () => {\r\n    setShow(true)\r\n  }\r\n\r\n  useImperativeHandle(ref, () => {\r\n    return {\r\n      openDrawer\r\n    }\r\n  })\r\n\r\n  const sendInvite = async tag => {\r\n    if (!user.receivedInvites || !user.receivedInvites.find(inv => inv.from === tag)) {\r\n      await sendGameInv({ variables: { tag } })\r\n    }\r\n  }\r\n\r\n  const resolveInvite = async (from, accepted) => {\r\n    try {\r\n      await resolveGameInv({ variables: { from, accepted, } })\r\n    } catch (e) {\r\n      console.log(e.message)\r\n    }\r\n  }\r\n\r\n  if (user && user.guest) {\r\n    return null\r\n  }\r\n\r\n  //console.log(\"ProfileDrawer is rendered and invs are\", receivedInvs)\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <SwipeableDrawer\r\n        open={show}\r\n        onClose={() => setShow(false)}\r\n        onOpen={() => setShow(true)}\r\n        anchor=\"right\"\r\n      >\r\n        <div style={{ width: \"32vh\" }}>\r\n          <List>\r\n            <ListItem>\r\n              <ListItemText primary={user ? `Kirjautuneena ${user.tag}` : null} />\r\n            </ListItem>\r\n            <Divider />\r\n            {user && user.receivedRequests.length !== 0\r\n              ? <React.Fragment>\r\n                <ListItem>\r\n                  <ListItemText primary=\"Kaveripyynnöt\" />\r\n                </ListItem>\r\n                {user.receivedRequests.map(req => {\r\n                  return (\r\n                    <ListItem key={req.id}>\r\n                      <ListItemText secondary={`Käyttäjältä ${req.from.tag}`} />\r\n                      <IconButton onClick={() => acceptReq({ variables: { requestId: req.id } })}>\r\n                        <Check />\r\n                      </IconButton>\r\n                      <IconButton onClick={() => declineReq({ variables: { requestId: req.id } })}>\r\n                        <Close />\r\n                      </IconButton>\r\n                    </ListItem>\r\n                  )\r\n                })}\r\n                <Divider />\r\n              </React.Fragment>\r\n              : null\r\n            }\r\n            <ListItem>\r\n              <ListItemText primary=\"Kaverit\" />\r\n            </ListItem>\r\n            {user && user.friends.length !== 0\r\n              ? user.friends.map(f => {\r\n                return (\r\n                  <ListItem key={f.tag}>\r\n                    <ListItemText secondary={f.tag} />\r\n                    <IconButton onClick={() => sendInvite(f.tag)}>\r\n                      <SportsEsports />\r\n                    </IconButton>\r\n                  </ListItem>\r\n                )\r\n              })\r\n              : <ListItem>\r\n                <ListItemText secondary=\"Sinulla ei ole vielä kavereita.\" />\r\n              </ListItem>\r\n            }\r\n            <Divider />\r\n            <ListItem>\r\n              <ListItemText primary=\"Lähetetyt pelikutsut\" />\r\n            </ListItem>\r\n            {(user && user.sentInvites) ? user.sentInvites.map(inv => {\r\n              return (\r\n                <ListItem key={inv.to}>\r\n                  <ListItemText secondary={`käyttäjälle ${inv.to}`} />\r\n                </ListItem>\r\n              )\r\n            }) : null}\r\n            <Divider />\r\n            <ListItem>\r\n              <ListItemText primary=\"Vastaanotetut pelikutsut\" />\r\n            </ListItem>\r\n            {(user && user.receivedInvites) ? user.receivedInvites.map(inv => {\r\n              return (\r\n                <ListItem key={inv.from}>\r\n                  <ListItemText secondary={`käyttäjältä ${inv.from}`} />\r\n                  <IconButton onClick={() => resolveInvite(inv.from, true)}>\r\n                    <Check />\r\n                  </IconButton>\r\n                  <IconButton onClick={() => resolveInvite(inv.from, false)}>\r\n                    <Close />\r\n                  </IconButton>\r\n                </ListItem>\r\n              )\r\n            }) : null}\r\n            <Divider />\r\n            <ListItem\r\n              button\r\n              onClick={() => {\r\n                removeUser()\r\n                console.log(\"has been removed\")\r\n                setShow(false)\r\n                window.location.reload()\r\n              }}\r\n              component={Link}\r\n              to=\"/\"\r\n            >\r\n              <ListItemIcon><ExitToApp /></ListItemIcon>\r\n              <ListItemText primary=\"Kirjaudu ulos\" />\r\n            </ListItem>\r\n            <ListItem button onClick={() => friendRef.current.setOpen(true)}>\r\n              <ListItemIcon><PersonAdd /></ListItemIcon>\r\n              <ListItemText primary=\"Lisää kaveri\" />\r\n            </ListItem>\r\n            <ListItem>\r\n              <ListItemText secondary=\"Huom. kaverilistassa ei näy, onko kaveri paikalla shakkipelissä,\r\n              ja pelikutsu ei saavu perille hänen ollessa poissa.\r\n              Kaveripyynnön lähettäminen onnistuu kyllä, vaikka hän ei olisi paikalla.\" />\r\n            </ListItem>\r\n          </List>\r\n        </div>\r\n      </SwipeableDrawer>\r\n      <AddFriendDialog sendReq={sendReq} ref={friendRef} />\r\n    </React.Fragment>\r\n  )\r\n})\r\n\r\nProfileDrawer.displayName = \"ProfileDrawer\"\r\n\r\nexport default ProfileDrawer","import React from \"react\"\nimport ReactDOM from \"react-dom\"\nimport { BrowserRouter as Router } from \"react-router-dom\"\nimport App from \"./App\"\n\nimport { ApolloProvider, ApolloClient, InMemoryCache, HttpLink, split } from \"@apollo/client\"\nimport { setContext } from \"@apollo/link-context\"\nimport { getMainDefinition } from \"@apollo/client/utilities\"\nimport { WebSocketLink } from \"@apollo/link-ws\"\n\nconst authLink = setContext((_, { headers }) => {\n  const token = sessionStorage.getItem(\"loggedChessUser\")\n  return {\n    headers: {\n      ...headers,\n      authorization: token ? `bearer ${token}` : null\n    }\n  }\n})\n\nlet loc = window.location, wsUri\nif (loc.protocol === \"https:\") {\n  wsUri = \"wss:\"\n} else {\n  wsUri = \"ws:\"\n}\nwsUri += \"//\" + loc.host\nconsole.log(`${wsUri}/graphql`)\n\nconst httpLink = new HttpLink({\n  uri: \"/graphql\"\n})\n\nconst wsLink = new WebSocketLink({\n  uri: `${wsUri}/graphql`,\n  options: {\n    reconnect: true,\n    connectionParams: {\n      authToken: sessionStorage.getItem(\"loggedChessUser\")\n        ? `bearer ${sessionStorage.getItem(\"loggedChessUser\")}`\n        : null\n    }\n  }\n})\n\nconst splitLink = split(\n  ({query}) => {\n    const definition = getMainDefinition(query)\n    return (\n      definition.kind === \"OperationDefinition\" &&\n      definition.operation === \"subscription\"\n    )\n  },\n  wsLink,\n  authLink.concat(httpLink),\n)\n\nconst client = new ApolloClient({\n  cache: new InMemoryCache(),\n  link: splitLink,\n  connectToDevTools: true,\n})\n\n\n\nReactDOM.render(\n  <ApolloProvider client={client}>\n    <Router>\n      <App />\n    </Router>\n  </ApolloProvider>,\n  document.getElementById(\"root\")\n)\n","import React from \"react\"\r\nimport { AppBar, Toolbar, Button, Grid, IconButton, Badge, Typography } from \"@material-ui/core\"\r\nimport { Link, } from \"react-router-dom\"\r\nimport { useUser } from \"../utils/stateHooks\"\r\nimport ProfileDrawer from \"./ProfileDrawer\"\r\nimport { AccountCircle } from \"@material-ui/icons\"\r\n\r\n/* const useStyles = makeStyles(() => ({\r\n  info: {\r\n    marginRight: \"80vh\",\r\n  }\r\n})) */\r\n\r\nconst Menu = () => {\r\n  const { user, } = useUser()\r\n  const profileDrawerRef = React.createRef()\r\n\r\n  //console.log(\"Menu is rendered and invs are\", receivedInvs)\r\n\r\n  const getNotifications = () => {\r\n    if (user) {\r\n      /* console.log(user.receivedRequests ? user.receivedRequests.length : 0)\r\n      console.log(user.receivedInvites ? user.receivedInvites.length : 0)\r\n      console.log(user.sentInvites ? user.sentInvites.length : 0)\r\n      console.log((user.receivedRequests ? user.receivedRequests.length : 0) + \r\n        (user.receivedInvites ? user.receivedInvites.length : 0) + \r\n        (user.sentInvites ? user.sentInvites.length : 0)) */\r\n      return (user.receivedRequests ? user.receivedRequests.length : 0) + \r\n      (user.receivedInvites ? user.receivedInvites.length : 0)\r\n    }\r\n    return 0\r\n  }\r\n\r\n  return (\r\n    <AppBar position=\"static\">\r\n      <Toolbar>\r\n        <Grid\r\n          container\r\n          alignItems=\"center\"\r\n          justify=\"space-between\"\r\n        >\r\n          <Grid item>\r\n            <Button color=\"inherit\" component={Link} to=\"/play\">\r\n              Pelaa\r\n            </Button>\r\n            <Button color=\"inherit\" component={Link} to=\"/info\">\r\n              Ohjeet\r\n            </Button>\r\n          </Grid>\r\n          <Grid item>\r\n            <Typography variant=\"subtitle2\">\r\n              Ongelmatilanteessa sivun uudelleenlaataaminen yleensä auttaa.\r\n            </Typography>\r\n          </Grid>\r\n          <Grid item>\r\n            {!user || user.guest \r\n              ?\r\n              <Button color=\"inherit\" component={Link} to=\"/login\">\r\n                Kirjaudu\r\n              </Button>\r\n              :\r\n              <React.Fragment>\r\n                <IconButton onClick={() => profileDrawerRef.current.openDrawer()}>\r\n                  <Badge badgeContent={getNotifications()} color=\"primary\">\r\n                    <AccountCircle style={{ color: \"white\" }} />\r\n                  </Badge>\r\n                </IconButton>\r\n              </React.Fragment>\r\n            }\r\n          </Grid>\r\n        </Grid>\r\n        <ProfileDrawer\r\n          ref={profileDrawerRef}\r\n        />\r\n      </Toolbar>\r\n    </AppBar>\r\n  )\r\n}\r\n\r\nexport default Menu","import React, { useState, useEffect } from \"react\"\r\nimport { TextField, Button, Paper, } from \"@material-ui/core\"\r\nimport { useMutation } from \"@apollo/client\"\r\nimport { ADD_USER } from \"../queries\"\r\nimport { useHistory } from \"react-router-dom\"\r\nimport { WHITESQUARE_COLOR, BLACKSQUARE_COLOR } from \"../utils/constants\"\r\n\r\nconst RegisterForm = () => {\r\n  const [username, setUsername] = useState(\"\")\r\n  const [password, setPassword] = useState(\"\")\r\n  const [confirmation, setConfirmation] = useState(\"\")\r\n  const [tag, setTag] = useState(\"\")\r\n  const history = useHistory()\r\n\r\n  const [addUser, addedResult] = useMutation(ADD_USER, {\r\n    onError: err => {\r\n      console.log(err.graphQLErrors[0].message)\r\n      window.alert(err.graphQLErrors[0].message)\r\n    }\r\n  })\r\n\r\n  const onSubmit = event => {\r\n    event.preventDefault()\r\n\r\n    const user = { username, password, tag }\r\n    addUser({ variables: { user } })\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (addedResult.data) {\r\n      setUsername(\"\")\r\n      setPassword(\"\")\r\n      setTag(\"\")\r\n\r\n      window.alert(\"Käyttäjä luotu onnistuneesti.\")\r\n      history.push(\"/\")\r\n    }\r\n  }, [addedResult.data, history])\r\n\r\n  const style = {\r\n    background: `linear-gradient(135deg, rgb(${WHITESQUARE_COLOR}), rgb(${BLACKSQUARE_COLOR}))`,\r\n    padding: \"20px\",\r\n  }\r\n\r\n  return (\r\n    <Paper style={style}>\r\n      <h2>Luo uusi käyttäjä</h2>\r\n      <form onSubmit={onSubmit}>\r\n        <div>\r\n          <TextField\r\n            label=\"Käyttäjänimi\"\r\n            onChange={e => {setUsername(e.target.value)}}\r\n            error={username.length !== 0 && username.length < 2}\r\n            helperText={\r\n              username.length !== 0 && username.length < 2\r\n                ? \"Liian lyhyt\"\r\n                : \"Käyttäjänimesi ei näy muille pelaajille.\"\r\n            }\r\n            required={true}\r\n          />\r\n        </div>\r\n        <div>\r\n          <TextField\r\n            label=\"Pelinimi\"\r\n            onChange={e => {setTag(e.target.value)}}\r\n            helperText=\"Nimi joka näkyy muille pelaajille.\"\r\n            required={true}\r\n          />\r\n        </div>\r\n        <div>\r\n          <TextField\r\n            label=\"Salasana\"\r\n            type=\"password\"\r\n            onChange={e => {setPassword(e.target.value)}}\r\n            error={password.length < 8 && password !== \"\"}\r\n            helperText={\r\n              password.length < 8 && password !== \"\"\r\n                ? \"Liian lyhyt\"\r\n                : null\r\n            }\r\n            required={true}\r\n          />\r\n          <div\r\n            style={{\r\n              paddingTop: 20,\r\n              paddingBottom: 10,\r\n            }}\r\n          >\r\n            <strong>Älä käytä samaa salasanaa, joka sinulla on muilla nettisivuilla. </strong>\r\n            Olen vain opiskelija, ja tämä on ensimmäinen nettiprojektini, joten en voi taata sivuston tietoturvallisuutta.\r\n          </div>\r\n        </div>\r\n        <div>\r\n          <TextField\r\n            label=\"Salasana uudelleen\"\r\n            type=\"password\"\r\n            onChange={e => {setConfirmation(e.target.value)}}\r\n            error={confirmation !== password}\r\n            helperText={confirmation !== password ? \"Salasanat eivät vastaa toisiaan.\" : null}\r\n            required={true}\r\n          />\r\n        </div>\r\n        <div>\r\n          <Button variant=\"contained\" color=\"primary\" type=\"submit\">\r\n            Luo käyttäjä\r\n          </Button>\r\n        </div>\r\n      </form>\r\n    </Paper>\r\n  )\r\n}\r\n\r\nexport default RegisterForm","export const SQUARE_SIZE= 70\r\n\r\nexport const WHITESQUARE_COLOR = \"29, 240, 201\"\r\nexport const BLACKSQUARE_COLOR = \"25, 145, 123\"\r\nexport const HIGHLIGHTED_COLOR = \"17, 209, 97\"\r\n\r\nexport const baseUrl = \"\"","import React, { useState, useEffect } from \"react\"\r\nimport { Button, Link, Paper, Typography } from \"@material-ui/core\"\r\nimport { useMutation } from \"@apollo/client\"\r\nimport { CREATE_GAME } from \"../queries\"\r\nimport { useUser } from \"../utils/stateHooks\"\r\nimport { WHITESQUARE_COLOR, BLACKSQUARE_COLOR } from \"../utils/constants\"\r\n\r\nconst GameMenu = () => {\r\n  const [link, setLink] = useState(null)\r\n  const { user } = useUser()\r\n  const [createGame, createResult] = useMutation(CREATE_GAME, {\r\n    onError: err => {\r\n      if (!err.graphQLErrors || !err.graphQLErrors[0]) {\r\n        console.log(err.message)\r\n      } else {\r\n        console.log(err.graphQLErrors[0].message)\r\n      }\r\n    }\r\n  })\r\n\r\n  const newGame = () => {\r\n    if (!user) {\r\n      console.log(\"Sinun täytyy kirjautua ennen kuin pelaat\")\r\n    } else {\r\n      createGame()\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (createResult.data) {\r\n      const { id } = createResult.data.createGame\r\n      setLink(`${window.location}/${id}`)\r\n    }\r\n  }, [createResult.data])\r\n\r\n  return (\r\n    <div>\r\n      <Paper style={{\r\n        background: `linear-gradient(135deg, rgb(${WHITESQUARE_COLOR}), rgb(${BLACKSQUARE_COLOR}))`,\r\n        padding: 10,}}\r\n      >\r\n        {link\r\n          ?\r\n          <React.Fragment>\r\n            <Paper style={{\r\n              background: `linear-gradient(135deg, rgb(${WHITESQUARE_COLOR}), rgb(${BLACKSQUARE_COLOR}))`,\r\n              padding: 10,}}\r\n            >\r\n              Jaa tämä linkki kaverillesi. Sen kautta pääset pelaamaan.{\"  \"}\r\n              <Link href={link}>\r\n                {link}\r\n              </Link>\r\n            </Paper>\r\n            <Typography variant=\"subtitle2\">\r\n              voit myös kirjautua sisään ja kutsua kaverisi peliin profiilivalikosta.\r\n            </Typography>\r\n          </React.Fragment>\r\n          :\r\n          <React.Fragment>\r\n            <Button variant=\"contained\" onClick={newGame}>\r\n              Peli linkin kautta\r\n            </Button>\r\n            <Typography variant=\"subtitle2\">\r\n              tai kirjaudu sisään ja kutsu kaverisi peliin profiilivalikosta.\r\n            </Typography>\r\n          </React.Fragment>\r\n        }\r\n      </Paper>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default GameMenu","import React, { useState } from \"react\"\r\n//import { SQUARE_HEIGHT, SQUARE_WIDTH } from \"../globals\"\r\nimport blackKing from \"../../sprites/blackking.svg\"\r\nimport blackQueen from \"../../sprites/blackqueen.svg\"\r\nimport blackRook from \"../../sprites/blackrook.svg\"\r\nimport blackBishop from \"../../sprites/blackbishop.svg\"\r\nimport blackKnight from \"../../sprites/blackknight.svg\"\r\nimport blackPawn from \"../../sprites/blackpawn.svg\"\r\nimport whiteKing from \"../../sprites/whiteking.svg\"\r\nimport whiteQueen from \"../../sprites/whitequeen.svg\"\r\nimport whiteRook from \"../../sprites/whiterook.svg\"\r\nimport whiteBishop from \"../../sprites/whitebishop.svg\"\r\nimport whiteKnight from \"../../sprites/whiteknight.svg\"\r\nimport whitePawn from \"../../sprites/whitepawn.svg\"\r\n\r\n/* const BLACK_COLOR = \"#000000\"\r\nconst WHITE_COLOR = \"#ffffff\" */\r\n\r\nconst pieceStyle = {\r\n  width: 65,\r\n  height: 65,\r\n  //display: \"table-cell\",\r\n  verticalAlign: \"middle\",\r\n}\r\nexport const getImgSrc = (type, side) => {\r\n  if (type === \"king\" && side === \"black\") {\r\n    return blackKing\r\n  } else if (type === \"queen\" && side === \"black\") {\r\n    return blackQueen\r\n  } else if (type === \"bishop\" && side === \"black\") {\r\n    return blackBishop\r\n  } else if (type === \"rook\" && side === \"black\") {\r\n    return blackRook\r\n  } else if (type === \"knight\" && side === \"black\") {\r\n    return blackKnight\r\n  } else if (type === \"pawn\" && side === \"black\") {\r\n    return blackPawn\r\n  } else if (type === \"king\" && side === \"white\") {\r\n    return whiteKing\r\n  } else if (type === \"queen\" && side === \"white\") {\r\n    return whiteQueen\r\n  } else if (type === \"bishop\" && side === \"white\") {\r\n    return whiteBishop\r\n  } else if (type === \"rook\" && side === \"white\") {\r\n    return whiteRook\r\n  } else if (type === \"knight\" && side === \"white\") {\r\n    return whiteKnight\r\n  } else if (type === \"pawn\" && side === \"white\") {\r\n    return whitePawn\r\n  }\r\n}\r\n\r\nlet dragged\r\n\r\n\r\n\r\n// functionality of a piece\r\n\r\nconst Piece = ({ style, id, side, type }) => {\r\n  const [opacity,/*  setOpacity */] = useState(1)\r\n\r\n  /* const handleDragStart = event => {\r\n    // dragged määritellään\r\n    dragged = event.target\r\n    setOpacity(0.5)\r\n    console.log(\"dragged:\", dragged)\r\n  }\r\n\r\n  const handleDragEnd = event => {\r\n    setOpacity(1)\r\n  } */\r\n\r\n\r\n  return (\r\n    <img\r\n      style={{ ...style, opacity }}\r\n      className=\"piece\"\r\n      draggable=\"false\"\r\n      /* onDragStart={handleDragStart}\r\n      onDragEnd={handleDragEnd} */\r\n      type={id}\r\n      side={side}\r\n      id={id}\r\n      src={getImgSrc(type, side)}\r\n      alt=\"sprite\"\r\n    >\r\n    </img>\r\n  )\r\n}\r\n\r\n\r\n\r\n\r\n// pieces\r\n\r\nconst King = ({ side, id }) => {\r\n  const kingStyle = { ...pieceStyle }\r\n\r\n  return (\r\n    <Piece style={kingStyle} id={id} side={side} type=\"king\">\r\n      K\r\n    </Piece>\r\n  )\r\n}\r\n\r\nconst Queen = ({ side, id }) => {\r\n  const queenStyle = { ...pieceStyle }\r\n\r\n  return (\r\n    <Piece style={queenStyle} id={id} side={side} type=\"queen\">\r\n      D\r\n    </Piece>\r\n  )\r\n}\r\n\r\nconst Rook = ({ side, id }) => {\r\n  const rookStyle = { ...pieceStyle }\r\n\r\n  return (\r\n    <Piece style={rookStyle} id={id} side={side} type=\"rook\">\r\n      T\r\n    </Piece>\r\n  )\r\n}\r\n\r\nconst Knight = ({ side, id }) => {\r\n  const knightStyle = { ...pieceStyle }\r\n\r\n  return (\r\n    <Piece style={knightStyle} id={id} side={side} type=\"knight\">\r\n      R\r\n    </Piece>\r\n  )\r\n}\r\n\r\nconst Bishop = ({ side, id }) => {\r\n  const bishopStyle = { ...pieceStyle }\r\n\r\n  return (\r\n    <Piece style={bishopStyle} id={id} side={side} type=\"bishop\">\r\n      L\r\n    </Piece>\r\n  )\r\n}\r\n\r\nconst Pawn = ({ side, id }) => {\r\n  const pawnStyle = { ...pieceStyle }\r\n\r\n  return (\r\n    <Piece style={pawnStyle} id={id} side={side} type=\"pawn\">\r\n      S\r\n    </Piece>\r\n  )\r\n}\r\n\r\n/*Piece.displayName = \"Piece\"\r\nKing.displayName = \"King\"\r\nQueen.displayName = \"Queen\"\r\nRook.displayName = \"Rook\"\r\nKnight.displayName = \"Knight\"\r\nBishop.displayName = \"Bishop\"\r\nPawn.displayName = \"Pawn\"*/\r\n\r\nexport { King, Queen, Rook, Knight, Bishop, Pawn, dragged }","import React, { useState, useEffect, useMemo } from \"react\"\r\nimport {\r\n  SQUARE_SIZE,\r\n  BLACKSQUARE_COLOR,\r\n  WHITESQUARE_COLOR,\r\n  HIGHLIGHTED_COLOR,\r\n} from \"../../utils/constants\"\r\nimport { King, Queen, Rook, Knight, Bishop, Pawn } from \"./pieces\"\r\n\r\n// a single chess square\r\n\r\nconst Square = ({ color, makeMove, location, piece, dragHelperMap, id, highlight }) => {\r\n  const specificColor = useMemo(() => `rgb(${color === \"white\" ? WHITESQUARE_COLOR : BLACKSQUARE_COLOR})`, [color])\r\n  const [squareColor, setSquareColor] = useState(specificColor)\r\n  useEffect(() => {\r\n    if (highlight) {\r\n      setSquareColor(`rgb(${HIGHLIGHTED_COLOR})`)\r\n    } else {\r\n      setSquareColor(specificColor)\r\n    }\r\n  }, [highlight, specificColor])\r\n\r\n  //squarestyles\r\n  const squareStyle = {\r\n    height: SQUARE_SIZE,\r\n    width: SQUARE_SIZE,\r\n    backgroundColor: squareColor,\r\n    textAlign: \"center\",\r\n    background: `radial-gradient(${squareColor}, ${specificColor})`,\r\n  }\r\n  //console.log(squareStyle)\r\n\r\n\r\n  // drop handlers\r\n\r\n  /* const handleDrop = async event => {\r\n    event.preventDefault()\r\n\r\n    const piece = {\r\n      type: dragHelperMap.get(Number(dragged.id)).type,\r\n      side: dragHelperMap.get(Number(dragged.id)).side\r\n    }\r\n    const oldLocation = {\r\n      row: Math.floor(Number(dragged.id) / 8),\r\n      column: Number(dragged.id) % 8\r\n    }\r\n    const newLocation = location\r\n\r\n    if (event.target.className === \"square\") {\r\n      setSquareColor(specificColor)\r\n    } else if (event.target.className === \"piece\") {\r\n      setSquareColor(specificColor)\r\n    }\r\n\r\n    try {\r\n      const res = await makeMove({ piece, oldLocation, newLocation })\r\n      if (!res.data.makeMove.lastMove.success) {\r\n        console.log(res.data.makeMove.lastMove.message)\r\n      }\r\n    } catch (exception) {\r\n      console.log(exception.message)\r\n    }\r\n  }\r\n\r\n  const handleDragEnter = event => {\r\n    if (event.target.className === \"square\") {\r\n      setSquareColor(HIGHLIGHTED_COLOR)\r\n    } else if (event.target.className === \"piece\") {\r\n      setSquareColor(HIGHLIGHTED_COLOR)\r\n    }\r\n  }\r\n\r\n  const handleDragLeave = event => {\r\n    if (event.target.className === \"square\" && event.relatedTarget.className !== \"piece\") {\r\n      if (event.target.id === \"white\") {\r\n        setSquareColor(specificColor)\r\n      } else {\r\n        setSquareColor(specificColor)\r\n      }\r\n    } else if (event.target.className === \"piece\" && event.relatedTarget.className !== \"square\") {\r\n      if (event.target.parentNode.id === \"white\") {\r\n        setSquareColor(specificColor)\r\n      } else {\r\n        setSquareColor(specificColor)\r\n      }\r\n    }\r\n  } */\r\n\r\n  let pieceToRender\r\n\r\n  if (piece) {\r\n    switch(piece.type) {\r\n\r\n    case \"pawn\":\r\n      pieceToRender = <Pawn side={piece.side} id={8 * location.row + location.column} />\r\n      break\r\n    case \"rook\":\r\n      pieceToRender = <Rook side={piece.side} id={8 * location.row + location.column} />\r\n      break\r\n    case \"knight\":\r\n      pieceToRender = <Knight side={piece.side} id={8 * location.row + location.column} />\r\n      break\r\n    case \"bishop\":\r\n      pieceToRender = <Bishop side={piece.side} id={8 * location.row + location.column} />\r\n      break\r\n    case \"queen\":\r\n      pieceToRender = <Queen side={piece.side} id={8 * location.row + location.column} />\r\n      break\r\n    case \"king\":\r\n      pieceToRender = <King side={piece.side} id={8 * location.row + location.column} />\r\n      break\r\n    default:\r\n      pieceToRender = null\r\n    }\r\n  }\r\n\r\n\r\n  //---------------------------------\r\n  if (pieceToRender) {\r\n    return (\r\n      <td\r\n        id={id}\r\n        style={squareStyle}\r\n        className=\"square\"\r\n        /* onDragLeave={handleDragLeave} */\r\n        /* onDragOver={event => {event.preventDefault()}} */\r\n        /* onDrop={handleDrop}\r\n        onDragEnter={handleDragEnter} */\r\n      >\r\n        {pieceToRender}\r\n      </td>\r\n    )\r\n  }\r\n  return (\r\n    <td\r\n      id={id}\r\n      style={squareStyle}\r\n      className=\"square\"\r\n      /* onDragLeave={handleDragLeave}\r\n      onDragOver={event => {event.preventDefault()}} */\r\n      /* onDrop={handleDrop}\r\n      onDragEnter={handleDragEnter} */\r\n    />\r\n  )\r\n}\r\n\r\nexport default Square","import React from \"react\"\r\nimport Square from \"./Square\"\r\nimport { SQUARE_SIZE } from \"../../utils/constants\"\r\n\r\n// Chessboard\r\n\r\nconst Board = ({ boardAlignment, board, makeMove, handleClick, chosenPiece }) => {\r\n\r\n  const dragHelperMap = new Map()\r\n  board.forEach((row, i) => {\r\n    row.forEach((piece, j) => {\r\n      dragHelperMap.set(8 * i + j, piece)\r\n    })\r\n  })\r\n\r\n  const squares = Array.from(Array(8), (e, i) => {\r\n    const row = new Array(8)\r\n\r\n    for (let j = 0; j < 8; j++) {\r\n      if ((i + j) % 2 === 0) {\r\n        row[j] = { piece: null, color: \"white\"}\r\n      } else {\r\n        row[j] = { piece: null, color: \"black\"}\r\n      }\r\n    }\r\n\r\n    return row\r\n  })\r\n\r\n  const boardStyle = {\r\n    height: SQUARE_SIZE * 8,\r\n    width: SQUARE_SIZE * 8,\r\n    borderStyle: \"solid\",\r\n    borderColor: \"black\",\r\n    borderWidth: \"2px\",\r\n    background: \"cyan\",\r\n  }\r\n\r\n  //conschece)osenol.log(ePi\r\n\r\n  return (\r\n    <table\r\n      className=\"board\"\r\n      onClick={handleClick}\r\n      cellSpacing=\"0\"\r\n      style={boardStyle}\r\n    >\r\n      <tbody>\r\n        {boardAlignment === \"white\" ? board.map((row, i) => {\r\n          return (\r\n            <tr key={i}>\r\n              <td>{8 - i}</td>\r\n              {\r\n                row.map((piece, j) => {\r\n                  let highlight = false\r\n                  if (chosenPiece) {\r\n                    chosenPiece.availableMoves.forEach(move => {\r\n                      if (move.newLocation.row === i && move.newLocation.column === j) {\r\n                        highlight = true\r\n                      }\r\n                    })\r\n                    if (chosenPiece.location.row === i && chosenPiece.location.column === j) {\r\n                      highlight = true\r\n                    }\r\n                  }\r\n                  return <Square\r\n                    key={8 * i + j}\r\n                    id={8 * i + j}\r\n                    color={squares[i][j].color}\r\n                    makeMove={makeMove}\r\n                    location={{ row: i, column: j }}\r\n                    piece={piece}\r\n                    dragHelperMap={dragHelperMap}\r\n                    highlight={highlight}\r\n                  />\r\n                })\r\n              }\r\n            </tr>\r\n          )\r\n        }) : board.map((row, i) => {\r\n          return (\r\n            <tr key={i}>\r\n              <td>{i + 1}</td>\r\n              {\r\n                row.map((piece, j) => {\r\n                  let highlight = false\r\n                  if (chosenPiece) {\r\n                    chosenPiece.availableMoves.forEach(move => {\r\n                      if (move.newLocation.row === 7 - i && move.newLocation.column === 7 - j) {\r\n                        highlight = true\r\n                      }\r\n                    })\r\n                    if (chosenPiece.location.row === 7 - i && chosenPiece.location.column === 7 - j) {\r\n                      highlight = true\r\n                    }\r\n                  }\r\n                  return <Square\r\n                    key={8 * (7 - i) + (7 - j)}\r\n                    id={8 * (7 - i) + (7 - j)}\r\n                    color={squares[7 - i][7 - j].color}\r\n                    makeMove={makeMove}\r\n                    location={{ row: (7 - i), column: (7 - j) }}\r\n                    piece={board[7 - i][7 - j]}\r\n                    dragHelperMap={dragHelperMap}\r\n                    highlight={highlight}\r\n                  />\r\n                })\r\n              }\r\n            </tr>\r\n          )\r\n        })}\r\n        {boardAlignment === \"white\" \r\n          ?\r\n          <tr>\r\n            <td></td>\r\n            <td>A</td>\r\n            <td>B</td>\r\n            <td>C</td>\r\n            <td>D</td>\r\n            <td>E</td>\r\n            <td>F</td>\r\n            <td>G</td>\r\n            <td>H</td>\r\n          </tr>\r\n          :\r\n          <tr>\r\n            <td></td>\r\n            <td>H</td>\r\n            <td>G</td>\r\n            <td>F</td>\r\n            <td>E</td>\r\n            <td>D</td>\r\n            <td>C</td>\r\n            <td>B</td>\r\n            <td>A</td>\r\n          </tr>\r\n        }\r\n      </tbody>\r\n    </table>\r\n  )\r\n}\r\n\r\nexport default Board","import React, { useState, useEffect } from \"react\"\r\nimport { useUser } from \"../../utils/stateHooks\"\r\nimport { Button, Paper, makeStyles, Typography } from \"@material-ui/core\"\r\nimport { WHITESQUARE_COLOR, BLACKSQUARE_COLOR } from \"../../utils/constants\"\r\n\r\nconst useStyles = makeStyles({\r\n  turnText: {\r\n    background: `linear-gradient(135deg, rgb(${WHITESQUARE_COLOR}), rgb(${BLACKSQUARE_COLOR}))`,\r\n    padding: 10,\r\n    height: \"8vh\",\r\n    width: \"40vh\",\r\n    textAlign: \"center\",\r\n  }\r\n})\r\n\r\nconst GameText = ({game: { check, currentPlayer, gameOver, promotionPlayerID, winner, blackPlayer }, promote }) => {\r\n  const { user, userLoading } = useUser()\r\n  const [text, setText] = useState(\"Odotetaan, että vastustaja liityy peliin.\")\r\n  const [emphasize, setEmphasize] = useState(false)\r\n  const classes = useStyles()\r\n\r\n  useEffect(() => {\r\n    if (user) {\r\n      if (!blackPlayer) {\r\n        setEmphasize(false)\r\n        setText(\"Odotetaan, että vastustaja liityy peliin.\")\r\n      } else if (!gameOver) {\r\n        if (user.id === currentPlayer) {\r\n          if (check && check.threatenedPlayer === user.id) {\r\n            setText(\"On sinun vuorosi. Shakki!\")\r\n          } else {\r\n            setText(\"On sinun vuorosi.\")\r\n          }\r\n          setEmphasize(true)\r\n        } else {\r\n          if (check && check.threatenedPlayer !== user.id) {\r\n            setText(\"Odotetaan vastustajan siirtoa. Shakki!\")\r\n          } else {\r\n            setText(\"Odotetaan vastustajan siirtoa.\")\r\n          }\r\n          setEmphasize(false)\r\n        }\r\n      } else {\r\n        if (winner === user.id) {\r\n          setText(\"Voitit pelin! Onneksi olkoon!\")\r\n        } else {\r\n          setText(\"Ootko paska ku hävisit :D\")\r\n        }\r\n        setEmphasize(true)\r\n      }\r\n    }\r\n  }, [setText, blackPlayer, gameOver, currentPlayer, user, winner, check])\r\n\r\n  if (userLoading) {\r\n    return \"loading...\"\r\n  }\r\n\r\n  return (\r\n    <div className=\"gameText\">\r\n      <Paper className={classes.turnText}>\r\n        <Typography variant={emphasize ? \"h4\" : \"subtitle1\"}>\r\n          {text}\r\n        </Typography>\r\n      </Paper>\r\n      <div>\r\n        {\r\n          user.id === promotionPlayerID\r\n            ?\r\n            <div>\r\n              Valitse nappula, joksi haluat muuttaa sotilaan{\" \"}\r\n              <Button onClick={() => promote(\"queen\")}>\r\n                Kuningatar\r\n              </Button>\r\n              <Button onClick={() => promote(\"knight\")}>\r\n                Ratsu\r\n              </Button>\r\n            </div>\r\n            :\r\n            null\r\n        }\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default GameText","import React, { useState } from \"react\"\r\nimport { getImgSrc } from \"./pieces\"\r\nimport { Button, Typography, Paper } from \"@material-ui/core\"\r\nimport { WHITESQUARE_COLOR, BLACKSQUARE_COLOR } from \"../../utils/constants\"\r\n\r\nconst getLocation = (location) => {\r\n  if (location.column === 0) {\r\n    return `A${8 - (location.row)}`\r\n  }\r\n  if (location.column === 1) {\r\n    return `B${8 - (location.row)}`\r\n  }\r\n  if (location.column === 2) {\r\n    return `C${8 - (location.row)}`\r\n  }\r\n  if (location.column === 3) {\r\n    return `D${8 - (location.row)}`\r\n  }\r\n  if (location.column === 4) {\r\n    return `E${8 - (location.row)}`\r\n  }\r\n  if (location.column === 5) {\r\n    return `F${8 - (location.row)}`\r\n  }\r\n  if (location.column === 6) {\r\n    return `G${8 - (location.row)}`\r\n  }\r\n  if (location.column === 7) {\r\n    return `H${8 - (location.row)}`\r\n  } else {\r\n    return \"ErrorLocation\"\r\n  }\r\n}\r\n\r\n/* const useStyles = makeStyles({\r\n  moves: {\r\n    background: `rgb(${WHITESQUARE_COLOR})`,\r\n  }\r\n}) */\r\n\r\nconst Move = ({ move, emphasize }) => {\r\n  const emphasizeStyle = {\r\n    borderLeftStyle: \"solid\",\r\n    borderColor: \"blue\",\r\n    borderWidth: \"1px\",\r\n    borderLeftWidth: \"10px\",\r\n\r\n    padding: 10,\r\n    background: \"cyan\",\r\n  }\r\n  const moveStyle = {\r\n    borderLeftStyle: \"solid\",\r\n    borderColor: \"blue\",\r\n    borderWidth: \"1px\",\r\n    borderLeftWidth: \"5px\",\r\n\r\n    margin: 5,\r\n    background: \"cyan\"\r\n  }\r\n  const pieceStyle = emphasize ? {\r\n    height: 60,\r\n    width: 60,\r\n  } : undefined\r\n\r\n  if (move.__typename === \"OrdinaryMove\") {\r\n    return (\r\n      <Paper style={emphasize ? emphasizeStyle : moveStyle}>\r\n        <img\r\n          style={pieceStyle}\r\n          className=\"piece\"\r\n          draggable=\"false\"\r\n          src={getImgSrc(move.piece.type, move.piece.side)}\r\n          alt={move.piece.type}\r\n        />\r\n        {getLocation(move.newLocation)}\r\n      </Paper>\r\n    )\r\n  }\r\n  if (move.__typename === \"CastlingMove\") {\r\n    return (\r\n      <Paper style={emphasize ? emphasizeStyle : moveStyle}>\r\n        Tornitus\r\n      </Paper>\r\n    )\r\n  }\r\n  if (move.__typename === \"PromotionMove\") {\r\n    return (\r\n      <Paper style={emphasize ? emphasizeStyle : moveStyle}>\r\n        {getLocation(move.promotedPiece.location)}\r\n        <img\r\n          style={pieceStyle}\r\n          className=\"piece\"\r\n          draggable=\"false\"\r\n          src={getImgSrc(move.promotedPiece.type, move.promotedPiece.side)}\r\n          alt={move.promotedPiece.type}\r\n        />\r\n        {\"--->\"}\r\n        <img\r\n          style={pieceStyle}\r\n          className=\"piece\"\r\n          draggable=\"false\"\r\n          src={getImgSrc(move.promotedTo, move.promotedPiece.side)}\r\n          alt={move.promotedPiece.type}\r\n        />\r\n      </Paper>\r\n    )\r\n  }\r\n  if (move.__typename === \"SkipMove\") {\r\n    return (\r\n      <Paper style={emphasize ? emphasizeStyle : moveStyle}>\r\n        Vuoro ohitettu.\r\n      </Paper>\r\n    )\r\n  }\r\n  return (\r\n    <Paper>\r\n      Error\r\n    </Paper>\r\n  )\r\n}\r\n\r\nconst MoveHistory = ({ moveHistory }) => {\r\n  const moveHistoryStyle = {\r\n    overflowY: \"scroll\",\r\n    height: 350,\r\n  }\r\n  return (\r\n    <div className=\"moveHistory\" style={moveHistoryStyle}>\r\n      {moveHistory.map((move, index) => {\r\n\r\n        move = moveHistory[moveHistory.length - 1 - index]\r\n        \r\n        // other moves\r\n        if (index !== 0) {\r\n          return <Move move={move} key={index} />\r\n        } else {\r\n          return null\r\n        }\r\n      })}\r\n    </div>\r\n  )\r\n}\r\n\r\nconst LastMove = ({ moveHistory }) => {\r\n  const [showAll, setShowAll] = useState(false)\r\n  const style = {\r\n    background: `linear-gradient(135deg, rgb(${WHITESQUARE_COLOR}), rgb(${BLACKSQUARE_COLOR}))`,\r\n    padding: \"20px\",\r\n    /* height: \"auto\", */\r\n    /* margin: \"2vh\" */\r\n  }\r\n\r\n  if (moveHistory.length === 0) {\r\n    return (\r\n      <Paper style={style}>\r\n        <Typography variant=\"subtitle2\">\r\n          Siirtoja ei ole vielä tehty\r\n        </Typography>\r\n      </Paper>\r\n    )\r\n  }\r\n\r\n  const lastMove = moveHistory[moveHistory.length - 1]\r\n\r\n  return (\r\n    <Paper style={style}>\r\n      <Typography variant=\"h5\">\r\n        Viimeisin siirto\r\n      </Typography>\r\n      <Move move={lastMove} emphasize={true} />\r\n      <Button variant=\"contained\" onClick={() => setShowAll(!showAll)} color=\"primary\">\r\n        Näytä kaikki siirrot\r\n      </Button>\r\n      {showAll ? <MoveHistory moveHistory={moveHistory} /> : null}\r\n    </Paper>\r\n  )\r\n}\r\n\r\nexport default LastMove","import { HIGHLIGHTED_COLOR, WHITESQUARE_COLOR, BLACKSQUARE_COLOR } from \"../../utils/constants\"\r\n\r\n// checks is the square is valid to move to\r\nexport const isNotValid = ({ squareNode, pieceToMove, clickedPiece, game, user }) => {\r\n  /* console.log(squareNode.style.background !== `radial-gradient(rgb(${HIGHLIGHTED_COLOR}), rgb(${BLACKSQUARE_COLOR}))`)\r\n  console.log(squareNode.style.background !== `radial-gradient(rgb(${HIGHLIGHTED_COLOR}), rgb(${WHITESQUARE_COLOR}))`)\r\n  console.log(squareNode.style.background)\r\n  console.log(!squareNode.style.background.includes(\"radial-gradient\")) */\r\n  return (\r\n    (!squareNode.style.background.includes(`radial-gradient(rgb(${HIGHLIGHTED_COLOR}), rgb(${BLACKSQUARE_COLOR}))`) &&\r\n    !squareNode.style.background.includes(`radial-gradient(rgb(${HIGHLIGHTED_COLOR}), rgb(${WHITESQUARE_COLOR}))`))\r\n  ) || \r\n  (\r\n    clickedPiece &&\r\n    clickedPiece.id === pieceToMove.id\r\n  ) ||\r\n  (\r\n    game.gameOver ||\r\n    game.promotionPlayerID\r\n  ) ||\r\n  (\r\n    user.id !== game.currentPlayer\r\n  )\r\n}\r\n\r\n// checks if the piece is valid for movement\r\nexport const isValidPiece = ({ clickedPiece, game, user }) => {\r\n  /* console.log(clickedPiece)\r\n  console.log(game)\r\n  console.log(user) */\r\n  /* console.log(\"user.id === game.currentPlayer\", user.id === game.currentPlayer)\r\n  console.log(\"clickedPiece.side === game.whitePlayer === user.id ? white : black\",clickedPiece.side === (game.whitePlayer === user.id ? \"white\" : \"black\"))\r\n  console.log(\"!game.promotionPlayerID\",!game.promotionPlayerID)\r\n  console.log(\"!game.gameOver\",!game.gameOver) */\r\n  return (\r\n    user.id === game.currentPlayer &&\r\n    clickedPiece.side === (game.whitePlayer === user.id ? \"white\" : \"black\")\r\n  ) &&\r\n  (\r\n    !game.promotionPlayerID &&\r\n    !game.gameOver\r\n  )\r\n}","import React, { useState } from \"react\"\r\nimport { Paper, Button, Typography } from \"@material-ui/core\"\r\nimport { WHITESQUARE_COLOR, BLACKSQUARE_COLOR } from \"../../utils/constants\"\r\n\r\nconst GameButtons = ({ skipTurn, disabled }) => {\r\n  const [showSkipConfirm, setShowSkipConfirm] = useState(false)\r\n\r\n  const style = {\r\n    background: `linear-gradient(135deg, rgb(${WHITESQUARE_COLOR}), rgb(${BLACKSQUARE_COLOR}))`,\r\n    padding: \"20px\",\r\n  }\r\n\r\n  return (\r\n    <Paper style={style}>\r\n      {showSkipConfirm\r\n        ?\r\n        <div>\r\n          <Typography variant=\"subtitle2\">\r\n            Vahvista ohitus?\r\n          </Typography>\r\n          <Button\r\n            variant=\"outlined\"\r\n            size=\"small\"\r\n            onClick={() => {\r\n              skipTurn()\r\n              setShowSkipConfirm(false)\r\n            }}\r\n            disabled={disabled}\r\n          >\r\n            Ohita\r\n          </Button>\r\n          <Button\r\n            variant=\"outlined\"\r\n            size=\"small\"\r\n            onClick={() => {\r\n              setShowSkipConfirm(false)\r\n            }}\r\n          >\r\n            Peruuta\r\n          </Button>\r\n        </div>\r\n        :\r\n        <Button\r\n          variant=\"outlined\"\r\n          size=\"small\"\r\n          onClick={() => setShowSkipConfirm(true)}\r\n          disabled={disabled}\r\n        >\r\n          Ohita vuoro\r\n        </Button>\r\n      }\r\n    </Paper>\r\n  )\r\n}\r\n\r\nexport default GameButtons","import React, { useState } from \"react\"\r\nimport { useGame, useUser } from \"../../utils/stateHooks\"\r\nimport { handleApolloError } from \"../../utils/errorHandlers\"\r\nimport Board from \"./Board\"\r\nimport GameText from \"./GameText\"\r\nimport LastMove from \"./LastMove\"\r\nimport { isNotValid, isValidPiece } from \"./gameUtils\"\r\nimport { Grid, makeStyles, CircularProgress } from \"@material-ui/core\"\r\nimport GameButtons from \"./GameButtons\"\r\n\r\nconst useStyles = makeStyles({\r\n  game: {\r\n    //overflowY: \"scroll\",\r\n  }\r\n})\r\n\r\nconst Game = () => {\r\n  const {game, gameLoading, gameError, makeMove, promote, skipTurn } = useGame()\r\n  const { user, userLoading } = useUser()\r\n  const [pieceToMove, setPieceToMove] = useState(null)\r\n  const classes = useStyles()\r\n\r\n  if (gameLoading || userLoading) {\r\n    return <CircularProgress />\r\n  }\r\n  if (!game) {\r\n    return gameError.toString()\r\n  }\r\n  const {\r\n    board,\r\n    whitePlayer,\r\n    moveHistory,\r\n    currentPlayer,\r\n    promotionPlayerID,\r\n    check,\r\n    blackPlayer,\r\n  } = game\r\n\r\n  // handles a click on a piece or a square\r\n  const handleClick = async event => {\r\n    event.preventDefault()\r\n\r\n    let clickedElem = event.target\r\n\r\n    // the user clicked on a piece\r\n    if (clickedElem.className === \"piece\") {\r\n      const clickedPiece = board[Math.floor(Number(clickedElem.id) / 8)][Number(clickedElem.id) % 8]\r\n\r\n      if (pieceToMove) {\r\n        if (isNotValid({\r\n          squareNode: clickedElem.parentNode,\r\n          pieceToMove,\r\n          clickedPiece,\r\n          user,\r\n          game,\r\n        })) {\r\n          setPieceToMove(null)\r\n          return\r\n        }\r\n\r\n        const piece = { type: pieceToMove.type, side: pieceToMove.side }\r\n        const oldLocation = { row: pieceToMove.location.row, column: pieceToMove.location.column }\r\n        const newLocation = { row: clickedPiece.location.row, column: clickedPiece.location.column }\r\n\r\n        try {\r\n          const res = await makeMove({ piece, oldLocation, newLocation })\r\n          if (!res.data.makeMove.lastMove.success) {\r\n            console.log(res.data.makeMove.lastMove.message)\r\n          }\r\n        } catch (exception) {\r\n          handleApolloError(exception)\r\n        }\r\n        setPieceToMove(null)\r\n      } else if (isValidPiece({ clickedPiece, game, user })){\r\n        /* console.log(\"clickedPiece:\", clickedPiece) */\r\n        setPieceToMove(clickedPiece)\r\n        /* console.log(\"piece to move set\") */\r\n      }\r\n\r\n      // the user clicked on a square\r\n    } else if (clickedElem.className === \"square\") {\r\n      const clickedPieceElem = clickedElem.firstChild\r\n      let clickedPiece\r\n      if (clickedPieceElem) {\r\n        clickedPiece = board[Math.floor(Number(clickedPieceElem.id) / 8)][Number(clickedPieceElem.id) % 8]\r\n      }\r\n\r\n      /* console.log(\"clicked on a square\") */\r\n\r\n      if (pieceToMove) {\r\n        //console.log(clickedElem)\r\n        if (isNotValid({\r\n          squareNode: clickedElem,\r\n          pieceToMove,\r\n          clickedPiece,\r\n          user,\r\n          game,\r\n        })) {\r\n          /* console.log(\"was not valid\") */\r\n          setPieceToMove(null)\r\n          return\r\n        }\r\n\r\n        const piece = { type: pieceToMove.type, side: pieceToMove.side }\r\n        const oldLocation = { row: pieceToMove.location.row, column: pieceToMove.location.column }\r\n        const newLocation = { row: Math.floor(Number(clickedElem.id) / 8), column: Number(clickedElem.id) % 8 }\r\n        /* console.log(\"trying to make move\") */\r\n\r\n        try {\r\n          const res = await makeMove({ piece, oldLocation, newLocation })\r\n          if (!res.data.makeMove.lastMove.success) {\r\n            console.log(res.data.makeMove.lastMove.message)\r\n          }\r\n        } catch (exception) {\r\n          handleApolloError(exception)\r\n        }\r\n        setPieceToMove(null)\r\n      } else if (clickedPiece && isValidPiece({ clickedPiece, game, user })) {\r\n        setPieceToMove(clickedPiece)\r\n      }\r\n\r\n    } else {\r\n      setPieceToMove(null)\r\n    }\r\n  }\r\n\r\n  /* console.log(\"game rendered with board being:\", board) */\r\n\r\n\r\n  return (\r\n    <Grid\r\n      container\r\n      direction=\"row\"\r\n      //alignItems=\"baseline\"\r\n      justify=\"center\"\r\n      className={classes.game}\r\n      spacing={2}\r\n      wrap=\"wrap\"\r\n    >\r\n      <Grid item xs={3} lg={2}>\r\n        <GameButtons\r\n          skipTurn={skipTurn}\r\n          disabled={\r\n            (user.id !== currentPlayer || promotionPlayerID !== null) || \r\n            (check !== null || (whitePlayer === null || blackPlayer === null))\r\n          }\r\n        />\r\n      </Grid>\r\n      <Grid\r\n        container\r\n        item\r\n        xs={10}\r\n        lg={6}\r\n        direction=\"column\"\r\n        alignItems=\"center\"\r\n        //wrap=\"wrap\"\r\n      >\r\n        <Board\r\n          board={board}\r\n          boardAlignment={user.id === whitePlayer ? \"white\" : \"black\"}\r\n          makeMove={makeMove}\r\n          handleClick={handleClick}\r\n          chosenPiece={pieceToMove}\r\n        />\r\n        <GameText game={game} promote={promote} />\r\n      </Grid>\r\n      <Grid item xs={3} lg={3}>\r\n        <LastMove moveHistory={moveHistory} />\r\n      </Grid>\r\n    </Grid>\r\n  )\r\n}\r\n\r\nexport default Game","import React, { useState } from \"react\"\nimport { Grid, CircularProgress } from \"@material-ui/core\"\nimport { Switch, Route } from \"react-router-dom\"\nimport Footer from \"./components/Footer\"\nimport LoginForm from \"./components/LoginForm\"\nimport Menu from \"./components/Menu\"\nimport RegisterForm from \"./components/RegisterForm\"\nimport GameMenu from \"./components/GameMenu\"\nimport Game from \"./components/chess/Game\"\nimport { useUser } from \"./utils/stateHooks\"\nimport { Container, makeStyles } from \"@material-ui/core\"\nimport { FeedbackContext } from \"./utils/context\"\nimport Feedback from \"./components/Feedback\"\n\nconst useStyles = makeStyles({\n  root: {\n    height: \"100%\",\n  }\n})\n\nconst App = () => {\n  const { user } = useUser()\n  const classes = useStyles()\n  const [feedback, setFeedback] = useState(null)\n  //console.log(\"app rendering and feedback is\", feedback)\n\n  return (\n    <FeedbackContext.Provider value={{ feedback, setFeedback }}>\n      <Container classes={classes}>\n        <Grid\n          container\n          direction=\"column\"\n          alignItems=\"center\"\n          justify=\"space-between\"\n          classes={classes}\n          wrap=\"nowrap\"\n        >\n          <Menu />\n          {user\n            ?\n            <Switch>\n              <Route path=\"/play/:id\">\n                <Game />\n              </Route>\n              <Route path=\"/play\">\n                <GameMenu />\n              </Route>\n              <Route path=\"/login\">\n                <LoginForm />\n              </Route>\n              <Route path=\"/register\">\n                <RegisterForm />\n              </Route>\n            </Switch>\n            : <CircularProgress />\n          }\n          <Feedback />\n          <Footer />\n        </Grid>\n      </Container>\n    </FeedbackContext.Provider>\n  )\n}\n\nexport default App\n"],"sourceRoot":""}