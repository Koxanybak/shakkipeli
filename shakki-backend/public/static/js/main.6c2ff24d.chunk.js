(this["webpackJsonpshakki-frontend"]=this["webpackJsonpshakki-frontend"]||[]).push([[0],{132:function(e,t,a){e.exports=a(153)},153:function(e,t,a){"use strict";a.r(t);var n=a(46),r=a(0),o=a.n(r),l=a(17),i=a.n(l),c=a(42),u=a(20),s=a(56),d=a(107),m=a(109),g=a(110),f=a(111),b=a(47),p=a(24);function v(){var e=Object(b.a)(["\n  mutation promote($gameId: String!, $pieceType: String!) {\n    promote(\n      gameId: $gameId,\n      pieceType: $pieceType\n    ) {\n      board {\n        type\n        side\n      }\n      id\n      currentPlayer\n      whitePlayer\n      blackPlayer\n      winner\n      gameOver\n      promotionPlayerID\n    }\n  }\n"]);return v=function(){return e},e}function E(){var e=Object(b.a)(["\n  mutation joinGame($gameId: String!) {\n    joinGame(\n      gameId: $gameId\n    ) {\n      board {\n        type\n        side\n      }\n      id\n      currentPlayer\n      whitePlayer\n      blackPlayer\n      winner\n      gameOver\n      promotionPlayerID\n    }\n  }\n"]);return E=function(){return e},e}function j(){var e=Object(b.a)(["\n  mutation createGame {\n    createGame {\n      board {\n        type\n        side\n      }\n      id\n    }\n  }\n"]);return j=function(){return e},e}function h(){var e=Object(b.a)(["\n  mutation addUser($user: NewUserInput!) {\n    addUser(\n      user: $user\n    ) {\n      username\n      tag\n      id\n      friends {\n        tag\n      }\n    }\n  }\n"]);return h=function(){return e},e}function y(){var e=Object(b.a)(["\n  mutation login($username: String!, $password: String!) {\n    login(\n      username: $username,\n      password: $password\n    ) {\n      username\n      tag\n      friends {\n        tag\n      }\n      token\n      id\n    }\n  }\n"]);return y=function(){return e},e}function k(){var e=Object(b.a)(["\n  subscription moveMade($gameId: String!) {\n    moveMade(\n      gameId: $gameId\n    ) {\n      board {\n        type\n        side\n      }\n      id\n      lastMove {\n        success\n      }\n      currentPlayer\n      whitePlayer\n      blackPlayer\n      winner\n      gameOver\n      promotionPlayerID\n    }\n  }\n"]);return k=function(){return e},e}function O(){var e=Object(b.a)(["\n  mutation makeMove($move: MoveInput!) {\n    makeMove(\n      move: $move\n    ) {\n      lastMove {\n        success\n        message\n      }\n    }\n  }\n"]);return O=function(){return e},e}function w(){var e=Object(b.a)(["\n  query getLoggedUser($token: String) {\n    getLoggedUser(\n      token: $token\n    ) {\n      username\n      tag\n      friends {\n        tag\n      }\n      id\n      token\n      guest\n    }\n  }\n"]);return w=function(){return e},e}function C(){var e=Object(b.a)(["\n  query getGame($gameId: String!) {\n    getGame(\n      gameId: $gameId\n    ) {\n      board {\n        type\n        side\n      }\n      id\n      currentPlayer\n      whitePlayer\n      blackPlayer\n      winner\n      gameOver\n      promotionPlayerID\n    }\n  }\n"]);return C=function(){return e},e}var I,S,P=Object(p.a)(C()),L=Object(p.a)(w()),D=Object(p.a)(O()),N=Object(p.a)(k()),q=Object(p.a)(y()),$=Object(p.a)(h()),x=Object(p.a)(j()),M=Object(p.a)(E()),G=Object(p.a)(v()),T=a(99),U=a.n(T),Q=a(114),K={width:45,height:45,display:"table-cell",verticalAlign:"middle"},A=function(e){var t=e.style,a=e.children,n=e.id,r=e.side;return o.a.createElement("div",{style:t,className:"piece",draggable:"true",onDragStart:function(e){I=e.target,e.target.style.opacity=.5},onDragEnd:function(e){e.target.style.opacity=1},type:n,side:r,id:n},a)},J=function(e){var t=e.side,a=e.id,r=Object(n.a)({},K);return r.backgroundColor="black"===t?"#000000":"#ffffff",r.color="white"===t?"#000000":"#ffffff",o.a.createElement(A,{style:r,id:a,side:t},"K")},B=function(e){var t=e.side,a=e.id,r=Object(n.a)({},K);return r.backgroundColor="black"===t?"#000000":"#ffffff",r.color="white"===t?"#000000":"#ffffff",o.a.createElement(A,{style:r,id:a,side:t},"D")},H=function(e){var t=e.side,a=e.id,r=Object(n.a)({},K);return r.backgroundColor="black"===t?"#000000":"#ffffff",r.color="white"===t?"#000000":"#ffffff",o.a.createElement(A,{style:r,id:a,side:t},"T")},R=function(e){var t=e.side,a=e.id,r=Object(n.a)({},K);return r.backgroundColor="black"===t?"#000000":"#ffffff",r.color="white"===t?"#000000":"#ffffff",o.a.createElement(A,{style:r,id:a,side:t},"R")},V=function(e){var t=e.side,a=e.id,r=Object(n.a)({},K);return r.backgroundColor="black"===t?"#000000":"#ffffff",r.color="white"===t?"#000000":"#ffffff",o.a.createElement(A,{style:r,id:a,side:t},"L")},z=function(e){var t=e.side,a=e.id,r=Object(n.a)({},K);return r.backgroundColor="black"===t?"#000000":"#ffffff",r.color="white"===t?"#000000":"#ffffff",o.a.createElement(A,{style:r,id:a,side:t},"S")},F=o.a.createContext(null),W=o.a.createContext(null),X=function(e){var t,a=e.color,n=e.makeMove,l=e.location,i=e.piece,c=e.dragHelperMap,u=Object(r.useContext)(W).gameId,s={height:70,width:70,backgroundColor:"#1df0c9",textAlign:"center"},d={height:70,width:70,backgroundColor:"#19917b",textAlign:"center"},m=function(){var e=Object(Q.a)(U.a.mark((function e(t){var r,o,i,s,d;return U.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),console.log("dragged:",I),r={type:c.get(Number(I.id)).type,side:c.get(Number(I.id)).side},o={row:Math.floor(Number(I.id)/8),column:Number(I.id)%8},i=l,"square"===t.target.className?t.target.style.backgroundColor="white"===a?"#1df0c9":"#19917b":"piece"===t.target.className&&((s=t.target.parentNode).style.backgroundColor="white"===s.id?"#1df0c9":"#19917b"),e.prev=6,e.next=9,n({variables:{move:{piece:r,oldLocation:o,newLocation:i,gameId:u}}});case 9:(d=e.sent).data.makeMove.lastMove.success||console.log(d.data.makeMove.lastMove.message),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(6),console.log(e.t0.message);case 16:case"end":return e.stop()}}),e,null,[[6,13]])})));return function(t){return e.apply(this,arguments)}}();if(i)switch(i.type){case"pawn":t=o.a.createElement(z,{side:i.side,id:8*l.row+l.column});break;case"rook":t=o.a.createElement(H,{side:i.side,id:8*l.row+l.column});break;case"knight":t=o.a.createElement(R,{side:i.side,id:8*l.row+l.column});break;case"bishop":t=o.a.createElement(V,{side:i.side,id:8*l.row+l.column});break;case"queen":t=o.a.createElement(B,{side:i.side,id:8*l.row+l.column});break;case"king":t=o.a.createElement(J,{side:i.side,id:8*l.row+l.column});break;default:t=null}return o.a.createElement("td",{id:"white"===a?"white":"black",style:"white"===a?s:d,className:"square",onDragLeave:function(e){"square"===e.target.className&&"piece"!==e.relatedTarget.className?"white"===e.target.id?e.target.style.backgroundColor="#1df0c9":e.target.style.backgroundColor="#19917b":"piece"===e.target.className&&"square"!==e.relatedTarget.className&&("white"===e.target.parentNode.id?e.target.parentNode.style.backgroundColor="#1df0c9":e.target.parentNode.style.backgroundColor="#19917b")},onDragOver:function(e){e.preventDefault()},onDrop:m,onDragEnter:function(e){"square"===e.target.className?e.target.style.backgroundColor="#11d161":"piece"===e.target.className&&(e.target.parentNode.style.backgroundColor="#11d161")}},t)},Y=function(e,t,a){var n=t.readQuery({query:P,variables:{gameId:a}});n={getGame:e.moveMade},console.log("newGameData:",e),t.writeQuery({query:P,data:n,variables:{gameId:a}}),console.log("Game state updated with:",t.readQuery({query:P,variables:{gameId:a}}))},Z=a(182),_=function(){var e=Object(d.a)(),t=Object(s.g)().id,a=Object(r.useContext)(W).setGameId,n=Object(r.useContext)(F).user,l=Object(m.a)(P,{variables:{gameId:t},onError:function(e){e.graphQLErrors?console.log(e.graphQLErrors[0].message):console.log(e.message)},onCompleted:function(e){a(e.getGame.id)}}),i=Object(g.a)(D),c=Object(u.a)(i,1)[0],b=Object(g.a)(G),p=Object(u.a)(b,1)[0],v=Object(g.a)(M,{variables:{gameId:t},onError:function(e){e.graphQLErrors?console.log(e.graphQLErrors[0].message):console.log(e.message)},onCompleted:function(a){Y(a,e,t)}}),E=Object(u.a)(v,1)[0];Object(f.a)(N,{onSubscriptionData:function(a){var n=a.subscriptionData;Y(n.data,e,t)},variables:{gameId:t}}),Object(r.useEffect)((function(){E()}),[E]);var j=function(e){p({variables:{gameId:t,pieceType:e}})};if(l.loading)return"loading...";if(!l.data)return l.error.toString();var h=l.data.getGame,y=h.board,k=h.whitePlayer,O=h.currentPlayer,w=h.gameOver,C=h.winner,I=h.promotionPlayerID,S=new Map;y.forEach((function(e,t){e.forEach((function(e,a){S.set(8*t+a,e)}))}));var L=Array.from(Array(8),(function(e,t){for(var a=new Array(8),n=0;n<8;n++)a[n]=(t+n)%2===0?{piece:null,color:"white"}:{piece:null,color:"black"};return a}));return o.a.createElement("div",null,o.a.createElement("div",null,"Olet ",n.id===k?"valkoiset":"mustat",". ",n.id===O?"On sinun vuorosi.":"Odotetaan vastustajan siirtoa."),o.a.createElement("table",null,o.a.createElement("tbody",null,y.map((function(e,t){return o.a.createElement("tr",{key:t},e.map((function(e,a){return o.a.createElement(X,{key:8*t+a,color:L[t][a].color,makeMove:c,location:{row:t,column:a},piece:e,dragHelperMap:S})})))})))),o.a.createElement("div",null,n.id===I?o.a.createElement("div",null,"Valitse nappula, joksi haluat muuttaa sotilaan",o.a.createElement(Z.a,{onClick:function(){return j("queen")}},"Kuningatar"),o.a.createElement(Z.a,{onClick:function(){return j("rook")}},"Torni"),o.a.createElement(Z.a,{onClick:function(){return j("knight")}},"Ratsu"),o.a.createElement(Z.a,{onClick:function(){return j("bishop")}},"L\xe4hetti")):null),o.a.createElement("div",null,w?C===n.id?"Voitit pelin! Onneksi olkoon!":"Ootko paska ku h\xe4visit :D":null))},ee=function(){return o.a.createElement("div",null,"Student project for Full Stack open 2020")},te=a(191),ae=function(){var e=Object(r.useState)(""),t=Object(u.a)(e,2),a=t[0],n=t[1],l=Object(r.useState)(""),i=Object(u.a)(l,2),c=i[0],d=i[1],m=Object(r.useContext)(F).setUser,f=Object(s.f)(),b=Object(g.a)(q,{onError:function(e){console.log(e.graphQLErrors[0].message),d("")}}),p=Object(u.a)(b,2),v=p[0],E=p[1];return Object(r.useEffect)((function(){E.data&&(n(""),d(""),console.log(E.data.login.token),window.sessionStorage.setItem("loggedChessUser",E.data.login.token),m(E.data.login),f.push("/"))}),[E.data,m,f]),o.a.createElement("div",null,o.a.createElement("h2",null,"Kirjaudu sis\xe4\xe4n"),o.a.createElement("form",{onSubmit:function(e){e.preventDefault(),v({variables:{username:a,password:c}})}},o.a.createElement("div",null,o.a.createElement(te.a,{label:"K\xe4ytt\xe4j\xe4nimi",onChange:function(e){n(e.target.value)},name:"username"})),o.a.createElement("div",null,o.a.createElement(te.a,{label:"Salasana",type:"password",onChange:function(e){d(e.target.value)},name:"password"})),o.a.createElement("div",null,o.a.createElement(Z.a,{variant:"contained",color:"primary",type:"submit"},"Kirjaudu"))),o.a.createElement("div",null,"tai"),o.a.createElement("div",null,o.a.createElement(Z.a,{variant:"contained",color:"primary",onClick:function(){return f.push("/register")}},"Luo uusi k\xe4ytt\xe4j\xe4")))},ne=a(186),re=a(187),oe=a(188),le=a(156),ie=function(){var e=Object(r.useContext)(F).user;return o.a.createElement(ne.a,{position:"static"},o.a.createElement(re.a,null,o.a.createElement(oe.a,{edge:"start",color:"inherit","aria-label":"menu"}),o.a.createElement(Z.a,{color:"inherit",component:c.b,to:"/play"},"Pelaa"),o.a.createElement(Z.a,{color:"inherit",component:c.b,to:"/info"},"Ohjeet"),e?o.a.createElement(le.a,{variant:"subtitle1",color:"secondary"},'`"`',e.tag,'`"` kirjautunut'):o.a.createElement(Z.a,{color:"inherit",component:c.b,to:"/login"},"Kirjaudu")))},ce=function(){var e=Object(r.useState)(""),t=Object(u.a)(e,2),a=t[0],n=t[1],l=Object(r.useState)(""),i=Object(u.a)(l,2),c=i[0],d=i[1],m=Object(r.useState)(""),f=Object(u.a)(m,2),b=f[0],p=f[1],v=Object(r.useState)(""),E=Object(u.a)(v,2),j=E[0],h=E[1],y=Object(s.f)(),k=Object(g.a)($,{onError:function(e){console.log(e.graphQLErrors[0].message),window.alert(e.graphQLErrors[0].message)}}),O=Object(u.a)(k,2),w=O[0],C=O[1];return Object(r.useEffect)((function(){C.data&&(n(""),d(""),h(""),window.alert("K\xe4ytt\xe4j\xe4 luotu onnistuneesti."),y.push("/"))}),[C.data,y]),o.a.createElement("div",null,o.a.createElement("h2",null,"Luo uusi k\xe4ytt\xe4j\xe4"),o.a.createElement("form",{onSubmit:function(e){e.preventDefault(),w({variables:{user:{username:a,password:c,tag:j}}})}},o.a.createElement("div",null,o.a.createElement(te.a,{label:"K\xe4ytt\xe4j\xe4nimi",onChange:function(e){n(e.target.value)},error:0!==a.length&&a.length<2,helperText:0!==a.length&&a.length<2?"Liian lyhyt":"K\xe4ytt\xe4j\xe4nimesi ei n\xe4y muille pelaajille.",required:!0})),o.a.createElement("div",null,o.a.createElement(te.a,{label:"Pelinimi",onChange:function(e){h(e.target.value)},helperText:"Nimi joka n\xe4kyy muille pelaajille.",required:!0})),o.a.createElement("div",null,o.a.createElement(te.a,{label:"Salasana",type:"password",onChange:function(e){d(e.target.value)},error:c.length<8&&""!==c,helperText:c.length<8&&""!==c?"Liian lyhyt":null,required:!0}),o.a.createElement("div",{style:{paddingTop:20,paddingBottom:10}},o.a.createElement("strong",null,"\xc4l\xe4 k\xe4yt\xe4 samaa salasanaa, joka sinulla on muilla nettisivuilla. "),"Olen vain opiskelija, ja t\xe4m\xe4 on ensimm\xe4inen nettiprojektini, joten en voi taata sivuston tietoturvallisuutta.")),o.a.createElement("div",null,o.a.createElement(te.a,{label:"Salasana uudelleen",type:"password",onChange:function(e){p(e.target.value)},error:b!==c,helperText:b!==c?"Salasanat eiv\xe4t vastaa toisiaan.":null,required:!0})),o.a.createElement("div",null,o.a.createElement(Z.a,{variant:"contained",color:"primary",type:"submit"},"Luo k\xe4ytt\xe4j\xe4"))))},ue=a(189),se=function(){var e=Object(r.useState)(null),t=Object(u.a)(e,2),a=t[0],n=t[1],l=Object(r.useContext)(F).user,i=Object(g.a)(x,{onError:function(e){console.log(e.message)}}),c=Object(u.a)(i,2),s=c[0],d=c[1];return Object(r.useEffect)((function(){if(d.data){var e=d.data.createGame.id;n("".concat(window.location,"/").concat(e))}}),[d.data]),o.a.createElement("div",null,o.a.createElement(Z.a,{onClick:function(){l?s():console.log("Sinun t\xe4ytyy kirjautua ennen kuin pelaat")}},"Peli linkin kautta"),a?o.a.createElement("div",null,"Jaa t\xe4m\xe4 linkki kaverillesi. Sen kautta p\xe4\xe4set pelaamaan.","  ",o.a.createElement(ue.a,{href:a},a)):null)},de=function(){var e=Object(r.useState)(null),t=Object(u.a)(e,2),a=t[0],n=t[1],l=Object(r.useState)(null),i=Object(u.a)(l,2),c=i[0],d=i[1],g=Object(m.a)(L,{variables:{token:window.sessionStorage.getItem("loggedChessUser")}});return Object(r.useEffect)((function(){g.data&&(g.data.getLoggedUser.guest?(n(g.data.getLoggedUser),window.sessionStorage.setItem("loggedChessUser",g.data.getLoggedUser.token)):n(g.data.getLoggedUser))}),[g.data]),o.a.createElement("div",null,o.a.createElement(F.Provider,{value:{user:a,setUser:n}},o.a.createElement(ie,null),a?o.a.createElement(s.c,null,o.a.createElement(s.a,{path:"/play/:id"},o.a.createElement(W.Provider,{value:{gameId:c,setGameId:d}},o.a.createElement(_,null))),o.a.createElement(s.a,{path:"/play"},o.a.createElement(W.Provider,{value:{gameId:c,setGameId:d}},o.a.createElement(se,null))),o.a.createElement(s.a,{path:"/login"},o.a.createElement(ae,null)),o.a.createElement(s.a,{path:"/register"},o.a.createElement(ce,null))):"loading",o.a.createElement(ee,null)))},me=a(190),ge=a(63),fe=a(79),be=a(80),pe=a(81),ve=a(108),Ee=a(120),je=a(119),he=a(121),ye=Object(Ee.a)((function(e,t){var a=t.headers,r=sessionStorage.getItem("loggedChessUser");return{headers:Object(n.a)(Object(n.a)({},a),{},{authorization:r?"bearer ".concat(r):null})}})),ke=window.location;S="https:"===ke.protocol?"wss:":"ws:",S+="//"+ke.host,console.log("".concat(S,"/graphql"));var Oe=new ge.a({uri:"/graphql"}),we=new he.a({uri:"".concat(S,"/graphql"),options:{reconnect:!0}}),Ce=Object(fe.a)((function(e){var t=e.query,a=Object(je.a)(t);return"OperationDefinition"===a.kind&&"subscription"===a.operation}),we,ye.concat(Oe)),Ie=new be.a({cache:new pe.a,link:Ce,connectToDevTools:!0});i.a.render(o.a.createElement(ve.a,{client:Ie},o.a.createElement(me.a,null,o.a.createElement(c.a,null,o.a.createElement(de,null)))),document.getElementById("root"))}},[[132,1,2]]]);
//# sourceMappingURL=main.6c2ff24d.chunk.js.map